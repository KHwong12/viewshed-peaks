var bt=Object.defineProperty,kt=Object.defineProperties;var Nt=Object.getOwnPropertyDescriptors;var et=Object.getOwnPropertySymbols;var Ct=Object.prototype.hasOwnProperty,Ot=Object.prototype.propertyIsEnumerable;var it=(t,o,e)=>o in t?bt(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,q=(t,o)=>{for(var e in o||(o={}))Ct.call(o,e)&&it(t,e,o[e]);if(et)for(var e of et(o))Ot.call(o,e)&&it(t,e,o[e]);return t},K=(t,o)=>kt(t,Nt(o));import{eM as Mt,g_ as xt,gX as ot,eK as rt,Z as Pt,kF as It,la as M,r as ut,gj as Lt,ng as ht,nh as pt,a as wt}from"./index.89a7b683.js";import{t as Xt,b as zt,A as nt,p as Jt,c as lt,O as X,R as B,i as J,d as N,f as Ht,g as Yt,e as Rt}from"./CIMSymbolHelper.423b1eca.js";function $t(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":{const e=t.symbolLayers;return e&&e.length===1?$t(e[0]):null}case"CIMVectorMarker":{var o;const e=t.markerGraphics;if(!e||e.length!==1)return null;const r=e[0];if(!r)return null;const i=r.geometry;if(!i)return null;const n=r.symbol;return!n||n.type!=="CIMPolygonSymbol"&&n.type!=="CIMLineSymbol"||(o=n.symbolLayers)!=null&&o.some(s=>!!s.effects)?null:{geom:i,asFill:n.type==="CIMPolygonSymbol"}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function At(t){return t?t.rings?t.rings:t.paths?t.paths:t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}function Ft(t){let o=1/0,e=-1/0,r=1/0,i=-1/0;for(const n of t)for(const s of n)s[0]<o&&(o=s[0]),s[0]>e&&(e=s[0]),s[1]<r&&(r=s[1]),s[1]>i&&(i=s[1]);return new Xt(o,r,e-o,i-r)}function at(t){let o=1/0,e=-1/0,r=1/0,i=-1/0;for(const n of t)for(const s of n)s[0]<o&&(o=s[0]),s[0]>e&&(e=s[0]),s[1]<r&&(r=s[1]),s[1]>i&&(i=s[1]);return[o,r,e,i]}function yt(t){return t?t.rings?at(t.rings):t.paths?at(t.paths):Mt(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function gt(t,o,e,r,i){const[n,s,a,c]=t;if(a<n||c<s)return[0,0,0];const m=a-n,f=c-s,h=128,l=1,u=Math.floor(.5*(.5*h-l)),g=(h-2*(u+l))/Math.max(m,f),y=Math.round(m*g)+2*u,S=Math.round(f*g)+2*u;let d=1;o&&(d=S/g/(o.ymax-o.ymin));let b=0,k=0;if(r)if(i){if(o&&e&&o.ymax-o.ymin>0){const v=(o.xmax-o.xmin)/(o.ymax-o.ymin);b=r.x/(e*v),k=r.y/e}}else b=r.x,k=r.y;return b=.5*(o.xmax+o.xmin)+b*(o.xmax-o.xmin),k=.5*(o.ymax+o.ymin)+k*(o.ymax-o.ymin),b-=n,k-=s,b*=g,k*=g,b+=u,k+=u,[d,b/y-.5,-(k/S-.5)]}function ue(t){const o=At(t.geom),e=Ft(o),r=128,i=1,n=Math.floor(.5*(.5*r-i)),s=(r-2*(n+i))/Math.max(e.width,e.height),a=Math.round(e.width*s)+2*n,c=Math.round(e.height*s)+2*n,m=[];for(const h of o)if(h&&h.length>1){const l=[];for(const u of h){let[g,y]=u;g-=e.x,y-=e.y,g*=s,y*=s,g+=n-.5,y+=n-.5,t.asFill?l.push([g,y]):l.push([Math.round(g),Math.round(y)])}if(t.asFill){const u=l.length-1;l[0][0]===l[u][0]&&l[0][1]===l[u][1]||l.push(l[0])}m.push(l)}const f=Wt(m,a,c,n);return t.asFill&&Tt(m,a,c,n,f),[Et(f,n),a,c]}function Wt(t,o,e,r){const i=o*e,n=new Array(i),s=r*r+1;for(let a=0;a<i;++a)n[a]=s;for(const a of t){const c=a.length;for(let m=1;m<c;++m){const f=a[m-1],h=a[m];let l,u,g,y;f[0]<h[0]?(l=f[0],u=h[0]):(l=h[0],u=f[0]),f[1]<h[1]?(g=f[1],y=h[1]):(g=h[1],y=f[1]);let S=Math.floor(l)-r,d=Math.floor(u)+r,b=Math.floor(g)-r,k=Math.floor(y)+r;S<0&&(S=0),d>o&&(d=o),b<0&&(b=0),k>e&&(k=e);const v=h[0]-f[0],x=h[1]-f[1],P=v*v+x*x;for(let O=S;O<d;O++)for(let C=b;C<k;C++){let L,z,w=(O-f[0])*v+(C-f[1])*x;w<0?(L=f[0],z=f[1]):w>P?(L=h[0],z=h[1]):(w/=P,L=f[0]+w*v,z=f[1]+w*x);const A=(O-L)*(O-L)+(C-z)*(C-z),R=(e-C-1)*o+O;A<n[R]&&(n[R]=A)}}}for(let a=0;a<i;++a)n[a]=Math.sqrt(n[a]);return n}function Tt(t,o,e,r,i){for(const n of t){const s=n.length;for(let a=1;a<s;++a){const c=n[a-1],m=n[a];let f,h,l,u;c[0]<m[0]?(f=c[0],h=m[0]):(f=m[0],h=c[0]),c[1]<m[1]?(l=c[1],u=m[1]):(l=m[1],u=c[1]);let g=Math.floor(f),y=Math.floor(h)+1,S=Math.floor(l),d=Math.floor(u)+1;g<r&&(g=r),y>o-r&&(y=o-r),S<r&&(S=r),d>e-r&&(d=e-r);for(let b=S;b<d;++b){if(c[1]>b==m[1]>b)continue;const k=(e-b-1)*o;for(let v=g;v<y;++v)v<(m[0]-c[0])*(b-c[1])/(m[1]-c[1])+c[0]&&(i[k+v]=-i[k+v]);for(let v=r;v<g;++v)i[k+v]=-i[k+v]}}}}function Et(t,o){const e=2*o,r=t.length,i=new Uint8Array(4*r);for(let n=0;n<r;++n){const s=.5-t[n]/e;xt(s,i,4*n)}return i}const Gt=96/72;class st{static executeEffects(o,e){const r=zt(e),i=Gt;let n=new lt(r);for(const s of o){const a=nt(s);a&&(n=a.execute(n,s,i,!0))}return n}static next(o){const e=o.next();return Jt(e),e}static applyEffects(o,e){if(!o)return e;let r=new lt(e);for(const s of o){const a=nt(s);a&&(r=a.execute(r,s,1,!1))}let i,n=null;for(;i=r.next();)n?ot(n)?ot(i)&&n.paths.push(...i.paths):rt(n)&&rt(i)&&n.rings.push(...i.rings):n=i;return n}}const dt=Pt.getLogger("esri.symbols.cim.cimAnalyzer");function Z(t){switch(t){case"Butt":return 0;case"Square":return 2;default:return 1}}function Q(t){switch(t){case"Bevel":return 0;case"Miter":return 2;default:return 1}}function Dt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function jt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function Ut(t){let o="",e="";if(t){const r=t.toLowerCase();r.indexOf("italic")!==-1?o="italic":r.indexOf("oblique")!==-1&&(o="oblique"),r.indexOf("bold")!==-1?e="bold":r.indexOf("light")!==-1&&(e="lighter")}return{style:o,weight:e}}function qt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function ct(t,o,e,r){let i;t[o]?i=t[o]:(i={},t[o]=i),i[e]=r}function ft(t){const o=t.markerPlacement;return o&&o.angleToLine?1:0}async function he(t,o,e,r,i){const n=r!=null?r:[];if(!t)return n;let s,a;const c={};if(t.type!=="CIMSymbolReference")return dt.error("Expect cim type to be 'CIMSymbolReference'"),n;if(s=t.symbol,a=t.primitiveOverrides,a){const f=[];for(const h of a){const l=h.valueExpressionInfo;if(l&&o){const u=l.expression,g=It(u,o.spatialReference,o.fields).then(y=>{y&&ct(c,h.primitiveName,h.propertyName,y)});f.push(g)}else h.value!=null&&ct(c,h.primitiveName,h.propertyName,h.value)}f.length>0&&await Promise.all(f)}const m=[];switch(St(s,e,m),m.length>0&&await Promise.all(m),s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":Bt(s,a,c,o,n,e,i)}return n}function Bt(t,o,e,r,i,n,s){if(!t)return;const a=t.symbolLayers;if(!a)return;const c=t.effects;let m;const f=X.getSize(t);t.type==="CIMPointSymbol"&&t.angleAlignment==="Map"&&(m=1);let h=a.length;for(;h--;){const l=a[h];if(!l||l.enable===!1)continue;let u;c&&c.length&&(u=[...c]);const g=l.effects;g&&g.length&&(c?u.push(...g):u=[...g]);const y=[];switch(B.findApplicableOverrides(l,o,y),l.type){case"CIMSolidFill":Vt(l,u,e,y,r,i);break;case"CIMPictureFill":Kt(l,u,e,y,r,n,i);break;case"CIMHatchFill":_t(l,u,e,y,r,i);break;case"CIMGradientFill":Zt(l,u,e,y,r,i);break;case"CIMSolidStroke":Qt(l,u,e,y,r,i,t.type==="CIMPolygonSymbol",f);break;case"CIMPictureStroke":te(l,u,e,y,r,i,t.type==="CIMPolygonSymbol",f);break;case"CIMGradientStroke":ee(l,u,e,y,r,i,t.type==="CIMPolygonSymbol",f);break;case"CIMCharacterMarker":if(_(l,u,e,y,r,i))break;break;case"CIMPictureMarker":if(_(l,u,e,y,r,i))break;t.type==="CIMLineSymbol"&&(m=ft(l)),ie(l,u,e,y,r,n,i,m,f);break;case"CIMVectorMarker":if(_(l,u,e,y,r,i))break;t.type==="CIMLineSymbol"&&(m=ft(l)),oe(l,u,e,y,r,i,n,m,f,s);break;default:dt.error("Cannot analyze CIM layer",l.type)}}}function Vt(t,o,e,r,i,n){const s=t.primitiveName,a=J(t.color),[c,m]=Y(r,s),f=M(JSON.stringify(t)+m).toString();n.push({type:"fill",templateHash:f,materialHash:c?()=>f:f,cim:t,materialOverrides:null,colorLocked:t.colorLocked,color:p(s,e,"Color",i,a,$),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:o})}function Kt(t,o,e,r,i,n,s){const a=t.primitiveName,c=t.tintColor?J(t.tintColor):{r:255,g:255,b:255,a:1},[m,f]=Y(r,a),h=M(JSON.stringify(t)+f).toString(),l=M(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();let u=N(t.scaleX);if("width"in t){const g=t.width;let y=1;const S=n.getResource(t.url);ut(S)&&(y=S.width/S.height),u/=y*(t.height/g)}s.push({type:"fill",templateHash:h,materialHash:m?()=>l:l,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:o,color:p(a,e,"TintColor",i,c,$),height:p(a,e,"Height",i,t.height),scaleX:p(a,e,"ScaleX",i,u),angle:p(a,e,"Rotation",i,N(t.rotation)),offsetX:p(a,e,"OffsetX",i,N(t.offsetX)),offsetY:p(a,e,"OffsetY",i,N(t.offsetY)),url:t.url})}function _t(t,o,e,r,i,n){const s=["Rotation","OffsetX","OffsetY"],a=r.filter(u=>u.primitiveName!==t.primitiveName&&s.indexOf(u.propertyName)===-1),c=t.primitiveName,[m,f]=Y(r,c),h=M(JSON.stringify(t)+f).toString(),l=M(`${t.separation}${JSON.stringify(t.lineSymbol)}`).toString();n.push({type:"fill",templateHash:h,materialHash:m?D(l,e,a,i):l,cim:t,materialOverrides:a,colorLocked:t.colorLocked,effects:o,color:{r:255,g:255,b:255,a:1},height:p(c,e,"Separation",i,t.separation),scaleX:1,angle:p(c,e,"Rotation",i,N(t.rotation)),offsetX:p(c,e,"OffsetX",i,N(t.offsetX)),offsetY:p(c,e,"OffsetY",i,N(t.offsetY))})}function Zt(t,o,e,r,i,n){const s=t.primitiveName,[a,c]=Y(r,s),m=M(JSON.stringify(t)+c).toString();n.push({type:"fill",templateHash:m,materialHash:a?D(m,e,r,i):m,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:o,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function Qt(t,o,e,r,i,n,s,a){const c=t.primitiveName,m=J(t.color),f=t.width!==void 0?t.width:4,h=Z(t.capStyle),l=Q(t.joinStyle),u=t.miterLimit,[g,y]=Y(r,c),S=M(JSON.stringify(t)+y).toString();let d,b;if(o&&o.length>0){const k=o[o.length-1];if(k.type==="CIMGeometricEffectDashes"&&k.lineDashEnding==="NoConstraint"){const v=(o=[...t.effects]).pop();d=v.dashTemplate,b=v.scaleDash}}n.push({type:"line",templateHash:S,materialHash:g?()=>S:S,cim:t,materialOverrides:null,isOutline:s,colorLocked:t.colorLocked,effects:o,color:p(c,e,"Color",i,m,$),width:p(c,e,"Width",i,f),cap:p(c,e,"CapStyle",i,h),join:p(c,e,"JoinStyle",i,l),miterLimit:p(c,e,"MiterLimit",i,u),referenceWidth:a,zOrder:tt(t.name),dashTemplate:d,scaleDash:b})}function te(t,o,e,r,i,n,s,a){const c=M(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString(),m=t.primitiveName,f=J(t.tintColor),h=t.width!==void 0?t.width:4,l=Z(t.capStyle),u=Q(t.joinStyle),g=t.miterLimit,[y,S]=Y(r,m),d=M(JSON.stringify(t)+S).toString();n.push({type:"line",templateHash:d,materialHash:y?()=>c:c,cim:t,materialOverrides:null,isOutline:s,colorLocked:t.colorLocked,effects:o,color:p(m,e,"TintColor",i,f,$),width:p(m,e,"Width",i,h),cap:p(m,e,"CapStyle",i,l),join:p(m,e,"JoinStyle",i,u),miterLimit:p(m,e,"MiterLimit",i,g),referenceWidth:a,zOrder:tt(t.name),dashTemplate:null,scaleDash:!1,url:t.url})}function ee(t,o,e,r,i,n,s,a){const c=t.primitiveName,m=t.width!==void 0?t.width:4,f=Z(t.capStyle),h=Q(t.joinStyle),l=t.miterLimit,[u,g]=Y(r,c),y=M(JSON.stringify(t)+g).toString();n.push({type:"line",templateHash:y,materialHash:u?D(y,e,r,i):y,cim:t,materialOverrides:null,isOutline:s,colorLocked:t.colorLocked,effects:o,color:{r:128,g:128,b:128,a:1},width:p(c,e,"Width",i,m),cap:p(c,e,"CapStyle",i,f),join:p(c,e,"JoinStyle",i,h),miterLimit:p(c,e,"MiterLimit",i,l),referenceWidth:a,zOrder:tt(t.name),dashTemplate:null,scaleDash:!1})}function _(t,o,e,r,i,n){const s=t.markerPlacement;if(!s||s.type!=="CIMMarkerPlacementInsidePolygon")return!1;const a=s,c=["Rotation","OffsetX","OffsetY"],m=r.filter(d=>d.primitiveName!==t.primitiveName&&c.indexOf(d.propertyName)===-1),f="url"in t?t.url:null,[h,l]=Y(r,a.primitiveName),u=M(JSON.stringify(t)+l).toString();let g=a.stepY,y=null,S=1;return s.shiftOddRows&&(g*=2,y=function(d){return d?2*d:0},S=.5),n.push({type:"fill",templateHash:u,materialHash:h?D(u,e,m,i):u,cim:t,materialOverrides:m,colorLocked:t.colorLocked,effects:o,color:{r:255,g:255,b:255,a:1},height:p(a.primitiveName,e,"StepY",i,g,y),scaleX:S,angle:p(a.primitiveName,e,"GridAngle",i,a.gridAngle),offsetX:p(a.primitiveName,e,"OffsetX",i,N(a.offsetX)),offsetY:p(a.primitiveName,e,"OffsetY",i,N(a.offsetY)),url:f}),!0}function ie(t,o,e,r,i,n,s,a,c){var m;const f=t.primitiveName,h=N(t.size);let l=N(t.scaleX);const u=N(t.rotation),g=N(t.offsetX),y=N(t.offsetY),S=t.tintColor?J(t.tintColor):{r:255,g:255,b:255,a:1},d=M(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString(),[b,k]=Y(r,f),v=M(JSON.stringify(t)+k).toString(),x=(m=t.anchorPoint)!=null?m:{x:0,y:0};if("width"in t){const P=t.width;let O=1;const C=n.getResource(t.url);ut(C)&&(O=C.width/C.height),l/=O*(h/P)}s.push({type:"marker",templateHash:v,materialHash:b?()=>d:d,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:o,scaleSymbolsProportionally:!1,alignment:a,size:p(f,e,"Size",i,h),scaleX:p(f,e,"ScaleX",i,l),rotation:p(f,e,"Rotation",i,u),offsetX:p(f,e,"OffsetX",i,g),offsetY:p(f,e,"OffsetY",i,y),color:p(f,e,"TintColor",i,S,$),anchorPoint:{x:x.x,y:-x.y},isAbsoluteAnchorPoint:t.anchorPointUnits!=="Relative",outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:t.rotateClockwise,referenceSize:c,sizeRatio:1,markerPlacement:t.markerPlacement,url:t.url})}function oe(t,o,e,r,i,n,s,a,c,m){const f=t.markerGraphics;if(!f)return;let h=0;if(t.scaleSymbolsProportionally){const l=t.frame;l&&(h=l.ymax-l.ymin)}for(const l of f)if(l){const u=l.symbol;if(!u)continue;switch(u.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":ne(t,o,l,r,e,i,n,s,a,c,h,m);break;case"CIMTextSymbol":re(t,o,l,e,r,i,n,a,c,h)}}}function re(t,o,e,r,i,n,s,a,c,m){const f=[];B.findApplicableOverrides(e,i,f);const h=e.geometry;if(!("x"in h)||!("y"in h))return;const l=e.symbol,u=qt(l),g=Ut(l.fontStyleName),y=Ht(l.fontFamilyName);l.font=q({family:y,decoration:u},g);const S=t.frame,d=h.x-.5*(S.xmin+S.xmax),b=h.y-.5*(S.ymin+S.ymax),k=t.size/m,v=t.primitiveName,x=N(l.height)*k,P=N(l.angle),O=(N(l.offsetX)+d)*k,C=(N(l.offsetY)+b)*k,L=J(X.getFillColor(l));let z=J(X.getStrokeColor(l)),w=X.getStrokeWidth(l);w||(z=J(X.getFillColor(l.haloSymbol)),w=l.haloSize*k);const[A,R]=Y(i,v),W=JSON.stringify(t.effects)+Number(t.colorLocked)+JSON.stringify(t.anchorPoint)+t.anchorPointUnits+JSON.stringify(t.markerPlacement),F=M(JSON.stringify(e)+W+R).toString(),H=p(e.primitiveName,r,"TextString",n,e.textString,Yt,l.textCase),{fontStyleName:E}=l,I=y+(E?"-"+E.toLowerCase():"-regular"),G=I;s.push({type:"text",templateHash:F,materialHash:A||typeof H=="function"||H.match(/\[(.*?)\]/)?(j,V,U)=>G+"-"+Rt(H,j,V,U):G+"-"+M(H),cim:l,materialOverrides:null,colorLocked:t.colorLocked,effects:o,alignment:a,anchorPoint:{x:t.anchorPoint?t.anchorPoint.x:0,y:t.anchorPoint?t.anchorPoint.y:0},isAbsoluteAnchorPoint:t.anchorPointUnits!=="Relative",fontName:I,decoration:u,weight:p(v,r,"Weight",n,g.weight),style:p(v,r,"Size",n,g.style),size:p(v,r,"Size",n,x),angle:p(v,r,"Rotation",n,P),offsetX:p(v,r,"OffsetX",n,O),offsetY:p(v,r,"OffsetY",n,C),horizontalAlignment:Dt(l.horizontalAlignment),verticalAlignment:jt(l.verticalAlignment),text:H,color:L,outlineColor:z,outlineSize:w,referenceSize:c,sizeRatio:1,markerPlacement:t.markerPlacement})}function ne(t,o,e,r,i,n,s,a,c,m,f,h){const l=e.symbol,u=l.symbolLayers;if(!u)return;if(h)return void mt(t,o,e,i,r,n,s,a,c,m,f);let g=u.length;if(se(u))return void le(t,e,u,r,i,n,s,c,m,f);const y=st.applyEffects(l.effects,e.geometry);if(y)for(;g--;){const d=u[g];if(d&&d.enable!==!1)switch(d.type){case"CIMSolidFill":case"CIMSolidStroke":{var S;const b=st.applyEffects(d.effects,y),k=yt(b);if(!k)continue;const[v,x,P]=gt(k,t.frame,t.size,t.anchorPoint,t.anchorPointUnits!=="Relative"),O=d.type==="CIMSolidFill",C={type:"sdf",geom:b,asFill:O},L=t.primitiveName,z=(S=N(t.size))!=null?S:10,w=N(t.rotation),A=N(t.offsetX),R=N(t.offsetY),W=d.path,F=d.primitiveName,H=J(O?X.getFillColor(d):X.getStrokeColor(d)),E=O?{r:0,g:0,b:0,a:0}:J(X.getStrokeColor(d)),I=X.getStrokeWidth(d);if(!O&&!I)break;let G=!1,j="";for(const T of r)T.primitiveName!==F&&T.primitiveName!==L||(T.value!==void 0?j+=`-${T.primitiveName}-${T.propertyName}-${JSON.stringify(T.value)}`:T.valueExpressionInfo&&(G=!0));const V=JSON.stringify(K(q({},t),{markerGraphics:null})),U=M(JSON.stringify(C)+W).toString(),vt={type:"marker",templateHash:M(JSON.stringify(e)+JSON.stringify(d)+V+j).toString(),materialHash:G?()=>U:U,cim:C,materialOverrides:null,colorLocked:t.colorLocked,effects:o,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:c,anchorPoint:{x,y:P},isAbsoluteAnchorPoint:!1,size:p(t.primitiveName,i,"Size",n,z),rotation:p(t.primitiveName,i,"Rotation",n,w),offsetX:p(t.primitiveName,i,"OffsetX",n,A),offsetY:p(t.primitiveName,i,"OffsetY",n,R),scaleX:1,frameHeight:f,rotateClockwise:t.rotateClockwise,referenceSize:m,sizeRatio:v,color:p(F,i,"Color",n,H,$),outlineColor:p(F,i,"Color",n,E,$),outlineWidth:p(F,i,"Width",n,I),markerPlacement:t.markerPlacement,path:W};s.push(vt);break}default:mt(t,o,e,i,r,n,s,a,c,m,f)}}}function le(t,o,e,r,i,n,s,a,c,m){const f=o.geometry,h=e[0],l=e[1],u=yt(f);if(!u)return;const[g,y,S]=gt(u,t.frame,t.size,t.anchorPoint,t.anchorPointUnits!=="Relative"),d={type:"sdf",geom:f,asFill:!0},b=t.primitiveName,k=N(t.size),v=N(t.rotation),x=N(t.offsetX),P=N(t.offsetY),O=l.path,C=l.primitiveName,L=h.primitiveName,z=J(X.getFillColor(l)),w=J(X.getStrokeColor(h)),A=X.getStrokeWidth(h);let R=!1,W="";for(const I of r)I.primitiveName!==C&&I.primitiveName!==L&&I.primitiveName!==b||(I.value!==void 0?W+=`-${I.primitiveName}-${I.propertyName}-${JSON.stringify(I.value)}`:I.valueExpressionInfo&&(R=!0));const F=JSON.stringify(K(q({},t),{markerGraphics:null})),H=M(JSON.stringify(d)+O).toString(),E={type:"marker",templateHash:M(JSON.stringify(o)+JSON.stringify(l)+JSON.stringify(h)+F+W).toString(),materialHash:R?()=>H:H,cim:d,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:a,anchorPoint:{x:y,y:S},isAbsoluteAnchorPoint:!1,size:p(t.primitiveName,i,"Size",n,k),rotation:p(t.primitiveName,i,"Rotation",n,v),offsetX:p(t.primitiveName,i,"OffsetX",n,x),offsetY:p(t.primitiveName,i,"OffsetY",n,P),scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:c,sizeRatio:g,color:p(C,i,"Color",n,z,$),outlineColor:p(L,i,"Color",n,w,$),outlineWidth:p(L,i,"Width",n,A),markerPlacement:t.markerPlacement,path:O};s.push(E)}function mt(t,o,e,r,i,n,s,a,c,m,f){const h=ae(t,e);let l=[];const u=["Rotation","OffsetX","OffsetY"];l=i.filter(C=>C.primitiveName!==t.primitiveName||u.indexOf(C.propertyName)===-1);let g="";for(const C of i)C.value!==void 0&&(g+=`-${C.primitiveName}-${C.propertyName}-${JSON.stringify(C.value)}`);const[y,S,d]=X.getTextureAnchor(h,a),b=t.primitiveName,k=N(t.rotation),v=N(t.offsetX),x=N(t.offsetY),P=M(JSON.stringify(h)+g).toString(),O={type:"marker",templateHash:P,materialHash:l.length===0?P:D(P,r,l,n),cim:h,materialOverrides:l,colorLocked:t.colorLocked,effects:o,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:c,anchorPoint:{x:y,y:S},isAbsoluteAnchorPoint:!1,size:t.size,rotation:p(b,r,"Rotation",n,k),offsetX:p(b,r,"OffsetX",n,v),offsetY:p(b,r,"OffsetY",n,x),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:f,rotateClockwise:t.rotateClockwise,referenceSize:m,sizeRatio:d/Lt(t.size),markerPlacement:t.markerPlacement};s.push(O)}function ae(t,o){return{type:t.type,enable:!0,name:t.name,colorLocked:t.colorLocked,primitiveName:t.primitiveName,anchorPoint:t.anchorPoint,anchorPointUnits:t.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:t.rotateClockwise,rotation:0,size:t.size,billboardMode3D:t.billboardMode3D,depth3D:t.depth3D,frame:t.frame,markerGraphics:[o],scaleSymbolsProportionally:t.scaleSymbolsProportionally,respectFrame:t.respectFrame,clippingPath:t.clippingPath}}function tt(t){if(t&&t.indexOf("Level_")===0){const o=parseInt(t.substr(6),10);if(o!==NaN)return o}return 0}function $(t){if(!t||t.length===0)return null;const o=new wt(t).toRgba();return{r:o[0],g:o[1],b:o[2],a:o[3]}}function p(t,o,e,r,i,n,s){const a=o[t];if(a){const c=a[e];if(typeof c=="string"||typeof c=="number"||c instanceof Array)return n?n.call(null,c,s):c;if(c!=null&&c instanceof ht)return(m,f,h)=>{let l=pt(c,m,{$view:h},r.geometryType,f);return l!==null&&n&&(l=n.call(null,l,s)),l!==null?l:i}}return i}function D(t,o,e,r){for(const i of e)if(i.valueExpressionInfo){const n=o[i.primitiveName]&&o[i.primitiveName][i.propertyName];n instanceof ht&&(i.fn=(s,a,c)=>pt(n,s,{$view:c},r.geometryType,a))}return(i,n,s)=>{for(const a of e)a.fn&&(a.value=a.fn(i,n,s));return M(t+B.buildOverrideKey(e)).toString()}}function pe(t,o){if(!o||o.length===0)return t;const e=JSON.parse(JSON.stringify(t));return B.applyOverrides(e,o),e}function Y(t,o){let e=!1,r="";for(const i of t)i.primitiveName===o&&(i.value!==void 0?r+=`-${i.primitiveName}-${i.propertyName}-${JSON.stringify(i.value)}`:i.valueExpressionInfo&&(e=!0));return[e,r]}function St(t,o,e){if(t&&o)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return;for(const i of r)switch(i.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in i&&i.url&&e.push(o.fetchResource(i.url,null));break;case"CIMVectorMarker":{const n=i.markerGraphics;if(!n)continue;for(const s of n)if(s){const a=s.symbol;a&&St(a,o,e)}}}}}}const se=t=>t&&t.length===2&&t[0].enable&&t[1].enable&&t[0].type==="CIMSolidStroke"&&t[1].type==="CIMSolidFill"&&!t[0].effects&&!t[1].effects;export{he as I,st as f,ue as m,pe as q,$t as r};
