import{e as f,i as P,x as u,r as h,ch as F,ci as w}from"./index.89a7b683.js";import{d as l,t as m}from"./popupUtils.85d7881b.js";const L=y=>{let a=class extends y{_validateFetchPopupFeatures(i){const{layer:e}=this,{popupEnabled:s}=e;return s?l(e,i)?void 0:new u("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:e}):new u("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:e})}async prepareFetchPopupFeatures(i){}async fetchPopupFeatures(i,e){const s=this._validateFetchPopupFeatures(e);if(s)return Promise.reject(s);const p=h(e)?e.clientGraphics:null;if(!p||p.length===0)return Promise.resolve([]);const d=this.layer.type==="scene"&&h(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,c=F(this.layer.fieldsIndex,await m(d,l(this.layer,e)));await this.prepareFetchPopupFeatures(c);const n=new Set,o=[],r=[];for(const t of p)w(c,t,n)?r.push(t):o.push(t);return r.length===0?Promise.resolve(o):this.whenGraphicAttributes(r,[...n]).catch(()=>r).then(t=>o.concat(t))}};return a=f([P("esri.views.3d.layers.support.PopupSceneLayerView")],a),a};export{L as c};
