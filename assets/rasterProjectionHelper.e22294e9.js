var Y=Object.defineProperty,_=Object.defineProperties;var nn=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var tn=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable;var $=(n,t,a)=>t in n?Y(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,F=(n,t)=>{for(var a in t||(t={}))tn.call(t,a)&&$(n,a,t[a]);if(T)for(var a of T(t))an.call(t,a)&&$(n,a,t[a]);return n},G=(n,t)=>_(n,nn(t));import{gQ as B,dT as on,at as E,bk as k,E as rn,bn as O,A as z,d as v,aZ as sn,U as en,gR as X}from"./vendor.d423bc92.js";const A=5e-4;function ln(n,t,a){return!sn(n,t,a)}function S(n,t,a){const i=ln(n,t,a);if(i&&!B())throw new en("rasterprojectionhelper-project","projection engine is not loaded");return i}const Q=function(n,t,a){const i=(n[0]+n[4]+n[4*t.cols]+n[4*t.cols+4])/4,r=(n[1]+n[5]+n[4*t.rows+1]+n[4*t.rows+5])/4,o=(n[4*t.cols]-n[0]+n[4*t.cols+4]-n[4])/a[0]*.5,s=(n[4*t.cols+1]-n[1]+n[4*t.cols+5]-n[5])/a[1]*.5;return[o===0||isNaN(o)?0:Math.abs(i-n[2*t.rows+2])/Math.abs(o),s===0||isNaN(s)?0:Math.abs(r-n[2*t.rows+3])/Math.abs(s)]},cn={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},I=32,L=4,fn=L;async function yn(){if(B())return null;await on()}function dn(n,t,a){return S(n.spatialReference,t)?a?X(t,n.spatialReference,n):X(n.spatialReference,t,n):null}function Mn(n,t,a,i=null){if(n.spatialReference.equals(t))return n;S(n.spatialReference,t,i);const r=a.center,o=new E({xmin:r.x-n.x/2,xmax:r.x+n.x/2,ymin:r.y-n.y/2,ymax:r.y+n.y/2,spatialReference:n.spatialReference}),s=k(o,t,i);return rn(s)?null:{x:s.xmax-s.xmin,y:s.ymax-s.ymin}}function H(n,t=.01){return O(n)?t/O(n):0}function J(n,t,a=null,i=!0){const r=n.spatialReference;if(r.equals(t))return n;S(r,t,a);const o=k(n,t,a);if(i&&t.isGeographic){const[s,e]=q(r,!0),c=H(r);c&&s!=null&&e!=null&&(Math.abs(n.x-s)<c&&Math.abs(180-o.x)<A?o.x-=360:Math.abs(n.x-e)<c&&Math.abs(180+o.x)<A&&(o.x+=360))}return o}function un(n,t,a=null){const i=n[0].spatialReference;return i.equals(t)?n:(S(i,t,a),k(n,t,a))}function U(n){const t=P(n[0].spatialReference);if(n.length<2||!z(t))return n[0];let{xmin:a,xmax:i,ymin:r,ymax:o}=n[0];for(let s=1;s<n.length;s++){const e=n[s];i=e.xmax+t*s,r=Math.min(r,e.ymin),o=Math.max(o,e.ymax)}return new E({xmin:a,xmax:i,ymin:r,ymax:o,spatialReference:n[0].spatialReference})}function gn(n,t,a=null,i=!0){if(n.spatialReference.equals(t))return n;const r=xn(n),o=P(n.spatialReference,!0);return!z(o)||r===0?Z(n,t,a,i):U(n.clone().normalize().map(s=>Z(s,t,a,i)))}function Z(n,t,a=null,i=!0){const r=n.spatialReference;if(r.equals(t))return n;S(r,t,a);const o=k(n,t,a);let[s,e]=q(r,!0);if(o&&i&&r.isWebMercator&&t.isGeographic&&s!=null&&e!=null){const h=.001,f=1e3;if(Math.abs(n.xmin-s)<h&&Math.abs(e-n.xmax)>f&&Math.abs(180-o.xmax)<A){o.xmin=-180;const m=[];m.push(new v(n.xmax,n.ymin,r)),m.push(new v(n.xmax,(n.ymin+n.ymax)/2,r)),m.push(new v(n.xmax,n.ymax,r));const u=m.map(x=>J(x,t,a)).filter(x=>!isNaN(x==null?void 0:x.x)).map(x=>x.x);o.xmax=Math.max.apply(null,u)}if(Math.abs(n.xmax-e)<h&&Math.abs(s-n.xmin)>f&&Math.abs(180+o.xmin)<A){o.xmax=180;const m=[];m.push(new v(n.xmin,n.ymin,r)),m.push(new v(n.xmin,(n.ymin+n.ymax)/2,r)),m.push(new v(n.xmin,n.ymax,r));const u=m.map(x=>J(x,t,a)).filter(x=>!isNaN(x==null?void 0:x.x)).map(x=>x.x);o.xmin=Math.min.apply(null,u)}}[s,e]=q(t,!0);const c=H(t);return c&&s!=null&&e!=null&&o&&(Math.abs(o.xmin-s)<c&&(o.xmin=s),Math.abs(o.xmax-e)<c&&(o.xmax=e)),o}function P(n,t=!1){const a=t?20037508342787e-6:20037508342788905e-9;return n.isWebMercator?2*a:n.wkid&&n.isGeographic?360:2*cn[n.wkid]||null}function q(n,t=!1){const a=[],i=P(n,t);return z(i)&&(a.push(-i/2),a.push(i/2)),a}function D(n,t,a,i){let r=(n-t)/a;return r-Math.floor(r)!=0?r=Math.floor(r):i&&(r-=1),r}function xn(n,t=!1){const a=P(n.spatialReference);if(!z(a))return 0;const i=t?0:-(a/2);return D(n.xmax,i,a,!0)-D(n.xmin,i,a,!1)}function wn(n){const t=n.storageInfo.origin.x,a=P(n.spatialReference,!0);if(!z(a))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const i=a/2,{nativePixelSize:r,storageInfo:o,extent:s}=n,{maximumPyramidLevel:e,blockWidth:c,pyramidScalingFactor:h}=o;let f=r.x;const m=[],u=z(n.transform)&&n.transform.type==="gcs-shift",x=t+(u?0:i),M=u?a-t:i-t;for(let g=0;g<=e;g++){const p=(s.xmax-t)/f/c,w=p-Math.floor(p)==0?p:Math.ceil(p),d=M/f/c,l=d-Math.floor(d)==0?d:Math.ceil(d),R=Math.floor(x/f/c),y=Math.round(x/f)%c,j=(c-Math.round(M/f)%c)%c;m.push({resolutionX:f,blockWidth:c,datsetColumnCount:w,worldColumnCountFromOrigin:l,leftMargin:y,rightPadding:j,originColumnOffset:R}),f*=h}return{originX:t,halfWorldWidth:i,pyramidsInfo:m,hasGCSSShiftTransform:u}}function Rn(n){const t=n.isAdaptive&&n.spacing==null,a=n.spacing||[I,I];let i=K(n),r={cols:i.size[0]+1,rows:i.size[1]+1},o=Q(i.offsets,r,a);const s=(o[0]+o[1])/2,e=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;return t&&(e||s>fn)&&(i=K(G(F({},n),{spacing:[L,L]})),r={cols:i.size[0]+1,rows:i.size[1]+1},o=Q(i.offsets,r,a)),i.error=o,i.coefficients=mn(i.offsets,r,e),i}function K(n){const{projectedExtent:t,srcBufferExtent:a,pixelSize:i,datumTransformation:r,rasterTransform:o}=n,s=t.spatialReference,e=a.spatialReference;S(s,e);const{xmin:c,ymin:h,xmax:f,ymax:m}=t,u=P(e),x=n.hasWrapAround||(o==null?void 0:o.type)==="gcs-shift",M=n.spacing||[I,I],g={x:M[0]*i.x,y:M[1]*i.y},p={cols:Math.ceil((f-c)/g.x-.1/M[0])+1,rows:Math.ceil((m-h)/g.y-.1/M[1])+1},w=g.x,d=g.y,l=[];let R,y=0;const j=[];for(let N=0;N<p.cols;N++)for(let C=0;C<p.rows;C++)j.push(new v({x:c+w*N,y:m-d*C,spatialReference:s}));const V=un(j,e,r);for(let N=0;N<p.cols;N++){const C=[];for(let W=0;W<p.rows;W++){let b=V[N*p.rows+W];o&&(b=o.inverseTransform(b)),C.push(b),N>0&&x&&b&&R[W]&&z(u)&&b.x<R[W].x&&(b.x+=u),b?(l.push((b.x-a.xmin)/(a.xmax-a.xmin)),l.push((a.ymax-b.y)/(a.ymax-a.ymin))):(l.push(NaN),l.push(NaN),y++)}R=C}return{offsets:l,error:null,coefficients:null,outofBoundPointCount:y,spacing:M,size:[p.cols-1,p.rows-1]}}function mn(n,t,a){const{cols:i,rows:r}=t,o=new Float32Array((i-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),e=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let c=0;c<i-1;c++){for(let h=0;h<r-1;h++){let f=c*r*2+2*h;const m=n[f],u=n[f+1],x=n[f+2],M=n[f+3];f+=2*r;const g=n[f],p=n[f+1],w=n[f+2],d=n[f+3];let l=0,R=12*(h*(i-1)+c);for(let y=0;y<3;y++)o[R++]=s[l++]*m+s[l++]*x+s[l++]*w;l=0;for(let y=0;y<3;y++)o[R++]=s[l++]*u+s[l++]*M+s[l++]*d;l=0;for(let y=0;y<3;y++)o[R++]=e[l++]*m+e[l++]*g+e[l++]*w;l=0;for(let y=0;y<3;y++)o[R++]=e[l++]*u+e[l++]*p+e[l++]*d}if(a)for(let h=0;h<o.length;h++)isNaN(o[h])&&(o[h]=-1)}return o}function bn(n){const t=n.clone().normalize();return t.length===1?t[0]:U(t)}function vn(n,t,a){const{storageInfo:i,pixelSize:r}=t;let o,s=!1;const{pyramidResolutions:e}=i;if(z(e)&&e.length){const u=(n.x+n.y)/2,x=e[e.length-1],M=(x.x+x.y)/2,g=(r.x+r.y)/2;if(u<=g)o=0;else if(u>=M)o=e.length,s=u/M>8;else{let w,d=g;for(let l=1;l<=e.length;l++){if(w=(e[l-1].x+e[l-1].y)/2,u<=w){u===w?o=l:a==="down"?(o=l-1,s=u/d>8):o=a==="up"||u-d>w-u||u/d>2?l:l-1;break}d=w}}const p=o===0?r:e[o-1];return{pyramidLevel:o,pyramidResolution:new v({x:p.x,y:p.y,spatialReference:t.spatialReference}),excessiveReading:s}}const c=Math.log(n.x/r.x)/Math.LN2,h=Math.log(n.y/r.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;o=a==="down"?Math.floor(Math.min(c,h)):a==="up"?Math.ceil(Math.max(c,h)):Math.round((c+h)/2),o<0?o=0:o>f&&(s=o>f+3,o=f);const m=2**o;return{pyramidLevel:o,pyramidResolution:new v({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}export{vn as A,xn as G,Rn as L,P,Mn as R,wn as T,yn as d,gn as j,bn as q,J as v,dn as w,ln as x};
