var xe=Object.defineProperty;var R=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var k=(e,i,t)=>i in e?xe(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,D=(e,i)=>{for(var t in i||(i={}))ze.call(i,t)&&k(e,t,i[t]);if(R)for(var t of R(i))De.call(i,t)&&k(e,t,i[t]);return e};import{iO as We,iy as ee,fZ as Te,aB as ie,bM as c,bK as te,bL as Le,bN as Oe,bR as Ue,bO as Fe,bP as je,iP as Me,e as r,bT as u,bU as ae,bV as se,bW as re,bX as ne,bZ as oe,b_ as Ne,b$ as le,iQ as Re,c0 as ke,c1 as de,ir as Ae,c2 as Ge,c3 as Be,c5 as Ie,c6 as He,c7 as ce,iR as qe,cN as Ze,h4 as L,a7 as Ke,bx as he,id as b,h5 as Xe,X as Je,bY as Ye,hH as Qe,bq as ei,bs as ii,bu as ti,bv as ai,hI as si,aJ as A,gO as G,d_ as B,r as d,bn as ri,d as l,gW as I,i as V,dK as ni,dJ as oi,iw as li,iS as H,iT as q,Z as ue,t as h,iU as pe,dM as P,iV as ge,ip as Z,iW as ve,iX as j,a1 as di,hg as ci,iY as hi,iZ as O,i_ as ui,hf as K,aA as X,i$ as pi,fG as gi,p as x,u as ye,j as J,j0 as vi,hL as m,aw as U,hM as Y,f as S,ax as yi,j1 as wi,j2 as Q,ds as mi,hK as bi}from"./index.89a7b683.js";import{c as fi,m as _i,p as $i}from"./LineVisualElement.47192886.js";import{U as Vi}from"./BuildingComponentSublayer.a97506cb.js";import"./ImageMaterialTechnique.971b25d8.js";import{g as $}from"./persistable.272e3621.js";function Ci(e,i,t){t.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${i.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}We();ee();Te();new ie({x:0,y:0,z:0,spatialReference:null});function Pi(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(c`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function Si(e,i,t){e.setUniform1f("perScreenPixelRatio",t.camera.perScreenPixelRatio),e.setUniform1f("screenSize",i.screenSize)}function Ei(e){const i=new te;return i.include(Le,{linearDepth:!1}),i.include(Pi,{}),i.include(Oe,e),i.fragment.include(Ue),i.vertex.uniforms.add("proj","mat4").add("view","mat4"),i.fragment.uniforms.add("color","vec4"),i.attributes.add("position","vec3"),i.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&i.varyings.add("depth","float"),e.screenSizeEnabled&&i.attributes.add("offset","vec3"),e.shadingEnabled&&(i.vertex.uniforms.add("viewNormal","mat4"),i.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),i.attributes.add("normal","vec3"),i.varyings.add("vViewNormal","vec3")),i.vertex.code.add(c`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&i.vertex.code.add(c`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),i.vertex.code.add(c`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(i.fragment.include(Fe),i.include(je,e)),i.fragment.code.add(c`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?i.fragment.code.add(c`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):i.fragment.code.add(c`vec4 finalColor = color;`),i.fragment.code.add(c`
      if (finalColor.a < ${c.float(Me)}) {
        discard;
      }
      ${e.output===7?c`gl_FragColor = vec4(finalColor.a);`:""}

      ${e.output===0?c`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),i}const xi=Object.freeze({__proto__:null,build:Ei});class M extends re{initializeProgram(i){const t=M.shader.get(),a=this.configuration,s=t.build({output:a.output,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:a.screenSizeEnabled,shadingEnabled:a.shadingEnabled,OITEnabled:a.transparencyPassType===0,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new ne(i.rctx,s,zi)}bindPass(i,t){const{screenSizeEnabled:a,shadingEnabled:s}=this.configuration,{color:n,shadingTint:o,shadingDirection:_}=i;oe(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",n),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Ne(this.program,t)),s&&(this.program.setUniform4fv("shadedColor",this.blendColor(Di,o,n)),this.program.setUniform3fv("shadingDirection",_),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),a&&Si(this.program,i,t)}bindDraw(i){le(this.program,i),Re(this.program,i.origin,i.camera.viewInverseTransposeMatrix),ke(this.program,this.configuration,i),this.program.rebindTextures()}blendColor(i,t,a){const s=1-t[3],n=t[3]+a[3]*s;return n===0?(i[3]=n,i):(i[0]=(t[0]*t[3]+a[0]*a[3]*s)/n,i[1]=(t[1]*t[3]+a[1]*a[3]*s)/n,i[2]=(t[2]*t[3]+a[2]*a[3]*s)/n,i[3]=a[3],i)}setPipelineState(i){const t=this.configuration,a=i===3,s=i===2;return de({blending:t.output!==0&&t.output!==7||!t.transparent?null:a?Ae:Ge(i),culling:Be(t.cullFace),depthTest:{func:s?513:t.shadingEnabled?515:513},depthWrite:a?t.writeDepth&&Ie:He(i),colorWrite:ce,polygonOffset:a||s?null:qe})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}M.shader=new ae(xi,()=>import("./ShadedColorMaterial.glsl.faf706cd.js"));class p extends se{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}r([u({count:8})],p.prototype,"output",void 0),r([u({count:3})],p.prototype,"cullFace",void 0),r([u()],p.prototype,"slicePlaneEnabled",void 0),r([u()],p.prototype,"transparent",void 0),r([u()],p.prototype,"writeDepth",void 0),r([u()],p.prototype,"screenSizeEnabled",void 0),r([u()],p.prototype,"shadingEnabled",void 0),r([u({count:4})],p.prototype,"transparencyPassType",void 0),r([u()],p.prototype,"multipassTerrainEnabled",void 0),r([u()],p.prototype,"cullAboveGround",void 0);const zi=new Map([["position",0],["normal",1],["offset",2]]),Di=Ze();D({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:L(Ke(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},he);function Wi(e,i,t,a){const s=L(b.get(),e),n=L(b.get(),i),o=Xe(b.get(),s,n);return a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=0,a[4]=n[0],a[5]=n[1],a[6]=n[2],a[7]=0,a[8]=o[0],a[9]=o[1],a[10]=o[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}Je("mac");const Ti=.7,we=[1,.5,0],Li=2,me=1,be=[...we,Ti],fe=[0,0,0,.04],_e=[...we,.5];function Oi(){const e=new te;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(c`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(c`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const Ui=Object.freeze({__proto__:null,build:Oi});class z extends re{initializeProgram(i){const t=z.shader.get().build();return new ne(i.rctx,t,Ye)}bindPass(i,t){oe(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",i.backgroundColor),this.program.setUniform4fv("gridColor",i.gridColor),this.program.setUniform1f("gridWidth",i.gridWidth)}bindDraw(i){le(this.program,i),this.program.rebindTextures()}initializePipeline(){return de({blending:Qe(1,1,771,771),depthTest:{func:513},colorWrite:ce})}}z.shader=new ae(Ui,()=>import("./SlicePlaneMaterial.glsl.a536ed8d.js"));class Fi extends ei{constructor(i){super(i,Mi),this._config=new se}intersect(i,t,a,s,n,o,_){return ii(i,t,s,n,o,void 0,_)}createBufferWriter(){return new ti(ai)}requiresSlot(i){return i===7}createGLMaterial(i){return i.output===0?new ji(i):null}getTechniqueConfig(){return this._config}}class ji extends si{constructor(i){super(i),this.ensureTechnique(z,null)}updateParameters(){return A(this.technique)}beginSlot(){return A(this.technique)}bind(i,t){t.bindPass(this._material.parameters,i)}}const Mi=D({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},he);class Ni extends fi{constructor(i){super(i),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=G(1,0,0,1),this._backgroundColor=G(1,0,0,1),this.applyProps(i)}get renderOccluded(){return this._renderOccluded}set renderOccluded(i){i!==this._renderOccluded&&(this._renderOccluded=i,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(i){this._gridWidth!==i&&(this._gridWidth=i,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(i){B(this._gridColor,i),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(i){B(this._backgroundColor,i),this._updateMaterial()}createExternalResources(){this._material=new Fi(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(i){d(this._material)&&i(this._material)}createGeometries(i){if(d(this._material)){const t=ri.createSquareGeometry();i.addGeometry(t,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){d(this._material)&&this._material.setParameters(this.materialParameters)}}var F;let v=F=class extends ni{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new F({position:oi(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&li(this.position,e.position)&&this.width===e.width&&this.height===e.height}};r([l({readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),r([l({type:ie}),$()],v.prototype,"position",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:360}}),$(),I(e=>H.normalize(q(e),0,!0))],v.prototype,"heading",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:360}}),$(),I(e=>H.normalize(q(e),0,!0))],v.prototype,"tilt",void 0),r([l({type:Number,nonNullable:!0}),$()],v.prototype,"width",void 0),r([l({type:Number,nonNullable:!0}),$()],v.prototype,"height",void 0),v=F=r([V("esri.widgets.Slice.SlicePlane")],v);const $e=v,Ri=ue.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function ki(e,i,t){const a=i.worldUpAtPosition(e.origin,b.get()),s=e.basis1,n=Ve(e,a),o=Math.round(n/E)*E;return O(e,o-n,s,t)}function Ai(e,i){return Wi(e.basis1,e.basis2,e.origin,i)}function Gi(e){return new _i({view:e,attached:!0,color:be,width:me,writeDepthEnabled:!1,renderOccluded:4,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function Bi(e){return new Ni({view:e,attached:!0,backgroundColor:[...fe],gridColor:_e,gridWidth:4,renderOccluded:4})}function Ii(e,i,t,a=new $e){if(h(e))return null;const{renderCoordsHelper:s}=i,n=s.fromRenderCoords(e.origin,i.spatialReference);if(h(n))return null;const o=pe(n,t);if(h(o))return null;a.position=o;const _=s.worldUpAtPosition(e.origin,b.get()),Pe=s.worldBasisAtPosition(e.origin,1,b.get()),Se=2*P(e.basis1),Ee=2*P(e.basis2),N=ge.renderUnitScaleFactor(i.spatialReference,t);return a.width=Se*N,a.height=Ee*N,a.tilt=Z(Ve(e,_)),a.heading=Z(Hi(e,_,Pe)),a}function Ve(e,i){return ve(i,e.basis2,e.basis1)+E}function Hi(e,i,t){return ve(e.basis1,t,i)-E}function qi(e,i,t,a,s,n,o=j()){return n.toRenderCoords(e,o.origin)?(n.worldBasisAtPosition(o.origin,0,o.basis1),n.worldBasisAtPosition(o.origin,1,o.basis2),hi(o.basis2,o.basis1,o.origin,o.plane),O(o,-K(i),ui(o),o),O(o,K(t),o.basis1,o),X(o.basis1,o.basis1,a/2),X(o.basis2,o.basis2,s/2),pi(o),o):(Ri.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Zi(e,i){if(h(e)||h(e.position))return null;const t=pe(e.position,i);if(h(t))return null;const a=ge.renderUnitScaleFactor(e.position.spatialReference,i),s=e.width*a,n=e.height*a;return{position:t,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:n}}function Ki(e,i,t,a=j()){if(h(e))return null;let s=e.position;!e.position.hasZ&&d(i.elevationProvider)&&(s=e.position.clone(),s.z=di(ci(i.elevationProvider,e.position),0));const n=qi(s,e.heading,e.tilt,e.renderWidth,e.renderHeight,i.renderCoordsHelper,a);return!t.tiltEnabled&&d(n)&&ki(n,i.renderCoordsHelper,n),n}function Xi(e){switch(e.type){case"analysis":case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return gi(e.type),!1}}ee();const E=Math.PI/2;function Ji(e){const i=e.type==="building-scene-3d"?e:null;return d(i)}const W=ue.getLogger("esri.views.3d.analysis.Slice.SliceController");let y=class extends x{constructor(e){super(e),this._handles=new ye,this._internalChange=!1,this._currentSlicePlane=null,this.state="pending"}get ready(){return this.state==="ready"}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const i=e.item;i!=null&&(i instanceof J||i instanceof Vi)?i instanceof J&&Xi(i)?(W.error("excludedLayers",`Layer '${i.title}, id:${i.id}' of type '${i.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(i)&&e.preventDefault():(W.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),this._handles.add(vi(()=>this.view.ready&&d(this.view.renderCoordsHelper),()=>this._initialize(),{sync:!0,initial:!0,once:!0}))}_initialize(){this.state!=="destroyed"&&this.state!=="ready"&&(Qi(this.view,this),this._handles.add([m(()=>this.analysisView.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),m(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),m(()=>[this.analysisView.active,this.analysisView.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),m(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([m(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}destroy(){this.state!=="destroyed"&&this.state!=="pending"&&(this.analysisView.active=!1,et(this.view,this),this._handles.destroy(),this.view.slicePlane=null,this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await U(this,"ready"),this}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(Ji).flatMap(({sublayerViews:i})=>i.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,i=this._currentSlicePlane;if(h(i)&&h(e)||d(i)&&d(e)&&e.equals(i))return;let t=null,a=null;if(d(e)&&d(e.position)){const s=e.position.spatialReference,n=Zi(e,this.view.spatialReference);h(n)&&Ci(this.analysis,s,W),t=Ki(n,this.view,{tiltEnabled:this.analysis.tiltEnabled},j()),d(t)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisView.analysisViewData.plane=t,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisView.analysisViewData.plane,i=Ii(e,this.view,this.view.spatialReference,new $e);let t=null;d(i)&&(t={heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}),this._currentSlicePlane=t,this._internalChange=!0,this.analysis.shape=i,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(T)return;const e=Ce(this.view);if(this.analysisView.active)d(e.activeController)&&e.activeController!==this?(T=!0,e.activeController.analysisView.active=!1,T=!1):d(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(d(e.activeController)&&e.activeController!==this)return;d(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){this.state==="ready"&&Yi(this.view)}_updateLayerViews(){const e=d(this.analysisView.analysisViewData.plane)&&this.analysisView.visible&&this.analysisView.active,i=[],t=a=>{"layers"in a?a.layers.forEach(t):i.push(a)};this.analysis.excludedLayers.forEach(t),this.view.allLayerViews.forEach(a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&i.indexOf(a.layer)<0),"sublayerViews"in a&&a.sublayerViews.forEach(s=>{s.slicePlaneEnabled=e&&i.indexOf(s.sublayer)<0}))}),this.view.basemapTerrain!=null&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};r([l({readOnly:!0})],y.prototype,"state",void 0),r([l()],y.prototype,"view",void 0),r([l()],y.prototype,"analysis",void 0),r([l()],y.prototype,"analysisView",void 0),r([l()],y.prototype,"ready",null),r([l()],y.prototype,"_allLayerAndSubLayerViews",null),y=r([V("esri.views.3d.analysis.Slice.SliceController")],y);const f=new Map;let T=!1;function Yi(e){const i=Ce(e).activeController;d(i)&&d(i.analysisView.analysisViewData.plane)&&i.analysisView.visible?e.slicePlane=i.analysisView.analysisViewData.plane:e.slicePlane=null}function Qi(e,i){f.has(e)||f.set(e,{all:[],activeController:null}),f.get(e).all.push(i)}function Ce(e){return f.get(e)}function et(e,i){if(!f.has(e))throw new Error("view expected in global slice register");const t=f.get(e),a=t.all.lastIndexOf(i);if(a===-1)throw new Error("controller expected in global slice register");t.all.splice(a,1),t.all.length===0&&f.delete(e)}let C=class extends x{constructor(){super(...arguments),this.plane=null}};r([l()],C.prototype,"plane",void 0),C=r([V("esri.views.3d.analysis.Slice.SliceViewData")],C);let g=class extends x{constructor(e){super(e),this._handles=new ye,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.editable=!0}get ready(){return this.state==="ready"}initialize(){this._initialize()}async _initialize(){if(this.state==="destroyed"||this.state==="ready")return;await U(this.view,"ready",!0);const e=this.analysisView.analysisViewData;if(h(e))throw new Error("expected internal object to be valid");this._gridVisualElement=Bi(this.view),this._outlineVisualElement=Gi(this.view),this._handles.add([m(()=>({visible:d(e.plane)&&this.analysisView.visible,active:this.analysisView.active,editable:this.editable,showGrid:this.showGrid}),i=>this._updateMaterials(i),Y),m(()=>e.plane,i=>this._updatePlane(i),Y)],"internal"),this._set("state","ready")}destroy(){this.state!=="destroyed"&&this.state!=="pending"&&(this._handles.destroy(),this._gridVisualElement=S(this._gridVisualElement),this._outlineVisualElement=S(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await U(this,"ready"),this}_updatePlane(e){if(h(e))return;const i=yi(b.get(),P(e.basis1),P(e.basis2),1),t=wi(Q.get(),i),a=Ai(e,Q.get()),s=mi(t,a,t);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:i,editable:t,showGrid:a}){this._outlineVisualElement.color=be,this._outlineVisualElement.width=t?me:Li,this._outlineVisualElement.stipplePattern=i?null:bi(5);const s=a?_e:[0,0,0,0];this._gridVisualElement.backgroundColor=fe,this._gridVisualElement.gridColor=s,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};r([l({readOnly:!0})],g.prototype,"state",void 0),r([l()],g.prototype,"view",void 0),r([l()],g.prototype,"analysis",void 0),r([l()],g.prototype,"analysisView",void 0),r([l()],g.prototype,"ready",null),r([l()],g.prototype,"showGrid",void 0),r([l()],g.prototype,"editable",void 0),g=r([V("esri.views.3d.analysis.Slice.SliceVisualization")],g);let w=class extends $i(x){constructor(e){super(e),this.type="slice-view",this.analysisVisualization=null,this.analysisController=null,this.analysisViewData=new C,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisVisualization=new g({view:this.view,analysis:this.analysis,analysisView:this}),this.analysisController=new y({view:this.view,analysis:this.analysis,analysisView:this})}destroy(){this.analysisVisualization=S(this.analysisVisualization),this.analysisController=S(this.analysisController)}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController}}};r([l()],w.prototype,"type",void 0),r([l()],w.prototype,"analysis",void 0),r([l()],w.prototype,"analysisViewData",void 0),r([l()],w.prototype,"active",void 0),r([l({aliasOf:"analysisVisualization.showGrid"})],w.prototype,"showGrid",void 0),r([l({aliasOf:"analysisVisualization.editable"})],w.prototype,"editable",void 0),w=r([V("esri.views.3d.analysis.Slice.SliceView3D")],w);const it=w;var lt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:it});export{lt as S,Oi as r,Ei as t};
