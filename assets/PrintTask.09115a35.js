var ie=Object.defineProperty;var W=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var B=(e,r,t)=>r in e?ie(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,k=(e,r)=>{for(var t in r||(r={}))oe.call(r,t)&&B(e,t,r[t]);if(W)for(var t of W(r))se.call(r,t)&&B(e,t,r[t]);return e};import{dh as O,jQ as le,hi as P,dP as ue,dQ as ce,jR as ye,r as S,t as v,w as q,z as fe,bu as Q,jS as pe,jT as de,A,jz as N,fu as me,v as ge,jU as he,ft as be,jV as we,jW as Se,jX as ve,jy as H,js as xe,gB as J,U as De,jI as Ie}from"./vendor.d423bc92.js";const R=new O({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"});R.fromJSON.bind(R);const Le=R.toJSON.bind(R),$=new O({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"});$.fromJSON.bind($);const Te=$.toJSON.bind($),_="simple-marker",Ve="picture-marker",X="simple-line",Me="simple-fill",Pe="shield-label-symbol",Ee="text";function Oe(e,r){const{graphic:t,renderer:n,symbol:i}=r,a=i.type;if(a===Ee||a===Pe||!("visualVariables"in n)||!n.visualVariables)return;const s=n.getVisualVariablesForType("size"),c=n.getVisualVariablesForType("color"),o=n.getVisualVariablesForType("opacity"),l=n.getVisualVariablesForType("rotation"),p=s[0],d=c[0],y=o[0],w=l[0];if(p){const m=a===_?i.style:null,g=le(p,t,{shape:m});g!=null&&(a===_?e.size=P(g):a===Ve?(e.width=P(g),e.height=P(g)):a===X?e.width=P(g):e.outline&&(e.outline.width=P(g)))}if(d){const m=ue(d,t);(m&&a===_||a===X||a===Me)&&(e.color=m?m.toJSON():void 0)}if(y){const m=ce(y,t);m!=null&&e.color&&(e.color[3]=Math.round(255*m))}w&&(e.angle=-ye(n,t))}function Ae(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function Ne(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function Y(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function Fe(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function ke(e,r=15){const t=e.canvas.width,n=e.canvas.height,i=e.getImageData(0,0,t,n).data;let a,s,c,o,l,p;e:for(s=n;s--;)for(a=t;a--;)if(i[4*(t*s+a)+3]>r){p=s;break e}if(!p)return null;e:for(a=t;a--;)for(s=p+1;s--;)if(i[4*(t*s+a)+3]>r){l=a;break e}e:for(a=0;a<=l;++a)for(s=p+1;s--;)if(i[4*(t*s+a)+3]>r){c=a;break e}e:for(s=0;s<=p;++s)for(a=c;a<=l;++a)if(i[4*(t*s+a)+3]>r){o=s;break e}return{x:c,y:o,width:l-c,height:p-o}}function Je(e,r){const t=e.allLayerViews.items;if(r===e.scale)return t.filter(i=>!i.suspended);const n=new Array;for(const i of t)ze(i.parent)&&!n.includes(i.parent)||!i.visible||r&&"isVisibleAtScale"in i&&!i.isVisibleAtScale(r)||n.push(i);return n}function Re(e){return e&&e.type==="bing-maps"}function Z(e){return e&&"blendMode"in e&&"effect"in e}function $e(e){return e&&e.type==="csv"}function Ce(e){return e&&e.type==="feature"}function Ue(e){return e&&e.type==="geojson"}function Ge(e){return e&&e.type==="graphics"}function je(e){return e&&e.type==="group"}function ze(e){return e&&e.declaredClass==="esri.views.2d.layers.GroupLayerView2D"}function _e(e){return e&&e.type==="imagery"}function Ke(e){return e&&e.type==="imagery-tile"}function We(e){return e&&e.type==="kml"}function Be(e){return e&&e.type==="map-image"}function qe(e){return e&&e.type==="map-notes"}function Qe(e){return e&&e.type==="open-street-map"}function He(e){const r=e.layer;if(Z(r)){const t=r.blendMode;if((!t||t==="normal")&&(r.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}function Xe(e){return e&&e.type==="stream"}function Ye(e){return e&&e.type==="tile"}function Ze(e){return e&&e.type==="vector-tile"}function et(e){return e&&e.type==="web-tile"}function tt(e){return e&&e.type==="wms"}function rt(e){return e&&e.type==="wmts"}let x=class extends fe{constructor(e){super(e),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.label=null,this.layout="map-only",this.layoutOptions=null,this.outScale=0,this.scalePreserved=!0,this.showLabels=!0}};S([v()],x.prototype,"attributionVisible",void 0),S([v()],x.prototype,"exportOptions",void 0),S([v()],x.prototype,"forceFeatureAttributes",void 0),S([v()],x.prototype,"format",void 0),S([v()],x.prototype,"label",void 0),S([v()],x.prototype,"layout",void 0),S([v()],x.prototype,"layoutOptions",void 0),S([v()],x.prototype,"outScale",void 0),S([v()],x.prototype,"scalePreserved",void 0),S([v()],x.prototype,"showLabels",void 0),x=S([q("esri.rest.support.PrintTemplate")],x);const nt=x,ee={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},te=new O({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),at=new O({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),C=new Map;async function it(e,r,t){const n=ne(e);let i=C.get(n);return Promise.resolve().then(()=>i?{data:i.gpMetadata}:(i={gpServerUrl:n,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},Q(n,{query:{f:"json"}}))).then(a=>(i.gpMetadata=a.data,i.cimVersion=i.gpMetadata.cimVersion,i.is11xService=!!i.cimVersion,C.set(n,i),re(r,i))).then(a=>{const s=Lt(i);let c;const o=l=>s==="sync"?l.results&&l.results[0]&&l.results[0].value:c.fetchResultData("Output_File",null,t).then(p=>p.value);return s==="async"?pe(e,a,null,t).then(l=>(c=l,l.waitForJobCompletion({interval:r.updateDelay}).then(o))):de(e,a,null,t).then(o)})}async function re(e,r){r=r||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const t=e.template||new nt;t.showLabels==null&&(t.showLabels=!0);const n=t.exportOptions;let i;const a=Te(t.layout);if(n&&(i={dpi:n.dpi},a.toLowerCase()==="map_only"||a==="")){const d=n.width,y=n.height;i.outputSize=[d,y]}const s=t.layoutOptions;let c;if(s){let d,y;s.scalebarUnit==="Miles"||s.scalebarUnit==="Kilometers"?(d="Kilometers",y="Miles"):s.scalebarUnit!=="Meters"&&s.scalebarUnit!=="Feet"||(d="Meters",y="Feet"),c={titleText:s.titleText,authorText:s.authorText,copyrightText:s.copyrightText,customTextElements:s.customTextElements,scaleBarOptions:{metricUnit:te.toJSON(d),metricLabel:ee[d],nonMetricUnit:te.toJSON(y),nonMetricLabel:ee[y]}}}let o=null;s!=null&&s.legendLayers&&(o=s.legendLayers.map(d=>{r.legendLayerNameMap[d.layerId]=d.title;const y={id:d.layerId};return d.subLayerIds&&(y.subLayerIds=d.subLayerIds),y}));const l=await ot(e,t,r);if(l.operationalLayers){const d=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),y=/[\u0600-\u06FF]/,w=g=>{const u=g.text,b=g.font,D=b&&b.family&&b.family.toLowerCase();u&&b&&(D==="arial"||D==="arial unicode ms")&&(b.family=d.test(u)?"Arial Unicode MS":"Arial",b.style!=="normal"&&y.test(u)&&(b.family="Arial Unicode MS"))},m=()=>{throw new De("print-task:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};l.operationalLayers.forEach(g=>{var u,b,D;(u=g.featureCollection)!=null&&u.layers?g.featureCollection.layers.forEach(f=>{var h,I,L,T;if((h=f.layerDefinition)!=null&&(I=h.drawingInfo)!=null&&(L=I.renderer)!=null&&L.symbol){const M=f.layerDefinition.drawingInfo.renderer;M.symbol.type==="esriTS"?w(M.symbol):M.symbol.type!=="CIMSymbolReference"||r.is11xService||m()}(T=f.featureSet)!=null&&T.features&&f.featureSet.features.forEach(M=>{M.symbol&&(M.symbol.type==="esriTS"?w(M.symbol):M.symbol.type!=="CIMSymbolReference"||r.is11xService||m())})}):!r.is11xService&&(b=g.layerDefinition)!=null&&(D=b.drawingInfo)!=null&&D.renderer&&JSON.stringify(g.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&m()})}e.outSpatialReference&&(l.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(l,{exportOptions:i,layoutOptions:c||{}}),Object.assign(l.layoutOptions,{legendOptions:{operationalLayers:o!=null?o:r.legendLayers.slice()}}),r.legendLayers.length=0,C.set(r.gpServerUrl,r);const p={Web_Map_as_JSON:JSON.stringify(l),Format:Le(t.format),Layout_Template:a};return e.extraParameters&&Object.assign(p,e.extraParameters),p}async function ot(e,r,t){const n=e.view;let i=n.spatialReference;const a={operationalLayers:await st(n,r,t)};let s=t.ssExtent||e.extent||n.extent;if(i&&i.isWrappable&&(s=s.clone()._normalize(!0),i=s.spatialReference),a.mapOptions={extent:s&&s.toJSON(),spatialReference:i&&i.toJSON(),showAttribution:r.attributionVisible},t.ssExtent=null,n.background&&(a.background=n.background.toJSON()),n.rotation&&(a.mapOptions.rotation=-n.rotation),r.scalePreserved&&(a.mapOptions.scale=r.outScale||n.scale),A(n.timeExtent)){const c=A(n.timeExtent.start)?n.timeExtent.start.getTime():null,o=A(n.timeExtent.end)?n.timeExtent.end.getTime():null;a.mapOptions.time=[c,o]}return a}function ne(e){let r=e;const t=r.lastIndexOf("/GPServer/");return t>0&&(r=r.slice(0,t+9)),r}async function st(e,r,t){const n=[],i={layerView:null,printTemplate:r,view:e};let a=0;r.scalePreserved&&(a=r.outScale||e.scale);const s=Je(e,a);for(const c of s){const o=c.layer;if(!o.loaded||je(o))continue;let l;i.layerView=c,l=He(c)?await U(o,i,t):Re(o)?lt(o):$e(o)?await ut(o,i,t):Ce(o)?await ct(o,i,t):Ue(o)?await yt(o,i,t):Ge(o)?await ft(o,i,t):_e(o)?pt(o,t):Ke(o)?dt(o,t):We(o)?await mt(o,i,t):Be(o)?gt(o,i,t):qe(o)?await ht(i,t):Qe(o)?bt():Xe(o)?await wt(o,i,t):Ye(o)?St(o):Ze(o)?await vt(o,i,t):et(o)?xt(o):tt(o)?Dt(o):rt(o)?It(o):await U(o,i,t),l&&(Array.isArray(l)?n.push(...l):(l.id=o.id,l.title=t.legendLayerNameMap[o.id]||o.title,l.opacity=o.opacity,l.minScale=o.minScale||0,l.maxScale=o.maxScale||0,Z(o)&&o.blendMode&&o.blendMode!=="normal"&&(l.blendMode=o.blendMode),n.push(l)))}if(a&&n.forEach(c=>{c.minScale=0,c.maxScale=0}),e.graphics&&e.graphics.length){const c=await V(null,e.graphics,r,t);c&&n.push(c)}return n}function lt(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function ut(e,r,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const n=r.layerView,i=r.printTemplate;let a;return!t.is11xService||n.filter?V(e,await j(n),i,t):(a={type:"CSV"},e.write(a,{origin:"web-map"}),delete a.popupInfo,delete a.layerType,a.showLabels=i.showLabels&&e.labelsVisible,a)}async function V(e,r,t,n){let i;const a=Ne(),s=Fe(),c=Y(),o=Ae(),l=Y();if(l.layerDefinition.name="textLayer",delete l.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?a.layerDefinition.name=s.layerDefinition.name=c.layerDefinition.name=o.layerDefinition.name=n.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(r=e.graphics.items),e.renderer){const f=e.renderer.toJSON();a.layerDefinition.drawingInfo.renderer=f,s.layerDefinition.drawingInfo.renderer=f,c.layerDefinition.drawingInfo.renderer=f,o.layerDefinition.drawingInfo.renderer=f}if(t.showLabels&&e.labelsVisible&&typeof e.write=="function"){var p,d;const f=(p=e.write({},{origin:"web-map"}).layerDefinition)==null||(d=p.drawingInfo)==null?void 0:d.labelingInfo;f&&(i=!0,a.layerDefinition.drawingInfo.labelingInfo=f,s.layerDefinition.drawingInfo.labelingInfo=f,c.layerDefinition.drawingInfo.labelingInfo=f,o.layerDefinition.drawingInfo.labelingInfo=f)}}let y;e!=null&&e.renderer||i||(delete a.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo);const w=e==null?void 0:e.fieldsIndex,m=e==null?void 0:e.renderer;if(w){const f=new Set;i&&await me(f,e),m&&typeof m.collectRequiredFields=="function"&&await m.collectRequiredFields(f,w),y=Array.from(f);const h=w.fields.map(I=>I.toJSON());a.layerDefinition.fields=h,s.layerDefinition.fields=h,c.layerDefinition.fields=h,o.layerDefinition.fields=h}const g=r&&r.length;let u;for(let f=0;f<g;f++){var b;const h=r[f]||r.getItemAt(f);if(h.visible===!1||!h.geometry||(u=h.toJSON(),u.hasOwnProperty("popupTemplate")&&delete u.popupTemplate,u.geometry&&u.geometry.z&&delete u.geometry.z,u.symbol&&u.symbol.outline&&u.symbol.outline.type==="esriCLS"&&!n.is11xService))continue;!n.is11xService&&u.symbol&&u.symbol.outline&&u.symbol.outline.color&&u.symbol.outline.color[3]&&(u.symbol.outline.color[3]=255);const I=e&&e.renderer&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!u.symbol&&e&&e.renderer&&I&&!n.is11xService){const L=e.renderer,T=await L.getSymbolAsync(h);if(!T)continue;u.symbol=T.toJSON(),"hasVisualVariables"in L&&L.hasVisualVariables()&&Oe(u.symbol,{renderer:L,graphic:h,symbol:T})}if(u.symbol&&(u.symbol.angle||delete u.symbol.angle,z(u.symbol)?u.symbol=await G(u.symbol,n):u.symbol.text&&delete u.attributes),(!t||!t.forceFeatureAttributes)&&(b=y)!=null&&b.length){const L={};y.forEach(T=>{u.attributes&&u.attributes.hasOwnProperty(T)&&(L[T]=u.attributes[T])}),u.attributes=L}h.geometry.type==="polygon"?a.featureSet.features.push(u):h.geometry.type==="polyline"?s.featureSet.features.push(u):h.geometry.type==="point"?u.symbol&&u.symbol.text?l.featureSet.features.push(u):c.featureSet.features.push(u):h.geometry.type==="multipoint"?o.featureSet.features.push(u):h.geometry.type==="extent"&&(u.geometry=ge.fromExtent(h.geometry).toJSON(),a.featureSet.features.push(u))}const D=[a,s,o,c,l].filter(f=>f.featureSet.features.length>0);for(const f of D){const h=f.featureSet.features.every(I=>I.symbol);!h||t&&t.forceFeatureAttributes||f.featureSet.features.forEach(I=>{delete I.attributes}),h&&delete f.layerDefinition.drawingInfo,f.layerDefinition.drawingInfo&&f.layerDefinition.drawingInfo.renderer&&await ae(f.layerDefinition.drawingInfo.renderer,n)}return D.length?{featureCollection:{layers:D},showLabels:i}:null}async function ct(e,r,t){var n,i;let a;const s=e.renderer,c=parseFloat(t.cimVersion);if(e.featureReduction&&(!t.is11xService||c<2.9)||(s==null?void 0:s.type)==="dot-density"&&(!t.is11xService||c<2.6))return U(e,r,t);e.legendEnabled&&t.legendLayers.push({id:e.id});const o=r.layerView,{printTemplate:l,view:p}=r,d=s&&("valueExpression"in s&&s.valueExpression||"hasVisualVariables"in s&&s.hasVisualVariables()),y=((n=e.source)==null?void 0:n.type)!=="feature-layer"&&((i=e.source)==null?void 0:i.type)!=="ogc-feature";if(!t.is11xService&&d||o.filter||y||!s||"field"in s&&s.field!=null&&(typeof s.field!="string"||!e.getField(s.field))){const u=await j(o);a=await V(e,u,l,t)}else{var w,m;if(a={id:(g=e.write()).id,title:g.title,opacity:g.opacity,minScale:g.minScale,maxScale:g.maxScale,url:g.url,layerType:g.layerType,customParameters:g.customParameters,layerDefinition:g.layerDefinition},a.showLabels=l.showLabels&&e.labelsVisible,F(a,e),(w=a.layerDefinition)!=null&&(m=w.drawingInfo)!=null&&m.renderer&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,await ae(a.layerDefinition.drawingInfo.renderer,t),"visualVariables"in s&&s.visualVariables&&s.visualVariables[0])){const b=s.visualVariables[0];if(b.type==="size"&&b.maxSize&&typeof b.maxSize!="number"&&b.minSize&&typeof b.minSize!="number"){const D=he(b,p.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=D.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=D.maxSize}}const u=be(o);u&&(a.layerDefinition||(a.layerDefinition={}),a.layerDefinition.definitionExpression=a.layerDefinition.definitionExpression?`(${a.layerDefinition.definitionExpression}) AND (${u})`:u)}var g;return a}async function yt(e,{layerView:r,printTemplate:t},n){return e.legendEnabled&&n.legendLayers.push({id:e.id}),V(e,await j(r),t,n)}async function ft(e,{printTemplate:r},t){return V(e,null,r,t)}function pt(e,r){e.legendEnabled&&r.legendLayers.push({id:e.id});const t={layerType:(n=e.write()).layerType,customParameters:n.customParameters};var n;if(t.bandIds=e.bandIds,t.compressionQuality=e.compressionQuality,t.format=e.format,t.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(t.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(r.is11xService)e.renderingRule&&(t.renderingRule=e.renderingRule.toJSON()),e.renderer&&(t.layerDefinition=t.layerDefinition||{},t.layerDefinition.drawingInfo=t.layerDefinition.drawingInfo||{},t.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const i=e.exportImageServiceParameters.combineRendererWithRenderingRule();i&&(t.renderingRule=i.toJSON())}return F(t,e),t}function dt(e,r){e.legendEnabled&&r.legendLayers.push({id:e.id});const t={bandIds:(n=e.write()||{}).bandIds,customParameters:n.customParameters,interpolation:n.interpolation,layerDefinition:n.layerDefinition};var n;return t.layerType="ArcGISImageServiceLayer",F(t,e),t}async function mt(e,r,t){const n=r.printTemplate;if(t.is11xService){const i={type:"kml"};return e.write(i,{origin:"web-map"}),delete i.layerType,i.url=N(e.url),i}{const i=[],a=r.layerView;a.allVisibleMapImages.forEach((o,l)=>{const p={id:`${e.id}_image${l}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:o.extent};o.href.substr(0,22)==="data:image/png;base64,"?p.imageData=o.href.substr(22):p.url=o.href,i.push(p)});const s=[...a.allVisiblePoints.items,...a.allVisiblePolylines.items,...a.allVisiblePolygons.items],c=k({id:e.id},await V(null,s,n,t));return i.push(c),i}}function gt(e,{view:r},t){let n;const i={id:e.id,subLayerIds:[]};let a=[];const s=r.scale,c=l=>{const p=s===0,d=l.minScale===0||s<=l.minScale,y=l.maxScale===0||s>=l.maxScale;if(l.visible&&(p||d&&y))if(l.sublayers)l.sublayers.forEach(c);else{const w=l.toExportImageJSON(),m={id:l.id,name:l.title,layerDefinition:{drawingInfo:w.drawingInfo,definitionExpression:w.definitionExpression,source:w.source}};a.unshift(m),i.subLayerIds.push(l.id)}};var o;return e.sublayers&&e.sublayers.forEach(c),a.length&&(a=a.map(({id:l,name:p,layerDefinition:d})=>({id:l,name:p,layerDefinition:d})),n={layerType:(o=e.write()).layerType,customParameters:o.customParameters},n.layers=a,n.visibleLayers=e.capabilities.exportMap.supportsDynamicLayers?void 0:i.subLayerIds,F(n,e),e.legendEnabled&&t.legendLayers.push(i)),n}async function ht({layerView:e,printTemplate:r},t){const n=[],i=e.layer;if(A(i.featureCollections))for(const a of i.featureCollections){const s=await V(a,a.source,r,t);s&&n.push(...s.featureCollection.layers)}else if(A(i.sublayers))for(const a of i.sublayers){const s=await V(null,a.graphics,r,t);s&&n.push(...s.featureCollection.layers)}return{featureCollection:{layers:n}}}function bt(){return{type:"OpenStreetMap"}}async function U(e,{printTemplate:r,view:t},n){const i={type:"image"},a={format:"png",ignoreBackground:!0,layers:[e],rotation:0},s=n.ssExtent||t.extent.clone();let c=96,o=!0,l=!0;if(r.exportOptions){const y=r.exportOptions;y.dpi>0&&(c=y.dpi),y.width>0&&(o=y.width%2==t.width%2),y.height>0&&(l=y.height%2==t.height%2)}if(r.layout==="map-only"&&r.scalePreserved&&(!r.outScale||r.outScale===t.scale)&&c===96&&(!o||!l)&&(a.area={x:0,y:0,width:t.width,height:t.height},o||(a.area.width-=1),l||(a.area.height-=1),!n.ssExtent)){const y=t.toMap(we(a.area.width,a.area.height));s.ymin=y.y,s.xmax=y.x,n.ssExtent=s}i.extent=s.clone()._normalize(!0).toJSON();const p=await t.takeScreenshot(a),{data:d}=Se(p.dataUrl);return i.imageData=d,i}async function wt(e,{layerView:r,printTemplate:t},n){return e.legendEnabled&&n.legendLayers.push({id:e.id}),V(e,await j(r),t,n)}function St(e){const r={layerType:(t=e.write()).layerType,customParameters:t.customParameters};var t;return F(r,e),r}async function vt(e,r,t){if(t.is11xService&&e.serviceUrl&&e.styleUrl){const n=K(e.styleUrl,e.apiKey),i=K(e.serviceUrl,e.apiKey);if(!n&&!i||t.cimVersion!=="2.1.0"){const a={type:"VectorTileLayer"};return a.styleUrl=N(e.styleUrl),a.token=n,i!==n&&(a.additionalTokens=[{url:e.serviceUrl,token:i}]),a}}return U(e,r,t)}function xt(e){const r={type:"WebTiledLayer",urlTemplate:e.urlTemplate.replace(/\${/g,"{"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(r.subDomains=e.subDomains),r}function Dt(e){let r;const t=[],n=i=>{i.visible&&(i.sublayers?i.sublayers.forEach(n):i.name&&t.unshift(i.name))};return e.sublayers&&e.sublayers.forEach(n),t.length&&(r={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:t,url:N(e.url),version:e.version}),r}function It(e){const r=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:r.imageFormat,layer:r.id,style:r.styleId,tileMatrixSet:r.tileMatrixSetId,url:N(e.url)}}function F(e,r){r.url&&(e.url=N(e.url||r.url),e.token=K(e.url,r.apiKey))}function K(e,r){var t,n;return ve(e)&&(r||H.apiKey)?r||H.apiKey:(t=xe)==null||(n=t.findCredential(e))==null?void 0:n.token}async function G(e,r){r.canvas||(r.canvas=document.createElement("canvas"));const t=1024;r.canvas.width=t,r.canvas.height=t;const n=r.canvas.getContext("2d");let i,a;if(e.path){var s;const c=new Path2D(e.path);c.closePath(),n.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",n.fill(c);const o=ke(n);if(!o)return null;n.clearRect(0,0,t,t);const l=J(e.size)/Math.max(o.width,o.height);n.scale(l,l);const p=t/l,d=p/2-o.width/2-o.x,y=p/2-o.height/2-o.y;if(n.translate(d,y),Array.isArray(e.color)&&n.fill(c),(s=e.outline)!=null&&s.width&&Array.isArray(e.outline.color)){const m=e.outline;n.lineWidth=J(m.width)/l,n.lineJoin="round",n.strokeStyle=`rgba(${m.color[0]},${m.color[1]},${m.color[2]},${m.color[3]/255})`,n.stroke(c),o.width+=n.lineWidth,o.height+=n.lineWidth}o.width*=l,o.height*=l;const w=n.getImageData(t/2-o.width/2,t/2-o.height/2,Math.ceil(o.width),Math.ceil(o.height));i=w.width,a=w.height,n.canvas.width=i,n.canvas.height=a,n.putImageData(w,0,0)}else{const c=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,o=(await Q(c,{responseType:"image"})).data;i=J(e.width),a=J(e.height),n.canvas.width=i,n.canvas.height=a,n.drawImage(o,0,0,n.canvas.width,n.canvas.height)}return{type:"esriPMS",imageData:n.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:P(a),width:P(i),xoffset:e.xoffset,yoffset:e.yoffset}}async function ae(e,r){const t=e.type;if(t==="simple"&&z(e.symbol))e.symbol=await G(e.symbol,r);else if(t==="uniqueValue"||t==="classBreaks"){z(e.defaultSymbol)&&(e.defaultSymbol=await G(e.defaultSymbol,r));const n=e[t==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(n)for(const i of n)z(i.symbol)&&(i.symbol=await G(i.symbol,r))}}async function j(e){return e.queryFeatures(e.createQuery()).then(r=>r.features)}function Lt(e){return e.gpMetadata&&e.gpMetadata.executionType?at.fromJSON(e.gpMetadata.executionType):"sync"}function z(e){return e&&(e.path||e.contentType==="image/svg+xml"||e.url&&e.url.endsWith(".svg"))}const Tt=new O({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"});let E=class extends Ie{constructor(...e){super(...e),this._gpMetadata=null,this.updateDelay=1e3}get mode(){return this._gpMetadata&&this._gpMetadata.executionType?Tt.fromJSON(this._gpMetadata.executionType):"sync"}execute(e,r){return e&&(e.updateDelay=this.updateDelay),it(this.url,e,k(k({},this.requestOptions),r))}async _getGpPrintParams(e){const r=ne(this.url),t=C.get(r);return re(e,t)}};S([v()],E.prototype,"_gpMetadata",void 0),S([v({readOnly:!0})],E.prototype,"mode",null),S([v()],E.prototype,"updateDelay",void 0),E=S([q("esri.tasks.PrintTask")],E);const Pt=E;export{Pt as default};
