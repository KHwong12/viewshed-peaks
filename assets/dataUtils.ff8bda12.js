var Jt=Object.defineProperty,qt=Object.defineProperties;var Xt=Object.getOwnPropertyDescriptors;var nt=Object.getOwnPropertySymbols;var Zt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var at=(e,t,r)=>t in e?Jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,se=(e,t)=>{for(var r in t||(t={}))Zt.call(t,r)&&at(e,r,t[r]);if(nt)for(var r of nt(t))Qt.call(t,r)&&at(e,r,t[r]);return e},me=(e,t)=>qt(e,Xt(t));import{U as he,bB as er,bU as tr,A as ee,E as st,dh as rr,r as $,t as W,d as or,w as je,dY as ze,at as lt,cQ as ir,C as ft,ag as ut,a_ as Ae,ac as nr,la as ct}from"./vendor.d423bc92.js";import{u as H}from"./PixelBlock.021d47c5.js";import{r as ar}from"./LercCodec.9e5bdb80.js";import{p as sr,z as ht,y as lr}from"./colorUtils.c7035b36.js";var We,dt,pt,mt={exports:{}};dt=mt,We=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(t){var r=this.buffer,s=r?r.byteLength:0;if(t<s)return r;for(var i=512;i<t;)i<<=1;for(var n=new Uint8Array(i),c=0;c<s;++c)n[c]=r[c];return this.buffer=n},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var r=this.pos;if(t){this.ensureBuffer(r+t);for(var s=r+t;!this.eof&&this.bufferLength<s;)this.readBlock();var i=this.bufferLength;s>i&&(s=i)}else{for(;!this.eof;)this.readBlock();s=this.bufferLength}return this.pos=s,this.buffer.subarray(r,s)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,r,s){for(var i=t+r;this.bufferLength<=i&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,r,s)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}},e}(),(pt=function(){if(!self||!self.Uint32Array)return null;var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),s=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],i=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function n(l){throw new Error(l)}function c(l){var o=0,a=l[o++],h=l[o++];a!=-1&&h!=-1||n("Invalid header in flate stream"),(15&a)!=8&&n("Unknown compression method in flate stream"),((a<<8)+h)%31!=0&&n("Bad FCHECK in flate stream"),32&h&&n("FDICT bit set in flate stream"),this.bytes=l,this.bytesPos=o,this.codeSize=0,this.codeBuf=0,We.call(this)}return c.prototype=Object.create(We.prototype),c.prototype.getBits=function(l){for(var o,a=this.codeSize,h=this.codeBuf,f=this.bytes,u=this.bytesPos;a<l;)(o=f[u++])===void 0&&n("Bad encoding in flate stream"),h|=o<<a,a+=8;return o=h&(1<<l)-1,this.codeBuf=h>>l,this.codeSize=a-=l,this.bytesPos=u,o},c.prototype.getCode=function(l){for(var o=l[0],a=l[1],h=this.codeSize,f=this.codeBuf,u=this.bytes,d=this.bytesPos;h<a;){var g;(g=u[d++])===void 0&&n("Bad encoding in flate stream"),f|=g<<h,h+=8}var m=o[f&(1<<a)-1],C=m>>16,p=65535&m;return(h==0||h<C||C==0)&&n("Bad encoding in flate stream"),this.codeBuf=f>>C,this.codeSize=h-C,this.bytesPos=d,p},c.prototype.generateHuffmanTable=function(l){for(var o=l.length,a=0,h=0;h<o;++h)l[h]>a&&(a=l[h]);for(var f=1<<a,u=new Uint32Array(f),d=1,g=0,m=2;d<=a;++d,g<<=1,m<<=1)for(var C=0;C<o;++C)if(l[C]==d){var p=0,y=g;for(h=0;h<d;++h)p=p<<1|1&y,y>>=1;for(h=p;h<f;h+=m)u[h]=d<<16|C;++g}return[u,a]},c.prototype.readBlock=function(){function l(E,B,R,N,_){for(var F=E.getBits(R)+N;F-- >0;)B[m++]=_}var o=this.getBits(3);if(1&o&&(this.eof=!0),(o>>=1)!=0){var a,h;if(o==1)a=s,h=i;else if(o==2){for(var f=this.getBits(5)+257,u=this.getBits(5)+1,d=this.getBits(4)+4,g=Array(e.length),m=0;m<d;)g[e[m++]]=this.getBits(3);for(var C=this.generateHuffmanTable(g),p=0,y=(m=0,f+u),v=new Array(y);m<y;){var x=this.getCode(C);x==16?l(this,v,2,3,p):x==17?l(this,v,3,3,p=0):x==18?l(this,v,7,11,p=0):v[m++]=p=x}a=this.generateHuffmanTable(v.slice(0,f)),h=this.generateHuffmanTable(v.slice(f,y))}else n("Unknown block type in flate stream");for(var w=(U=this.buffer)?U.length:0,k=this.bufferLength;;){var b=this.getCode(a);if(b<256)k+1>=w&&(w=(U=this.ensureBuffer(k+1)).length),U[k++]=b;else{if(b==256)return void(this.bufferLength=k);var T=(b=t[b-=257])>>16;T>0&&(T=this.getBits(T)),p=(65535&b)+T,b=this.getCode(h),(T=(b=r[b])>>16)>0&&(T=this.getBits(T));var S=(65535&b)+T;k+p>=w&&(w=(U=this.ensureBuffer(k+p)).length);for(var M=0;M<p;++M,++k)U[k]=U[k-S]}}}else{var A,P=this.bytes,I=this.bytesPos;(A=P[I++])===void 0&&n("Bad block header in flate stream");var D=A;(A=P[I++])===void 0&&n("Bad block header in flate stream"),D|=A<<8,(A=P[I++])===void 0&&n("Bad block header in flate stream");var O=A;(A=P[I++])===void 0&&n("Bad block header in flate stream"),(O|=A<<8)!=(65535&~D)&&n("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var L=this.bufferLength,U=this.ensureBuffer(L+D),V=L+D;this.bufferLength=V;for(var j=L;j<V;++j){if((A=P[I++])===void 0){this.eof=!0;break}U[j]=A}this.bytesPos=I}},c}())!==void 0&&(dt.exports=pt);const xe=mt.exports;class Ke{constructor(t){t&&(this.canvas=t.canvas,this.ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,r,s){if(!t||t.byteLength<10)throw new he("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:i,height:n,format:c}=r;const{applyJpegMask:l}=r;if(l&&(!i||!n))throw new he("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((o,a)=>{let h=null;c==="jpg"&&l&&(h=Ke.getMask(t,{width:i,height:n}));const f=new Blob([new Uint8Array(t)],{type:"image/"+c=="jpg"?"jpeg":c}),u=URL.createObjectURL(f),d=new Image;let g;d.src=u,d.onload=()=>{if(URL.revokeObjectURL(u),er(s))return void a(tr());i=d.width,n=d.height,this.canvas?(this.canvas.width===i&&this.canvas.height===n||(this.canvas.width=i,this.canvas.height=n),this.ctx.clearRect(0,0,i,n)):(this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=n,this.ctx=this.canvas.getContext("2d")),this.ctx.drawImage(d,0,0);const m=this.ctx.getImageData(0,0,i,n);let C;if(g=m.data,r.renderOnCanvas){if(h)for(C=0;C<h.length;C++)h[C]?g[4*C+3]=255:g[4*C+3]=0;return this.ctx.putImageData(m,0,0),void o(null)}const p=i*n,y=new Uint8Array(p),v=new Uint8Array(p),x=new Uint8Array(p);if(h)for(C=0;C<p;C++)y[C]=g[4*C],v[C]=g[4*C+1],x[C]=g[4*C+2];else for(h=new Uint8Array(p),C=0;C<p;C++)y[C]=g[4*C],v[C]=g[4*C+1],x[C]=g[4*C+2],h[C]=g[4*C+3];o({width:i,height:n,pixels:[y,v,x],mask:h,pixelType:"u8"})},d.onerror=()=>{URL.revokeObjectURL(u),a("cannot load image")}})}static getMask(t,r){let s=null;try{const i=new Uint8Array(t),n=Math.ceil(i.length/2);let c=0;const l=i.length-2;for(c=n;c<l&&(i[c]!==255||i[c+1]!==217);c++);if(c+=2,c<i.length-1){const o=new xe(i.subarray(c)).getBytes();s=new Uint8Array(r.width*r.height);let a=0;for(let h=0;h<o.length;h++)for(let f=7;f>=0;f--)s[a++]=o[h]>>f&1}}catch{}return s}}var gt,yt,wt,Ct={exports:{}};gt=Ct,yt=function(){var e=function(){function t(r){this.message="JPEG error: "+r}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,s=799,i=3406,n=2276,c=1567,l=3784,o=5793,a=2896;function h(){this.decodeTransform=null,this.colorTransform=-1}function f(p,y){for(var v,x,w=0,k=[],b=16;b>0&&!p[b-1];)b--;k.push({children:[],index:0});var T,S=k[0];for(v=0;v<b;v++){for(x=0;x<p[v];x++){for((S=k.pop()).children[S.index]=y[w];S.index>0;)S=k.pop();for(S.index++,k.push(S);k.length<=v;)k.push(T={children:[],index:0}),S.children[S.index]=T.children,S=T;w++}v+1<b&&(k.push(T={children:[],index:0}),S.children[S.index]=T.children,S=T)}return k[0].children}function u(p,y,v){return 64*((p.blocksPerLine+1)*y+v)}function d(p,y,v,x,w,k,b,T,S){var M=v.mcusPerLine,A=v.progressive,P=y,I=0,D=0;function O(){if(D>0)return D--,I>>D&1;if((I=p[y++])===255){var G=p[y++];if(G)throw new e("unexpected marker "+(I<<8|G).toString(16))}return D=7,I>>>7}function L(G){for(var z=G;;){if(typeof(z=z[O()])=="number")return z;if(typeof z!="object")throw new e("invalid huffman sequence")}}function U(G){for(var z=0;G>0;)z=z<<1|O(),G--;return z}function V(G){if(G===1)return O()===1?1:-1;var z=U(G);return z>=1<<G-1?z:z+(-1<<G)+1}function j(G,z){var Y=L(G.huffmanTableDC),te=Y===0?0:V(Y);G.blockData[z]=G.pred+=te;for(var ne=1;ne<64;){var ce=L(G.huffmanTableAC),re=15&ce,ae=ce>>4;if(re!==0){var Ht=t[ne+=ae];G.blockData[z+Ht]=V(re),ne++}else{if(ae<15)break;ne+=16}}}function E(G,z){var Y=L(G.huffmanTableDC),te=Y===0?0:V(Y)<<S;G.blockData[z]=G.pred+=te}function B(G,z){G.blockData[z]|=O()<<S}var R=0;function N(G,z){if(R>0)R--;else for(var Y=k,te=b;Y<=te;){var ne=L(G.huffmanTableAC),ce=15&ne,re=ne>>4;if(ce!==0){var ae=t[Y+=re];G.blockData[z+ae]=V(ce)*(1<<S),Y++}else{if(re<15){R=U(re)+(1<<re)-1;break}Y+=16}}}var _,F=0;function Q(G,z){for(var Y,te,ne=k,ce=b,re=0;ne<=ce;){var ae=t[ne];switch(F){case 0:if(re=(te=L(G.huffmanTableAC))>>4,(Y=15&te)==0)re<15?(R=U(re)+(1<<re),F=4):(re=16,F=1);else{if(Y!==1)throw new e("invalid ACn encoding");_=V(Y),F=re?2:3}continue;case 1:case 2:G.blockData[z+ae]?G.blockData[z+ae]+=O()<<S:--re==0&&(F=F===2?3:0);break;case 3:G.blockData[z+ae]?G.blockData[z+ae]+=O()<<S:(G.blockData[z+ae]=_<<S,F=0);break;case 4:G.blockData[z+ae]&&(G.blockData[z+ae]+=O()<<S)}ne++}F===4&&--R==0&&(F=0)}function oe(G,z,Y,te,ne){var ce=Y%M;z(G,u(G,(Y/M|0)*G.v+te,ce*G.h+ne))}function Se(G,z,Y){z(G,u(G,Y/G.blocksPerLine|0,Y%G.blocksPerLine))}var le,ue,de,ye,J,Pe,we=x.length;Pe=A?k===0?T===0?E:B:T===0?N:Q:j;var fe,Ce,Ee,Re,pe=0;for(Ce=we===1?x[0].blocksPerLine*x[0].blocksPerColumn:M*v.mcusPerColumn;pe<Ce;){var Oe=w?Math.min(Ce-pe,w):Ce;for(ue=0;ue<we;ue++)x[ue].pred=0;if(R=0,we===1)for(le=x[0],J=0;J<Oe;J++)Se(le,Pe,pe),pe++;else for(J=0;J<Oe;J++){for(ue=0;ue<we;ue++)for(Ee=(le=x[ue]).h,Re=le.v,de=0;de<Re;de++)for(ye=0;ye<Ee;ye++)oe(le,Pe,pe,de,ye);pe++}D=0,(fe=C(p,y))&&fe.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+fe.invalid),y=fe.offset);var ve=fe&&fe.marker;if(!ve||ve<=65280)throw new e("marker was not found");if(!(ve>=65488&&ve<=65495))break;y+=2}return(fe=C(p,y))&&fe.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+fe.invalid),y=fe.offset),y-P}function g(p,y,v){var x,w,k,b,T,S,M,A,P,I,D,O,L,U,V,j,E,B=p.quantizationTable,R=p.blockData;if(!B)throw new e("missing required Quantization Table.");for(var N=0;N<64;N+=8)P=R[y+N],I=R[y+N+1],D=R[y+N+2],O=R[y+N+3],L=R[y+N+4],U=R[y+N+5],V=R[y+N+6],j=R[y+N+7],P*=B[N],(I|D|O|L|U|V|j)!=0?(I*=B[N+1],D*=B[N+2],O*=B[N+3],L*=B[N+4],U*=B[N+5],V*=B[N+6],j*=B[N+7],w=(x=(x=o*P+128>>8)+(w=o*L+128>>8)+1>>1)-w,E=(k=D)*l+(b=V)*c+128>>8,k=k*c-b*l+128>>8,M=(T=(T=a*(I-j)+128>>8)+(M=U<<4)+1>>1)-M,S=(A=(A=a*(I+j)+128>>8)+(S=O<<4)+1>>1)-S,b=(x=x+(b=E)+1>>1)-b,k=(w=w+k+1>>1)-k,E=T*n+A*i+2048>>12,T=T*i-A*n+2048>>12,A=E,E=S*s+M*r+2048>>12,S=S*r-M*s+2048>>12,M=E,v[N]=x+A,v[N+7]=x-A,v[N+1]=w+M,v[N+6]=w-M,v[N+2]=k+S,v[N+5]=k-S,v[N+3]=b+T,v[N+4]=b-T):(E=o*P+512>>10,v[N]=E,v[N+1]=E,v[N+2]=E,v[N+3]=E,v[N+4]=E,v[N+5]=E,v[N+6]=E,v[N+7]=E);for(var _=0;_<8;++_)P=v[_],((I=v[_+8])|(D=v[_+16])|(O=v[_+24])|(L=v[_+32])|(U=v[_+40])|(V=v[_+48])|(j=v[_+56]))!=0?(w=(x=4112+((x=o*P+2048>>12)+(w=o*L+2048>>12)+1>>1))-w,E=(k=D)*l+(b=V)*c+2048>>12,k=k*c-b*l+2048>>12,b=E,M=(T=(T=a*(I-j)+2048>>12)+(M=U)+1>>1)-M,S=(A=(A=a*(I+j)+2048>>12)+(S=O)+1>>1)-S,E=T*n+A*i+2048>>12,T=T*i-A*n+2048>>12,A=E,E=S*s+M*r+2048>>12,S=S*r-M*s+2048>>12,P=(P=(x=x+b+1>>1)+A)<16?0:P>=4080?255:P>>4,I=(I=(w=w+k+1>>1)+(M=E))<16?0:I>=4080?255:I>>4,D=(D=(k=w-k)+S)<16?0:D>=4080?255:D>>4,O=(O=(b=x-b)+T)<16?0:O>=4080?255:O>>4,L=(L=b-T)<16?0:L>=4080?255:L>>4,U=(U=k-S)<16?0:U>=4080?255:U>>4,V=(V=w-M)<16?0:V>=4080?255:V>>4,j=(j=x-A)<16?0:j>=4080?255:j>>4,R[y+_]=P,R[y+_+8]=I,R[y+_+16]=D,R[y+_+24]=O,R[y+_+32]=L,R[y+_+40]=U,R[y+_+48]=V,R[y+_+56]=j):(E=(E=o*P+8192>>14)<-2040?0:E>=2024?255:E+2056>>4,R[y+_]=E,R[y+_+8]=E,R[y+_+16]=E,R[y+_+24]=E,R[y+_+32]=E,R[y+_+40]=E,R[y+_+48]=E,R[y+_+56]=E)}function m(p,y){for(var v=y.blocksPerLine,x=y.blocksPerColumn,w=new Int16Array(64),k=0;k<x;k++)for(var b=0;b<v;b++)g(y,u(y,k,b),w);return y.blockData}function C(p,y,v){function x(S){return p[S]<<8|p[S+1]}var w=p.length-1,k=v<y?v:y;if(y>=w)return null;var b=x(y);if(b>=65472&&b<=65534)return{invalid:null,marker:b,offset:y};for(var T=x(k);!(T>=65472&&T<=65534);){if(++k>=w)return null;T=x(k)}return{invalid:b.toString(16),marker:T,offset:k}}return h.prototype={parse:function(p){function y(){var G=p[b]<<8|p[b+1];return b+=2,G}function v(){var G=y(),z=b+G-2,Y=C(p,z,b);Y&&Y.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+Y.invalid),z=Y.offset);var te=p.subarray(b,z);return b+=te.length,te}function x(G){for(var z=Math.ceil(G.samplesPerLine/8/G.maxH),Y=Math.ceil(G.scanLines/8/G.maxV),te=0;te<G.components.length;te++){J=G.components[te];var ne=Math.ceil(Math.ceil(G.samplesPerLine/8)*J.h/G.maxH),ce=Math.ceil(Math.ceil(G.scanLines/8)*J.v/G.maxV),re=z*J.h,ae=Y*J.v*64*(re+1);J.blockData=new Int16Array(ae),J.blocksPerLine=ne,J.blocksPerColumn=ce}G.mcusPerLine=z,G.mcusPerColumn=Y}var w,k,b=0,T=null,S=null,M=[],A=[],P=[],I=y();if(I!==65496)throw new e("SOI not found");for(I=y();I!==65497;){var D,O,L;switch(I){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var U=v();I===65504&&U[0]===74&&U[1]===70&&U[2]===73&&U[3]===70&&U[4]===0&&(T={version:{major:U[5],minor:U[6]},densityUnits:U[7],xDensity:U[8]<<8|U[9],yDensity:U[10]<<8|U[11],thumbWidth:U[12],thumbHeight:U[13],thumbData:U.subarray(14,14+3*U[12]*U[13])}),I===65518&&U[0]===65&&U[1]===100&&U[2]===111&&U[3]===98&&U[4]===101&&(S={version:U[5]<<8|U[6],flags0:U[7]<<8|U[8],flags1:U[9]<<8|U[10],transformCode:U[11]});break;case 65499:for(var V=y()+b-2;b<V;){var j=p[b++],E=new Uint16Array(64);if(j>>4==0)for(O=0;O<64;O++)E[t[O]]=p[b++];else{if(j>>4!=1)throw new e("DQT - invalid table spec");for(O=0;O<64;O++)E[t[O]]=y()}M[15&j]=E}break;case 65472:case 65473:case 65474:if(w)throw new e("Only single frame JPEGs supported");y(),(w={}).extended=I===65473,w.progressive=I===65474,w.precision=p[b++],w.scanLines=y(),w.samplesPerLine=y(),w.components=[],w.componentIds={};var B,R=p[b++],N=0,_=0;for(D=0;D<R;D++){B=p[b];var F=p[b+1]>>4,Q=15&p[b+1];N<F&&(N=F),_<Q&&(_=Q);var oe=p[b+2];L=w.components.push({h:F,v:Q,quantizationId:oe,quantizationTable:null}),w.componentIds[B]=L-1,b+=3}w.maxH=N,w.maxV=_,x(w);break;case 65476:var Se=y();for(D=2;D<Se;){var le=p[b++],ue=new Uint8Array(16),de=0;for(O=0;O<16;O++,b++)de+=ue[O]=p[b];var ye=new Uint8Array(de);for(O=0;O<de;O++,b++)ye[O]=p[b];D+=17+de,(le>>4==0?P:A)[15&le]=f(ue,ye)}break;case 65501:y(),k=y();break;case 65498:y();var J,Pe=p[b++],we=[];for(D=0;D<Pe;D++){var fe=w.componentIds[p[b++]];J=w.components[fe];var Ce=p[b++];J.huffmanTableDC=P[Ce>>4],J.huffmanTableAC=A[15&Ce],we.push(J)}var Ee=p[b++],Re=p[b++],pe=p[b++],Oe=d(p,b,w,we,k,Ee,Re,pe>>4,15&pe);b+=Oe;break;case 65535:p[b]!==255&&b--;break;default:if(p[b-3]===255&&p[b-2]>=192&&p[b-2]<=254){b-=3;break}throw new e("unknown marker "+I.toString(16))}I=y()}for(this.width=w.samplesPerLine,this.height=w.scanLines,this.jfif=T,this.eof=b,this.adobe=S,this.components=[],D=0;D<w.components.length;D++){var ve=M[(J=w.components[D]).quantizationId];ve&&(J.quantizationTable=ve),this.components.push({output:m(w,J),scaleX:J.h/w.maxH,scaleY:J.v/w.maxV,blocksPerLine:J.blocksPerLine,blocksPerColumn:J.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(p,y){var v,x,w,k,b,T,S,M,A,P,I,D=this.width/p,O=this.height/y,L=0,U=this.components.length,V=p*y*U,j=new Uint8ClampedArray(V),E=new Uint32Array(p),B=4294967288;for(S=0;S<U;S++){for(x=(v=this.components[S]).scaleX*D,w=v.scaleY*O,L=S,I=v.output,k=v.blocksPerLine+1<<3,b=0;b<p;b++)M=0|b*x,E[b]=(M&B)<<3|7&M;for(T=0;T<y;T++)for(P=k*((M=0|T*w)&B)|(7&M)<<3,b=0;b<p;b++)j[L]=I[P+E[b]],L+=U}var R=this.decodeTransform;if(R)for(S=0;S<V;)for(M=0,A=0;M<U;M++,S++,A+=2)j[S]=(j[S]*R[A]>>8)+R[A+1];return j},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(p){for(var y,v,x,w=0,k=p.length;w<k;w+=3)y=p[w],v=p[w+1],x=p[w+2],p[w]=y-179.456+1.402*x,p[w+1]=y+135.459-.344*v-.714*x,p[w+2]=y-226.816+1.772*v;return p},_convertYcckToRgb:function(p){for(var y,v,x,w,k=0,b=0,T=p.length;b<T;b+=4)y=p[b],v=p[b+1],x=p[b+2],w=p[b+3],p[k++]=v*(-660635669420364e-19*v+.000437130475926232*x-54080610064599e-18*y+.00048449797120281*w-.154362151871126)-122.67195406894+x*(-.000957964378445773*x+.000817076911346625*y-.00477271405408747*w+1.53380253221734)+y*(.000961250184130688*y-.00266257332283933*w+.48357088451265)+w*(-.000336197177618394*w+.484791561490776),p[k++]=107.268039397724+v*(219927104525741e-19*v-.000640992018297945*x+.000659397001245577*y+.000426105652938837*w-.176491792462875)+x*(-.000778269941513683*x+.00130872261408275*y+.000770482631801132*w-.151051492775562)+y*(.00126935368114843*y-.00265090189010898*w+.25802910206845)+w*(-.000318913117588328*w-.213742400323665),p[k++]=v*(-.000570115196973677*v-263409051004589e-19*x+.0020741088115012*y-.00288260236853442*w+.814272968359295)-20.810012546947+x*(-153496057440975e-19*x-.000132689043961446*y+.000560833691242812*w-.195152027534049)+y*(.00174418132927582*y-.00255243321439347*w+.116935020465145)+w*(-.000343531996510555*w+.24165260232407);return p},_convertYcckToCmyk:function(p){for(var y,v,x,w=0,k=p.length;w<k;w+=4)y=p[w],v=p[w+1],x=p[w+2],p[w]=434.456-y-1.402*x,p[w+1]=119.541-y+.344*v+.714*x,p[w+2]=481.816-y-1.772*v;return p},_convertCmykToRgb:function(p){for(var y,v,x,w,k=0,b=1/255,T=0,S=p.length;T<S;T+=4)y=p[T]*b,v=p[T+1]*b,x=p[T+2]*b,w=p[T+3]*b,p[k++]=255+y*(-4.387332384609988*y+54.48615194189176*v+18.82290502165302*x+212.25662451639585*w-285.2331026137004)+v*(1.7149763477362134*v-5.6096736904047315*x-17.873870861415444*w-5.497006427196366)+x*(-2.5217340131683033*x-21.248923337353073*w+17.5119270841813)-w*(21.86122147463605*w+189.48180835922747),p[k++]=255+y*(8.841041422036149*y+60.118027045597366*v+6.871425592049007*x+31.159100130055922*w-79.2970844816548)+v*(-15.310361306967817*v+17.575251261109482*x+131.35250912493976*w-190.9453302588951)+x*(4.444339102852739*x+9.8632861493405*w-24.86741582555878)-w*(20.737325471181034*w+187.80453709719578),p[k++]=255+y*(.8842522430003296*y+8.078677503112928*v+30.89978309703729*x-.23883238689178934*w-14.183576799673286)+v*(10.49593273432072*v+63.02378494754052*x+50.606957656360734*w-112.23884253719248)+x*(.03296041114873217*x+115.60384449646641*w-193.58209356861505)-w*(22.33816807309886*w+180.12613974708367);return p},getData:function(p,y,v){if(this.numComponents>4)throw new e("Unsupported color mode");var x=this._getLinearizedBlockData(p,y);if(this.numComponents===1&&v){for(var w=x.length,k=new Uint8ClampedArray(3*w),b=0,T=0;T<w;T++){var S=x[T];k[b++]=S,k[b++]=S,k[b++]=S}return k}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(x);if(this.numComponents===4){if(this._isColorConversionNeeded())return v?this._convertYcckToRgb(x):this._convertYcckToCmyk(x);if(v)return this._convertCmykToRgb(x)}return x}},h}()},(wt=yt())!==void 0&&(gt.exports=wt);const Be=Ct.exports;class fr{static decode(t){const r=new Uint8Array(t),s=new Be;s.parse(r);const{width:i,height:n,numComponents:c,eof:l}=s,o=s.getData(i,n,!0);let a;const h=i*n;let f=0,u=0,d=0;if(l<r.length-1){const C=new xe(r.subarray(l)).getBytes();a=new Uint8Array(h);let p=0;for(f=0;f<C.length;f++)for(d=7;d>=0;d--)a[p++]=C[f]>>d&1}let g,m=null;if(c===1)m=[o,o,o];else{for(m=[],f=0;f<3;f++)g=new Uint8Array(h),m.push(g);for(d=0,u=0;u<h;u++)for(f=0;f<3;f++)m[f][u]=o[d++]}return{width:i,height:n,pixels:m,mask:a}}}function ur(e,t){let r=0,s="",i=0,n=0;const c=e.length;for(;r<c;)n=e[r++],i=n>>4,i<8?i=1:i===15?(i=4,n=(7&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++]):i===14?(i=3,n=(15&n)<<12|(63&e[r++])<<6|63&e[r++]):(i=2,n=(31&n)<<6|63&e[r++]),(n!==0||t)&&(s+=String.fromCharCode(n));return s}function cr(e,t,r,s=!0){if(t%4!=0||r%4!=0){const i=new ArrayBuffer(4*Math.ceil(r/4)),n=new Uint8Array(i),c=new Uint8Array(e,t,r);if(s)for(let l=0;l<n.length;l+=4)n[l]=c[l+3],n[l+1]=c[l+2],n[l+2]=c[l+1],n[l+3]=c[l];else n.set(c);return new Uint32Array(n.buffer)}if(s){const i=new Uint8Array(e,t,r),n=new Uint8Array(i.length);for(let c=0;c<n.length;c+=4)n[c]=i[c+3],n[c+1]=i[c+2],n[c+2]=i[c+1],n[c+3]=i[c];return new Uint32Array(n.buffer)}return new Uint32Array(e,t,r/4)}function vt(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function xt(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}const Ie=new Set;function Ye(e,t,r,s=!0){const i=cr(e,t,r,s);let n=9,c=vt(),l=32,o=c.length,a=[],h=1,f=i[0],u=0;const d=i.length,g=8*(4*d-r),m=[];for(;f!=null;){if(l>=n)l-=n,u=f>>>32-n,f<<=n;else{u=f>>>32-l,f=i[h++];const p=n-l;l=32-p,u=(u<<p)+(f>>>l),f<<=p}if(u===257)break;if(u===256){n=9,c=vt(),o=c.length,a=[];continue}const C=c[u];if(C==null){if(u>c.length)throw"data integrity issue: code does not exist on code page";a.push(a[0]),c[o++]=a.slice(),xt(m,a)}else xt(m,C),a.push(C[0]),a.length>1&&(c[o++]=a.slice()),a=C.slice();if(Ie.has(o)&&n++,l===0&&(f=i[h++],l=32),h>d||h===d&&l<=g)break}return new Uint8Array(m)}Ie.add(511),Ie.add(1023),Ie.add(2047),Ie.add(4095),Ie.add(8191);const He=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),hr=(()=>{const e=[].concat(He);return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),dr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],pr=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),mr=function(e,t){let r=(t||He)[e];return r===void 0&&(r="unknown"+String(e)),r},Je=new Map;Je.set("EXIFIFD",hr),Je.set("GPSIFD",dr);const Me={TIFF_TAGS:He,ifdTags:Je,GEO_KEYS:pr,getTagName:mr},Ge=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})();var ge,q,_e,bt,kt,Tt={exports:{}};bt=Tt,ge={unstuff:function(e,t,r,s,i,n,c,l){var o,a,h,f,u,d=(1<<r)-1,g=0,m=0,C=4*e.length-Math.ceil(r*s/8);if(e[e.length-1]<<=8*C,i)for(o=0;o<s;o++)m===0&&(h=e[g++],m=32),m>=r?(a=h>>>m-r&d,m-=r):(a=(h&d)<<(f=r-m)&d,a+=(h=e[g++])>>>(m=32-f)),t[o]=i[a];else for(u=Math.ceil((l-n)/c),o=0;o<s;o++)m===0&&(h=e[g++],m=32),m>=r?(a=h>>>m-r&d,m-=r):(a=(h&d)<<(f=r-m)&d,a+=(h=e[g++])>>>(m=32-f)),t[o]=a<u?n+a*c:l},unstuffLUT:function(e,t,r,s,i,n){var c,l=(1<<t)-1,o=0,a=0,h=0,f=0,u=0,d=[],g=4*e.length-Math.ceil(t*r/8);e[e.length-1]<<=8*g;var m=Math.ceil((n-s)/i);for(a=0;a<r;a++)f===0&&(c=e[o++],f=32),f>=t?(u=c>>>f-t&l,f-=t):(u=(c&l)<<(h=t-f)&l,u+=(c=e[o++])>>>(f=32-h)),d[a]=u<m?s+u*i:n;return d.unshift(s),d},unstuff2:function(e,t,r,s,i,n,c,l){var o,a,h,f,u=(1<<r)-1,d=0,g=0,m=0;if(i)for(o=0;o<s;o++)g===0&&(h=e[d++],g=32,m=0),g>=r?(a=h>>>m&u,g-=r,m+=r):(a=h>>>m&u,g=32-(f=r-g),a|=((h=e[d++])&(1<<f)-1)<<r-f,m=f),t[o]=i[a];else{var C=Math.ceil((l-n)/c);for(o=0;o<s;o++)g===0&&(h=e[d++],g=32,m=0),g>=r?(a=h>>>m&u,g-=r,m+=r):(a=h>>>m&u,g=32-(f=r-g),a|=((h=e[d++])&(1<<f)-1)<<r-f,m=f),t[o]=a<C?n+a*c:l}return t},unstuffLUT2:function(e,t,r,s,i,n){var c,l=(1<<t)-1,o=0,a=0,h=0,f=0,u=0,d=0,g=[],m=Math.ceil((n-s)/i);for(a=0;a<r;a++)f===0&&(c=e[o++],f=32,d=0),f>=t?(u=c>>>d&l,f-=t,d+=t):(u=c>>>d&l,f=32-(h=t-f),u|=((c=e[o++])&(1<<h)-1)<<t-h,d=h),g[a]=u<m?s+u*i:n;return g.unshift(s),g},originalUnstuff:function(e,t,r,s){var i,n,c,l,o=(1<<r)-1,a=0,h=0,f=4*e.length-Math.ceil(r*s/8);for(e[e.length-1]<<=8*f,i=0;i<s;i++)h===0&&(c=e[a++],h=32),h>=r?(n=c>>>h-r&o,h-=r):(n=(c&o)<<(l=r-h)&o,n+=(c=e[a++])>>>(h=32-l)),t[i]=n;return t},originalUnstuff2:function(e,t,r,s){var i,n,c,l,o=(1<<r)-1,a=0,h=0,f=0;for(i=0;i<s;i++)h===0&&(c=e[a++],h=32,f=0),h>=r?(n=c>>>f&o,h-=r,f+=r):(n=c>>>f&o,h=32-(l=r-h),n|=((c=e[a++])&(1<<l)-1)<<r-l,f=l),t[i]=n;return t}},q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var t=65535,r=65535,s=e.length,i=Math.floor(s/2),n=0;i;){var c=i>=359?359:i;i-=c;do t+=e[n++]<<8,r+=t+=e[n++];while(--c);t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16)}return 1&s&&(r+=t+=e[n]<<8),((r=(65535&r)+(r>>>16))<<16|(t=(65535&t)+(t>>>16)))>>>0},readHeaderInfo:function(e,t){var r=t.ptr,s=new Uint8Array(e,r,6),i={};if(i.fileIdentifierString=String.fromCharCode.apply(null,s),i.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;r+=6;var n,c=new DataView(e,r,8),l=c.getInt32(0,!0);if(i.fileVersion=l,r+=4,l>=3&&(i.checksum=c.getUint32(4,!0),r+=4),c=new DataView(e,r,12),i.height=c.getUint32(0,!0),i.width=c.getUint32(4,!0),r+=8,l>=4?(i.numDims=c.getUint32(8,!0),r+=4):i.numDims=1,c=new DataView(e,r,40),i.numValidPixel=c.getUint32(0,!0),i.microBlockSize=c.getInt32(4,!0),i.blobSize=c.getInt32(8,!0),i.imageType=c.getInt32(12,!0),i.maxZError=c.getFloat64(16,!0),i.zMin=c.getFloat64(24,!0),i.zMax=c.getFloat64(32,!0),r+=40,t.headerInfo=i,t.ptr=r,l>=3&&(n=l>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(e,r-n,i.blobSize-14))!==i.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var r=t.headerInfo,s=this.getDataTypeArray(r.imageType),i=r.numDims*this.getDataTypeSize(r.imageType),n=this.readSubArray(e,t.ptr,s,i),c=this.readSubArray(e,t.ptr+i,s,i);t.ptr+=2*i;var l,o=!0;for(l=0;l<r.numDims;l++)if(n[l]!==c[l]){o=!1;break}return r.minValues=n,r.maxValues=c,o},readSubArray:function(e,t,r,s){var i;if(r===Uint8Array)i=new Uint8Array(e,t,s);else{var n=new ArrayBuffer(s);new Uint8Array(n).set(new Uint8Array(e,t,s)),i=new r(n)}return i},readMask:function(e,t){var r,s,i=t.ptr,n=t.headerInfo,c=n.width*n.height,l=n.numValidPixel,o=new DataView(e,i,4),a={};if(a.numBytes=o.getUint32(0,!0),i+=4,(l===0||c===l)&&a.numBytes!==0)throw"invalid mask";if(l===0)r=new Uint8Array(Math.ceil(c/8)),a.bitset=r,s=new Uint8Array(c),t.pixels.resultMask=s,i+=a.numBytes;else if(a.numBytes>0){r=new Uint8Array(Math.ceil(c/8));var h=(o=new DataView(e,i,a.numBytes)).getInt16(0,!0),f=2,u=0,d=0;do{if(h>0)for(;h--;)r[u++]=o.getUint8(f++);else for(d=o.getUint8(f++),h=-h;h--;)r[u++]=d;h=o.getInt16(f,!0),f+=2}while(f<a.numBytes);if(h!==-32768||u<r.length)throw"Unexpected end of mask RLE encoding";s=new Uint8Array(c);var g=0,m=0;for(m=0;m<c;m++)7&m?(g=r[m>>3],g<<=7&m):g=r[m>>3],128&g&&(s[m]=1);t.pixels.resultMask=s,a.bitset=r,i+=a.numBytes}return t.ptr=i,t.mask=a,!0},readDataOneSweep:function(e,t,r,s){var i,n=t.ptr,c=t.headerInfo,l=c.numDims,o=c.width*c.height,a=c.imageType,h=c.numValidPixel*q.getDataTypeSize(a)*l,f=t.pixels.resultMask;if(r===Uint8Array)i=new Uint8Array(e,n,h);else{var u=new ArrayBuffer(h);new Uint8Array(u).set(new Uint8Array(e,n,h)),i=new r(u)}if(i.length===o*l)t.pixels.resultPixels=s?q.swapDimensionOrder(i,o,l,r,!0):i;else{t.pixels.resultPixels=new r(o*l);var d=0,g=0,m=0,C=0;if(l>1){if(s){for(g=0;g<o;g++)if(f[g])for(C=g,m=0;m<l;m++,C+=o)t.pixels.resultPixels[C]=i[d++]}else for(g=0;g<o;g++)if(f[g])for(C=g*l,m=0;m<l;m++)t.pixels.resultPixels[C+m]=i[d++]}else for(g=0;g<o;g++)f[g]&&(t.pixels.resultPixels[g]=i[d++])}return n+=h,t.ptr=n,!0},readHuffmanTree:function(e,t){var r=this.HUFFMAN_LUT_BITS_MAX,s=new DataView(e,t.ptr,16);if(t.ptr+=16,s.getInt32(0,!0)<2)throw"unsupported Huffman version";var i=s.getInt32(4,!0),n=s.getInt32(8,!0),c=s.getInt32(12,!0);if(n>=c)return!1;var l=new Uint32Array(c-n);q.decodeBits(e,t,l);var o,a,h,f,u=[];for(o=n;o<c;o++)u[a=o-(o<i?0:i)]={first:l[o-n],second:null};var d=e.byteLength-t.ptr,g=Math.ceil(d/4),m=new ArrayBuffer(4*g);new Uint8Array(m).set(new Uint8Array(e,t.ptr,d));var C,p=new Uint32Array(m),y=0,v=0;for(C=p[0],o=n;o<c;o++)(f=u[a=o-(o<i?0:i)].first)>0&&(u[a].second=C<<y>>>32-f,32-y>=f?(y+=f)===32&&(y=0,C=p[++v]):(y+=f-32,C=p[++v],u[a].second|=C>>>32-y));var x=0,w=0,k=new _e;for(o=0;o<u.length;o++)u[o]!==void 0&&(x=Math.max(x,u[o].first));w=x>=r?r:x;var b,T,S,M,A,P=[];for(o=n;o<c;o++)if((f=u[a=o-(o<i?0:i)].first)>0)if(b=[f,a],f<=w)for(T=u[a].second<<w-f,S=1<<w-f,h=0;h<S;h++)P[T|h]=b;else for(T=u[a].second,A=k,M=f-1;M>=0;M--)T>>>M&1?(A.right||(A.right=new _e),A=A.right):(A.left||(A.left=new _e),A=A.left),M!==0||A.val||(A.val=b[1]);return{decodeLut:P,numBitsLUTQick:w,numBitsLUT:x,tree:k,stuffedData:p,srcPtr:v,bitPos:y}},readHuffman:function(e,t,r,s){var i,n,c,l,o,a,h,f,u,d=t.headerInfo.numDims,g=t.headerInfo.height,m=t.headerInfo.width,C=m*g,p=this.readHuffmanTree(e,t),y=p.decodeLut,v=p.tree,x=p.stuffedData,w=p.srcPtr,k=p.bitPos,b=p.numBitsLUTQick,T=p.numBitsLUT,S=t.headerInfo.imageType===0?128:0,M=t.pixels.resultMask,A=0;k>0&&(w++,k=0);var P,I=x[w],D=t.encodeMode===1,O=new r(C*d),L=O;if(d<2||D){for(P=0;P<d;P++)if(d>1&&(L=new r(O.buffer,C*P,C),A=0),t.headerInfo.numValidPixel===m*g)for(f=0,a=0;a<g;a++)for(h=0;h<m;h++,f++){if(n=0,o=l=I<<k>>>32-b,32-k<b&&(o=l|=x[w+1]>>>64-k-b),y[o])n=y[o][1],k+=y[o][0];else for(o=l=I<<k>>>32-T,32-k<T&&(o=l|=x[w+1]>>>64-k-T),i=v,u=0;u<T;u++)if(!(i=l>>>T-u-1&1?i.right:i.left).left&&!i.right){n=i.val,k=k+u+1;break}k>=32&&(k-=32,I=x[++w]),c=n-S,D?(c+=h>0?A:a>0?L[f-m]:A,c&=255,L[f]=c,A=c):L[f]=c}else for(f=0,a=0;a<g;a++)for(h=0;h<m;h++,f++)if(M[f]){if(n=0,o=l=I<<k>>>32-b,32-k<b&&(o=l|=x[w+1]>>>64-k-b),y[o])n=y[o][1],k+=y[o][0];else for(o=l=I<<k>>>32-T,32-k<T&&(o=l|=x[w+1]>>>64-k-T),i=v,u=0;u<T;u++)if(!(i=l>>>T-u-1&1?i.right:i.left).left&&!i.right){n=i.val,k=k+u+1;break}k>=32&&(k-=32,I=x[++w]),c=n-S,D?(h>0&&M[f-1]?c+=A:a>0&&M[f-m]?c+=L[f-m]:c+=A,c&=255,L[f]=c,A=c):L[f]=c}}else for(f=0,a=0;a<g;a++)for(h=0;h<m;h++)if(f=a*m+h,!M||M[f])for(P=0;P<d;P++,f+=C){if(n=0,o=l=I<<k>>>32-b,32-k<b&&(o=l|=x[w+1]>>>64-k-b),y[o])n=y[o][1],k+=y[o][0];else for(o=l=I<<k>>>32-T,32-k<T&&(o=l|=x[w+1]>>>64-k-T),i=v,u=0;u<T;u++)if(!(i=l>>>T-u-1&1?i.right:i.left).left&&!i.right){n=i.val,k=k+u+1;break}k>=32&&(k-=32,I=x[++w]),c=n-S,L[f]=c}t.ptr=t.ptr+4*(w+1)+(k>0?4:0),t.pixels.resultPixels=O,d>1&&!s&&(t.pixels.resultPixels=q.swapDimensionOrder(O,C,d,r))},decodeBits:function(e,t,r,s,i){var n=t.headerInfo,c=n.fileVersion,l=0,o=e.byteLength-t.ptr>=5?5:e.byteLength-t.ptr,a=new DataView(e,t.ptr,o),h=a.getUint8(0);l++;var f=h>>6,u=f===0?4:3-f,d=(32&h)>0,g=31&h,m=0;if(u===1)m=a.getUint8(l),l++;else if(u===2)m=a.getUint16(l,!0),l+=2;else{if(u!==4)throw"Invalid valid pixel count type";m=a.getUint32(l,!0),l+=4}var C,p,y,v,x,w,k,b,T,S=2*n.maxZError,M=n.numDims>1?n.maxValues[i]:n.zMax;if(d){for(t.counter.lut++,b=a.getUint8(l),l++,v=Math.ceil((b-1)*g/8),x=Math.ceil(v/4),p=new ArrayBuffer(4*x),y=new Uint8Array(p),t.ptr+=l,y.set(new Uint8Array(e,t.ptr,v)),k=new Uint32Array(p),t.ptr+=v,T=0;b-1>>>T;)T++;v=Math.ceil(m*T/8),x=Math.ceil(v/4),p=new ArrayBuffer(4*x),(y=new Uint8Array(p)).set(new Uint8Array(e,t.ptr,v)),C=new Uint32Array(p),t.ptr+=v,w=c>=3?ge.unstuffLUT2(k,g,b-1,s,S,M):ge.unstuffLUT(k,g,b-1,s,S,M),c>=3?ge.unstuff2(C,r,T,m,w):ge.unstuff(C,r,T,m,w)}else t.counter.bitstuffer++,T=g,t.ptr+=l,T>0&&(v=Math.ceil(m*T/8),x=Math.ceil(v/4),p=new ArrayBuffer(4*x),(y=new Uint8Array(p)).set(new Uint8Array(e,t.ptr,v)),C=new Uint32Array(p),t.ptr+=v,c>=3?s==null?ge.originalUnstuff2(C,r,T,m):ge.unstuff2(C,r,T,m,!1,s,S,M):s==null?ge.originalUnstuff(C,r,T,m):ge.unstuff(C,r,T,m,!1,s,S,M))},readTiles:function(e,t,r,s){var i=t.headerInfo,n=i.width,c=i.height,l=n*c,o=i.microBlockSize,a=i.imageType,h=q.getDataTypeSize(a),f=Math.ceil(n/o),u=Math.ceil(c/o);t.pixels.numBlocksY=u,t.pixels.numBlocksX=f,t.pixels.ptr=0;var d,g,m,C,p,y,v,x,w,k,b=0,T=0,S=0,M=0,A=0,P=0,I=0,D=0,O=0,L=0,U=0,V=0,j=0,E=0,B=0,R=new r(o*o),N=c%o||o,_=n%o||o,F=i.numDims,Q=t.pixels.resultMask,oe=t.pixels.resultPixels,Se=i.fileVersion>=5?14:15,le=i.zMax;for(S=0;S<u;S++)for(A=S!==u-1?o:N,M=0;M<f;M++)for(L=S*n*o+M*o,U=n-(P=M!==f-1?o:_),x=0;x<F;x++){if(F>1?(k=oe,L=S*n*o+M*o,oe=new r(t.pixels.resultPixels.buffer,l*x*h,l),le=i.maxValues[x]):k=null,I=e.byteLength-t.ptr,g={},B=0,D=(d=new DataView(e,t.ptr,Math.min(10,I))).getUint8(0),B++,w=i.fileVersion>=5?4&D:0,O=D>>6&255,(D>>2&Se)!=(M*o>>3&Se)||w&&x===0)throw"integrity issue";if((p=3&D)>3)throw t.ptr+=B,"Invalid block encoding ("+p+")";if(p!==2)if(p===0){if(w)throw"integrity issue";if(t.counter.uncompressed++,t.ptr+=B,V=(V=A*P*h)<(j=e.byteLength-t.ptr)?V:j,m=new ArrayBuffer(V%h==0?V:V+h-V%h),new Uint8Array(m).set(new Uint8Array(e,t.ptr,V)),C=new r(m),E=0,Q)for(b=0;b<A;b++){for(T=0;T<P;T++)Q[L]&&(oe[L]=C[E++]),L++;L+=U}else for(b=0;b<A;b++){for(T=0;T<P;T++)oe[L++]=C[E++];L+=U}t.ptr+=E*h}else if(y=q.getDataTypeUsed(w&&a<6?4:a,O),v=q.getOnePixel(g,B,y,d),B+=q.getDataTypeSize(y),p===3)if(t.ptr+=B,t.counter.constantoffset++,Q)for(b=0;b<A;b++){for(T=0;T<P;T++)Q[L]&&(oe[L]=w?Math.min(le,k[L]+v):v),L++;L+=U}else for(b=0;b<A;b++){for(T=0;T<P;T++)oe[L]=w?Math.min(le,k[L]+v):v,L++;L+=U}else if(t.ptr+=B,q.decodeBits(e,t,R,v,x),B=0,w)if(Q)for(b=0;b<A;b++){for(T=0;T<P;T++)Q[L]&&(oe[L]=R[B++]+k[L]),L++;L+=U}else for(b=0;b<A;b++){for(T=0;T<P;T++)oe[L]=R[B++]+k[L],L++;L+=U}else if(Q)for(b=0;b<A;b++){for(T=0;T<P;T++)Q[L]&&(oe[L]=R[B++]),L++;L+=U}else for(b=0;b<A;b++){for(T=0;T<P;T++)oe[L++]=R[B++];L+=U}else{if(w)if(Q)for(b=0;b<A;b++)for(T=0;T<P;T++)Q[L]&&(oe[L]=k[L]),L++;else for(b=0;b<A;b++)for(T=0;T<P;T++)oe[L]=k[L],L++;t.counter.constant++,t.ptr+=B}}F>1&&!s&&(t.pixels.resultPixels=q.swapDimensionOrder(t.pixels.resultPixels,l,F,r))},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:q.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e,t){var r=e.headerInfo.zMax,s=e.headerInfo.zMin,i=e.headerInfo.maxValues,n=e.headerInfo.numDims,c=e.headerInfo.height*e.headerInfo.width,l=0,o=0,a=0,h=e.pixels.resultMask,f=e.pixels.resultPixels;if(h)if(n>1){if(t)for(l=0;l<n;l++)for(a=l*c,r=i[l],o=0;o<c;o++)h[o]&&(f[a+o]=r);else for(o=0;o<c;o++)if(h[o])for(a=o*n,l=0;l<n;l++)f[a+n]=i[l]}else for(o=0;o<c;o++)h[o]&&(f[o]=r);else if(n>1&&s!==r)if(t)for(l=0;l<n;l++)for(a=l*c,r=i[l],o=0;o<c;o++)f[a+o]=r;else for(o=0;o<c;o++)for(a=o*n,l=0;l<n;l++)f[a+l]=i[l];else for(o=0;o<c*n;o++)f[o]=r},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:default:t=Float32Array;break;case 7:t=Float64Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:default:t="F32";break;case 7:t="F64"}return t},isValidPixelValue:function(e,t){if(t==null)return!1;var r;switch(e){case 0:r=t>=-128&&t<=127;break;case 1:r=t>=0&&t<=255;break;case 2:r=t>=-32768&&t<=32767;break;case 3:r=t>=0&&t<=65536;break;case 4:r=t>=-2147483648&&t<=2147483647;break;case 5:r=t>=0&&t<=4294967296;break;case 6:r=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:r=t>=5e-324&&t<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var r=e;switch(e){case 2:case 4:r=e-t;break;case 3:case 5:r=e-2*t;break;case 6:r=t===0?e:t===1?2:1;break;case 7:r=t===0?e:e-2*t+1;break;default:r=e}return r},getOnePixel:function(e,t,r,s){var i=0;switch(r){case 0:i=s.getInt8(t);break;case 1:i=s.getUint8(t);break;case 2:i=s.getInt16(t,!0);break;case 3:i=s.getUint16(t,!0);break;case 4:i=s.getInt32(t,!0);break;case 5:i=s.getUInt32(t,!0);break;case 6:i=s.getFloat32(t,!0);break;case 7:i=s.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return i},swapDimensionOrder:function(e,t,r,s,i){var n=0,c=0,l=0,o=0,a=e;if(r>1)if(a=new s(t*r),i)for(n=0;n<t;n++)for(o=n,l=0;l<r;l++,o+=t)a[o]=e[c++];else for(n=0;n<t;n++)for(o=n,l=0;l<r;l++,o+=t)a[c++]=e[o];return a}},_e=function(e,t,r){this.val=e,this.left=t,this.right=r},(kt={decode:function(e,t){var r=(t=t||{}).noDataValue,s=0,i={};i.ptr=t.inputOffset||0,i.pixels={},q.readHeaderInfo(e,i);var n=i.headerInfo,c=n.fileVersion,l=q.getDataTypeArray(n.imageType);if(c>5)throw"unsupported lerc version 2."+c;q.readMask(e,i),n.numValidPixel===n.width*n.height||i.pixels.resultMask||(i.pixels.resultMask=t.maskData);var o=n.width*n.height;i.pixels.resultPixels=new l(o*n.numDims),i.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var a,h=!t.returnPixelInterleavedDims;if(n.numValidPixel!==0)if(n.zMax===n.zMin)q.constructConstantSurface(i,h);else if(c>=4&&q.checkMinMaxRanges(e,i))q.constructConstantSurface(i,h);else{var f=new DataView(e,i.ptr,2),u=f.getUint8(0);if(i.ptr++,u)q.readDataOneSweep(e,i,l,h);else if(c>1&&n.imageType<=1&&Math.abs(n.maxZError-.5)<1e-5){var d=f.getUint8(1);if(i.ptr++,i.encodeMode=d,d>2||c<4&&d>1)throw"Invalid Huffman flag "+d;d?q.readHuffman(e,i,l,h):q.readTiles(e,i,l,h)}else q.readTiles(e,i,l,h)}i.eofOffset=i.ptr,t.inputOffset?(a=i.headerInfo.blobSize+t.inputOffset-i.ptr,Math.abs(a)>=1&&(i.eofOffset=t.inputOffset+i.headerInfo.blobSize)):(a=i.headerInfo.blobSize-i.ptr,Math.abs(a)>=1&&(i.eofOffset=i.headerInfo.blobSize));var g={width:n.width,height:n.height,pixelData:i.pixels.resultPixels,minValue:n.zMin,maxValue:n.zMax,validPixelCount:n.numValidPixel,dimCount:n.numDims,dimStats:{minValues:n.minValues,maxValues:n.maxValues},maskData:i.pixels.resultMask};if(i.pixels.resultMask&&q.isValidPixelValue(n.imageType,r)){var m=i.pixels.resultMask;for(s=0;s<o;s++)m[s]||(g.pixelData[s]=r);g.noDataValue=r}return i.noDataValue=r,t.returnFileInfo&&(g.fileInfo=q.formatFileInfo(i)),g},getBandCount:function(e){for(var t=0,r=0,s={ptr:0,pixels:{}};r<e.byteLength-58;)q.readHeaderInfo(e,s),r+=s.headerInfo.blobSize,t++,s.ptr=r;return t}})!==void 0&&(bt.exports=kt);const St=Tt.exports,At=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],De=4294967296,gr=new Set([1,5,6,7,8,34712,34887]);function It(e,t){let r="unknown";return e===3?r="f32":e===1?t===1?r="u1":t===2?r="u2":t===4?r="u4":t<=8?r="u8":t<=16?r="u16":t<=32&&(r="u32"):e===2&&(t<=8?r="s8":t<=16?r="s16":t<=32&&(r="s32")),r}function Ne(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;default:t=Float32Array}return t}function yr(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function Mt(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function be(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function qe(e,t){var r;return(r=e.get(t))==null?void 0:r.values[0]}function K(e,t){var r;return(r=e.get(t))==null?void 0:r.values[0]}function Xe(e,t,r,s=0,i=Me.TIFF_TAGS,n=4){const c=n===8,l=c?tt(new DataView(e,r,8),0,t):new DataView(e,r,2).getUint16(0,t),o=4+2*n,a=c?8:2,h=a+l*o;if(r+h>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:h};const f=r+h+4<=e.byteLength?Ve(new DataView(e,r+h,n===8?8:4),0,t,n===8):null,u=r+a,d=new Map;let g,m,C,p,y,v,x;for(let w=0;w<l;w++){m=new DataView(e,u+o*w,o),C=m.getUint16(0,t),y=m.getUint16(2,t),p=Me.getTagName(C,i);const k=[];n===2?(v=m.getUint16(4,t),x=m.getUint16(6,t)):n===4?(v=m.getUint32(4,t),x=m.getUint32(8,t)):n===8&&(v=Ve(m,4,t,!0),x=Ve(m,12,t,!0),k.push(m.getUint32(12,t)),k.push(m.getUint32(16,t))),g={id:C,type:y,valueCount:v,valueOffset:x,valueOffsets:k,values:null},kr(e,t,g,s,!1,n),d.set(p,g)}return{success:!0,ifd:d,nextIFD:f,requiredBufferSize:h}}const wr=function(e,t){return St.decode(e,{inputOffset:t,returnFileInfo:!0}).pixelData},Ze=function(e,t,r,s,i){var n,c;const l=Ge===t,o=K(r,"BITSPERSAMPLE"),a=It((n=K(r,"SAMPLEFORMAT"))!=null?n:1,o),h=(c=K(r,"COMPRESSION"))!=null?c:1,f=Ne(a);let u,d,g,m,C,p,y;if(h===34887)return wr(e,s);if(h===1)g=e.slice(s,s+i),m=new Uint8Array(g);else if(h===8||h===32946)m=new Uint8Array(e,s,i),p=new xe(m),y=p.getBytes(),g=new ArrayBuffer(y.length),m=new Uint8Array(g),m.set(y);else if(h===6){m=new Uint8Array(e,s,i);const v=new Be;v.parse(m);const x=v.getData(v.width,v.height,!0);g=new ArrayBuffer(x.length),m=new Uint8Array(g),m.set(x)}else if(h===7){const v=r.get("JPEGTABLES").values,x=v.length-2;m=new Uint8Array(x+i-2);for(let T=0;T<x;T++)m[T]=v[T];const w=new Uint8Array(e,s+2,i-2);for(let T=0;T<w.length;T++)m[x+T]=w[T];const k=new Be;k.parse(m);const b=k.getData(k.width,k.height,!0);g=new ArrayBuffer(b.length),m=new Uint8Array(g),m.set(b)}else h===5&&(m=Ye(e,s,i,t),g=m.buffer);if(a==="u8"||a==="s8"||l)d=new f(g);else{switch(g=new ArrayBuffer(m.length),C=new Uint8Array(g),a){case"u16":case"s16":for(u=0;u<m.length;u+=2)C[u]=m[u+1],C[u+1]=m[u];break;case"u32":case"s32":case"f32":for(u=0;u<m.length;u+=4)C[u]=m[u+3],C[u+1]=m[u+2],C[u+2]=m[u+1],C[u+3]=m[u]}d=new f(g)}return d},Cr=function(e,t,r){var s;const i=be(r,"TILEOFFSETS");if(i===void 0)return null;const n=be(r,"TILEBYTECOUNTS"),{width:c,height:l,pixelType:o,tileWidth:a,tileHeight:h}=Qe([r]),f=et(r,t),u=t.planes,d=c*l,g=K(r,"BITSPERSAMPLE"),m=((s=K(r,"COMPRESSION"))!=null?s:1)===34887,C=Ne(o),p=[];for(let L=0;L<u;L++)p.push(new C(d));let y,v,x,w,k,b,T,S,M,A,P,I,D;const O=Math.ceil(c/a);if(g%8==0)if(m&&f&&u>1){const L=Math.round(i.length/u);for(y=0;y<L;y++){b=Math.floor(y/O)*h,T=y%O*a,S=b*c+T;for(let U=0;U<u;U++){const V=y*u+U;for(x=Ze(e,t.littleEndian,r,i[V],n[V]),A=0,M=S,I=Math.min(a,c-T),P=Math.min(h,l-b),D=p[U],w=0;w<P;w++)for(M=S+w*c,A=w*a,k=0;k<I;k++,M++,A++)D[M]=x[A]}}}else for(y=0;y<i.length;y++)for(b=Math.floor(y/O)*h,T=y%O*a,S=b*c+T,x=Ze(e,t.littleEndian,r,i[y],n[y]),A=0,M=S,I=Math.min(a,c-T),P=Math.min(h,l-b),v=0;v<u;v++)if(D=p[v],f||m)for(w=0;w<P;w++)for(M=S+w*c,A=a*h*v+w*a,k=0;k<I;k++,M++,A++)D[M]=x[A];else for(w=0;w<P;w++)for(M=S+w*c,A=w*a*u+v,k=0;k<I;k++,M++,A+=u)D[M]=x[A];return{width:c,height:l,pixelType:o,pixels:p}},vr=function(e,t,r){var s;const i=Ge===t.littleEndian,n=be(r,"STRIPOFFSETS");if(n===void 0)return null;const{width:c,height:l,pixelType:o}=Qe([r]),a=t.planes,h=c*l,f=K(r,"BITSPERSAMPLE"),u=Ne(o),d=new u(h*a),g=be(r,"STRIPBYTECOUNTS"),m=K(r,"ROWSPERSTRIP"),C=(s=K(r,"COMPRESSION"))!=null?s:1;let p,y,v,x,w,k,b,T,S,M,A,P=m;if(f%8==0)for(p=0;p<n.length;p++){if(w=p*(m*c)*a,P=(p+1)*m>l?l-p*m:m,o==="u8"||o==="s8"||i){if(C===8||C===32946)b=new Uint8Array(e,n[p],g[p]),M=new xe(b),A=M.getBytes(),k=new ArrayBuffer(A.length),b=new Uint8Array(k),b.set(A),b.length!==P*c*a*f/8&&console.log("strip byte counts is different than expected");else if(C===6){b=new Uint8Array(e,n[p],g[p]);const D=new Be;D.parse(b);const O=D.getData(D.width,D.height,!0);k=new ArrayBuffer(O.length),b=new Uint8Array(k),b.set(O)}else C===5?(b=Ye(e,n[p],g[p],t.littleEndian),k=b.buffer):C===1&&(g[p]!==P*c*a*f/8&&console.log("strip byte counts is different than expected"),k=e.slice(n[p],n[p]+g[p]));x=new u(k)}else{switch(C===6||C===8||C===32946?(b=new Uint8Array(e,n[p],g[p]),M=new xe(b),b=M.getBytes(),k=new ArrayBuffer(b.length),T=new Uint8Array(k),b.length!==P*c*a*f/8&&console.log("strip byte counts is different than expected")):C===1&&(g[p]!==P*c*a*f/8&&console.log("strip byte counts is different than expected"),k=new ArrayBuffer(g[p]),b=new Uint8Array(e,n[p],g[p]),T=new Uint8Array(k)),o){case"u16":case"s16":for(v=0;v<b.length;v+=2)T[v]=b[v+1],T[v+1]=b[v];break;case"u32":case"s32":case"f32":for(v=0;v<b.length;v+=4)T[v]=b[v+3],T[v+1]=b[v+2],T[v+2]=b[v+1],T[v+3]=b[v]}x=new u(k)}d.set(x,w)}const I=[];if(a===1)I.push(d);else for(p=0;p<a;p++){for(S=new u(h),y=0;y<h;y++)S[y]=d[y*a+p];I.push(S)}return{width:c,height:l,pixelType:o,pixels:I}},xr=function(e,t,r){if(!(e&&e.length>0&&t&&r))return null;let s,i,n;const c=e[0].length,l=e.length,o=new Uint8Array(c);for(let a=0;a<l;a++)if(s=e[a],i=t[a],n=r[a],a===0)for(let h=0;h<c;h++)o[h]=s[h]<i||s[h]>n?0:1;else for(let h=0;h<c;h++)o[h]&&(o[h]=s[h]<i||s[h]>n?0:1);return o},br=function(e){if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const r=new Map;let s,i,n,c,l;for(let p=0;p<t.length;p++)s=t[p],i=s.slice("<Item ".length,s.indexOf(">")),c=s.indexOf("sample="),c>-1&&(l=s.slice(c+'sample="'.length,s.indexOf('"',c+'sample="'.length))),c=s.indexOf("name="),c>-1&&(i=s.slice(c+'name="'.length,s.indexOf('"',c+'name="'.length))),i&&(n=s.slice(s.indexOf(">")+1,s.indexOf("</Item>")).trim(),l!=null?r.has(i)?r.get(i)[l]=n:r.set(i,[n]):r.set(i,n)),l=null;const o=r.get("STATISTICS_MINIMUM"),a=r.get("STATISTICS_MAXIMUM"),h=r.get("STATISTICS_MEAN"),f=r.get("STATISTICS_STDDEV");let u=null;if(o&&a){u=[];for(let p=0;p<o.length;p++)u.push({min:parseFloat(o[p]),max:parseFloat(a[p]),avg:h&&parseFloat(h[p]),stddev:f&&parseFloat(f[p])})}const d=r.get("BandName"),g=r.get("WavelengthMin"),m=r.get("WavelengthMax");let C=null;if(d){C=[];for(let p=0;p<d.length;p++)C.push({BandName:d[p],WavelengthMin:g&&parseFloat(g[p]),WavelengthMax:m&&parseFloat(m[p])})}return{statistics:u,bandProperties:C,dataType:r.get("DataType"),rawMetadata:r}};function kr(e,t,r,s=0,i=!1,n=4){if(r.values)return!0;const c=r.type,l=r.valueCount;let o=r.valueOffset,a=[];const h=At[c],f=8*h,u=l*h,d=l*At[c]*8;let g,m;const C=n===8?64:32,p=r.valueOffsets;if(d>C&&u>(i?e.byteLength:e?e.byteLength-o+s:0))return r.offlineOffsetSize=[o,u],r.values=null,!1;if(d<=C){if(!t)if(C<=32)o>>>=32-d;else{const y=p!=null&&p.length?p[0]:o>>>0,v=p!=null&&p.length?p[1]:Math.round((o-y)/De);d<=32?(o=y>>>32-d,p[0]=o):(o=y*2**(32-d)+(v>>>32-d),p[0]=y,p[1]=v>>>32-d)}if(l===1&&f===C)a=[o];else if(C===64){const y=p!=null&&p.length?p[0]:o>>>0,v=p!=null&&p.length?p[1]:Math.round((o-y)/De);let x=y,w=32;for(m=1;m<=l;m++){const k=32-f*m%32;if(w<f){const b=x<<k>>>32-w,T=v<<32-w>>>32-w;x=v,a.push(b+T*2**(f-w)),w-=32-(f-w)}else a.push(x<<k>>>32-f),w-=f;w===0&&(w=32,x=v)}}else for(m=1;m<=l;m++){const y=32-f*m;a.push(o<<y>>>32-f)}}else{o-=s,i&&(o=0);for(let y=o;y<o+u;y+=h){switch(c){case 1:case 2:case 7:g=new DataView(e,y,1).getUint8(0);break;case 3:g=new DataView(e,y,2).getUint16(0,t);break;case 4:case 13:g=new DataView(e,y,4).getUint32(0,t);break;case 5:g=new DataView(e,y,4).getUint32(0,t)/new DataView(e,y+4,4).getUint32(0,t);break;case 6:g=new DataView(e,y,1).getInt8(0);break;case 8:g=new DataView(e,y,2).getInt16(0,t);break;case 9:g=new DataView(e,y,4).getInt32(0,t);break;case 10:g=new DataView(e,y,4).getInt32(0,t)/new DataView(e,y+4,4).getInt32(0,t);break;case 11:g=new DataView(e,y,4).getFloat32(0,t);break;case 12:g=new DataView(e,y,8).getFloat64(0,t);break;case 16:case 18:g=tt(new DataView(e,y,8),0,t);break;case 17:g=Sr(new DataView(e,y,8),0,t);break;default:g=null}a.push(g)}}if(c===2){let y="";const v=a;for(a=[],m=0;m<v.length;m++)v[m]===0&&y!==""?(a.push(y),y=""):y+=String.fromCharCode(v[m]);y===""&&a.length!==0||a.push(y)}return r.values=a,!0}function Qe(e){var t,r;const s=e[0],i=K(s,"TILEWIDTH"),n=K(s,"TILELENGTH"),c=K(s,"IMAGEWIDTH"),l=K(s,"IMAGELENGTH"),o=K(s,"BITSPERSAMPLE"),a=K(s,"SAMPLESPERPIXEL"),h=(t=K(s,"SAMPLEFORMAT"))!=null?t:1,f=It(h,o),u=et(s),d=Mt(s,"GDAL_NODATA");let g;d!=null&&d.length&&(g=d.map(E=>parseFloat(E)),g.some(E=>isNaN(E))&&(g=null));const m=(r=K(s,"COMPRESSION"))!=null?r:1;let C;switch(m){case 1:C="NONE";break;case 2:case 3:case 4:case 32771:C="CCITT";break;case 5:C="LZW";break;case 6:case 7:C="JPEG";break;case 32773:C="PACKBITS";break;case 8:case 32946:C="DEFLATE";break;case 34712:C="JPEG2000";break;case 34887:C="LERC";break;default:C=String(m)}let p=!0,y="";gr.has(m)||(p=!1,y+="unsupported tag compression "+m),h>3&&(p=!1,y+="unsupported tag sampleFormat "+h),o%8!=0&&(p=!1,y+="unsupported tag bitsPerSample "+o);const v=qe(s,"GEOASCIIPARAMS");let x;if(v){const E=v.split("|").filter(R=>R.indexOf("ESRI PE String = ")>-1)[0],B=E?E.replace("ESRI PE String = ",""):"";x=B.startsWith("COMPD_CS")||B.startsWith("PROJCS")||B.startsWith("GEOGCS")?{wkid:null,wkt:B}:null}const w=be(s,"GEOTIEPOINTS"),k=be(s,"GEOPIXELSCALE"),b=be(s,"GEOTRANSMATRIX"),T=s.has("GEOKEYDIRECTORY")?s.get("GEOKEYDIRECTORY").data:null;let S,M,A=!1;if(T){A=K(T,"GTRasterTypeGeoKey")===2;const E=K(T,"GTModelTypeGeoKey");if(E===2){const B=K(T,"GeographicTypeGeoKey");B>=1024&&B<=32766&&(x={wkid:B})}else if(E===1){const B=K(T,"ProjectedCSTypeGeoKey");B>=1024&&B<=32766&&(x={wkid:B})}}if(k&&w&&w.length>=6?(S=[k[0],0,w[3]-w[0]*k[0],0,-Math.abs(k[1]),w[4]-w[1]*k[1]],A&&(S[2]-=.5*S[0]+.5*S[1],S[5]-=.5*S[3]+.5*S[4])):b&&b.length===16&&(S=A?[b[0],b[1],b[3]-.5*b[0],b[4],b[5],b[7]-.5*b[5]]:[b[0],b[1],b[3],b[4],b[5],b[7]]),S){const E=[{x:0,y:l},{x:0,y:0},{x:c,y:l},{x:c,y:0}];let B,R=Number.POSITIVE_INFINITY,N=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,F=Number.NEGATIVE_INFINITY;for(let Q=0;Q<E.length;Q++)B=yr(E[Q],S),R=B.x>R?R:B.x,_=B.x<_?_:B.x,N=B.y>N?N:B.y,F=B.y<F?F:B.y;M={xmin:R,xmax:_,ymin:N,ymax:F,spatialReference:x}}else M={xmin:-.5,ymin:.5-l,xmax:c-.5,ymax:.5,spatialReference:x};const P=e.filter(E=>qe(E,"NEWSUBFILETYPE")===1);let I,D,O,L,U;if(P.length>0){I=Math.round(Math.log(c/K(P[0],"IMAGEWIDTH"))/Math.LN2);const E=P[P.length-1];D=Math.round(Math.log(c/K(E,"IMAGEWIDTH"))/Math.LN2),O=K(E,"TILEWIDTH"),L=K(E,"TILELENGTH")}O=D>0?O||i:null,L=D>0?L||n:null,i&&(U=[{maxCol:Math.ceil(c/i)-1,maxRow:Math.ceil(l/n)-1,minRow:0,minCol:0}],P.forEach(E=>{U.push({maxCol:Math.ceil(K(E,"IMAGEWIDTH")/K(E,"TILEWIDTH"))-1,maxRow:Math.ceil(K(E,"IMAGELENGTH")/K(E,"TILELENGTH"))-1,minRow:0,minCol:0})}));const V=qe(e[0],"GDAL_METADATA"),j=br(V);return y+=" "+Dt({width:c,height:l,tileWidth:i,tileHeight:n,planes:a,ifds:e}),{width:c,height:l,tileWidth:i,tileHeight:n,planes:a,isBSQ:u,pixelType:f,compression:C,noData:g,isSupported:p,message:y,extent:M,affine:k?null:S,firstPyramidLevel:I,maximumPyramidLevel:D,pyramidBlockWidth:O,pyramidBlockHeight:L,tileBoundary:U,metadata:j}}function et(e,t){const r=Mt(e,"PLANARCONFIGURATION");return r?r[0]===2:!!t&&t.isBSQ}function Tr(e){const{littleEndian:t,isBigTiff:r,firstIFD:s}=Ar(e);let i=s;const n=[];do{const c=Ir(e,t,i,0,Me.TIFF_TAGS,r?8:4);if(!c.success)break;n.push(c.ifd),i=c.nextIFD}while(i>0);return me(se({},Qe(n)),{littleEndian:t,isBigTiff:r,ifds:n})}function tt(e,t,r){const s=e.getUint32(t,r),i=e.getUint32(t+4,r);return r?i*De+s:s*De+i}function Sr(e,t,r){let s=r?e.getInt32(t,r):e.getUint32(t,r),i=r?e.getUint32(t+4,r):e.getInt32(t+4,r);const n=(r?s:i)>=0?1:-1;return r?s*=n:i*=n,n*(r?i*De+s:s*De+i)}function Ve(e,t,r,s){return s?tt(e,t,r):e.getUint32(t,r)}function Ar(e){const t=new DataView(e,0,16),r=t.getUint16(0,!1);let s=null;if(r===18761)s=!0;else{if(r!==19789)throw"unexpected endianess byte";s=!1}const i=t.getUint16(2,s);if(i!==42&&i!==43)throw"unexpected tiff identifier";let n=4;const c=i===43;if(c){const l=t.getUint16(n,s);if(n+=2,l!==8||t.getUint16(n,s)!==0)throw"unsupported bigtiff version";n+=2}return{littleEndian:s,isBigTiff:c,firstIFD:Ve(t,n,s,c)}}function Ir(e,t,r,s=0,i=Me.TIFF_TAGS,n=4){const c=Xe(e,t,r,s,i,n);let l;const o=c.ifd;if(o){if(Me.ifdTags.forEach((a,h)=>{o.has(h)&&(l=o.get(h),l.data=Xe(e,t,l.valueOffset-s,s,a).ifd)}),o.has("GEOKEYDIRECTORY")){l=o.get("GEOKEYDIRECTORY");const a=l.values;if(a&&a.length>4){const h=a[0]+"."+a[1]+"."+a[2];l.data=Xe(e,t,l.valueOffset+6-s,s,Me.GEO_KEYS,2).ifd,l.data&&l.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[h]})}}if(o.has("XMP")){l=o.get("XMP");const a=l.values;typeof a[0]=="number"&&l.type===7&&(l.values=[ur(new Uint8Array(a))])}}return c}function Dt(e){const{width:t,height:r,tileHeight:s,tileWidth:i}=e,n=e.planes,c=i?i*s:t*r,l=K(e.ifds[0],"BITSPERSAMPLE");let o="";return c*n>2**30/(l>8?l/8:1)&&(o=i?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),o}function Mr(e,t){var r;const{headerInfo:s,ifd:i,offsets:n,sizes:c}=t,l=n.map((M,A)=>Ze(e,s.littleEndian,i,M,c[A]||e.byteLength)),o=et(i,s),{pixelType:a,planes:h}=s,f=Ne(a),u=K(i,"TILEWIDTH"),d=K(i,"TILELENGTH"),g=(r=K(i,"COMPRESSION"))!=null?r:1,m=u*d;let C;const p=[];let y=l[0];const v=g===34887;for(let M=0;M<h;M++){if(C=new f(m),o&&v){y=l[M];for(let A=0;A<m;A++)C[A]=y[M][A+M]}else if(o||v&&!o)C=y.slice(m*M,m*(M+1));else for(let A=0;A<m;A++)C[A]=y[A*h+M];p.push(C)}const x=s.noData?s.noData[0]:null,w=s.metadata?s.metadata.statistics:null,k=w?w.map(M=>M.min):null,b=w?w.map(M=>M.max):null;let T,S;if(x!=null)if(T=new Uint8Array(m),Math.abs(x)>1e24)for(S=0;S<m;S++)Math.abs((p[0][S]-x)/x)<1e-6?T[S]=0:T[S]=1;else for(S=0;S<m;S++)p[0][S]===x?T[S]=0:T[S]=1;else k&&b&&t.applyMinMaxConstraint&&(T=xr(p,k,b));return{pixelType:a,width:u,height:d,pixels:p,mask:T,noDataValue:x}}function Dr(e,t=0,r){r=r||Tr(e);const{ifds:s,noData:i}=r;if(s.length===0)throw"no valid image file directory";const n=Dt(r);if(n)throw n;let c,l;const o=t===-1?s[s.length-1]:s[t],a=i?i[0]:null;if(l=r.tileWidth?Cr(e,r,o):vr(e,r,o),a!==null){if(l.mask=new Uint8Array(l.width*l.height),Math.abs(a)>1e24)for(c=0;c<l.width*l.height;c++)Math.abs((l.pixels[0][c]-a)/a)<1e-6?l.mask[c]=0:l.mask[c]=1;else for(c=0;c<l.width*l.height;c++)l.pixels[0][c]===a?l.mask[c]=0:l.mask[c]=1;l.noDataValue=a}return l}const Pt=function(e,t){const r=t.width*t.height,s=t.pixelType;return Math.floor(e.byteLength/(r*Lt(s)))},Lt=function(e){let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},Pr=function(e,t){if(8*e.byteLength<t)return null;const r=new Uint8Array(e,0,Math.ceil(t/8)),s=new Uint8Array(t);let i=0,n=0,c=0,l=0;for(c=0;c<r.length-1;c++)for(n=r[c],l=7;l>=0;l--)s[i++]=n>>l&1;for(l=7;i<t-1;)n=r[r.length-1],s[i++]=n>>l&1,l--;return s};class Lr{static decode(t,r){const s=r.pixelType,i=[],n=r.width*r.height,c=Pt(t,r),{bandIds:l,format:o}=r,a=l&&l.length||Pt(t,r),h=t.byteLength-t.byteLength%(n*Lt(s)),f=new s(t,0,n*c);let u,d,g,m,C;if(o==="bip")for(u=0;u<a;u++){for(m=new s(n),C=l?l[u]:u,d=0;d<n;d++)m[d]=f[d*c+C];i.push(m)}else if(o==="bsq")for(u=0;u<a;u++)C=l?l[u]:u,i.push(f.subarray(C*n,(C+1)*n));return h<t.byteLength-1&&(g=Pr(t.slice(h),n)),{pixels:i,mask:g}}}var Ur=function(e){var t,r,s,i,n,c;function l(o){var a,h,f,u,d,g,m,C,p,y,v,x,w;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},d=null;;){switch(a=this.readUInt32(),C=function(){var k,b;for(b=[],k=0;k<4;++k)b.push(String.fromCharCode(this.data[this.pos++]));return b}.call(this).join(""),C){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":d&&this.animation.frames.push(d),this.pos+=4,d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},u=this.readUInt16(),f=this.readUInt16()||100,d.delay=1e3*u/f,d.disposeOp=this.data[this.pos++],d.blendOp=this.data[this.pos++],d.data=[];break;case"IDAT":case"fdAT":for(C==="fdAT"&&(this.pos+=4,a-=4),o=(d!=null?d.data:void 0)||this.imgData,v=0;0<=a?v<a:v>a;0<=a?++v:--v)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(a),(p=255-this.transparency.indexed.length)>0)for(x=0;0<=p?x<p:x>p;0<=p?++x:--x)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":g=(y=this.read(a)).indexOf(0),m=String.fromCharCode.apply(String,y.slice(0,g)),this.text[m]=String.fromCharCode.apply(String,y.slice(g+1));break;case"IEND":return d&&this.animation.frames.push(d),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(w=this.colorType)===4||w===6,h=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*h,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return l.load=function(o,a,h){var f;return typeof a=="function"&&(h=a),(f=new XMLHttpRequest).open("GET",o,!0),f.responseType="arraybuffer",f.onload=function(){var u;return u=new l(new Uint8Array(f.response||f.mozResponseArrayBuffer)),typeof(a!=null?a.getContext:void 0)=="function"&&u.render(a),typeof h=="function"?h(u):void 0},f.send(null)},r=1,s=2,t=0,l.prototype.read=function(o){var a,h;for(h=[],a=0;0<=o?a<o:a>o;0<=o?++a:--a)h.push(this.data[this.pos++]);return h},l.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},l.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},l.prototype.decodePixels=function(o){var a,h,f,u,d,g,m,C,p,y,v,x,w,k,b,T,S,M,A,P,I,D,O;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);for(o=(o=new xe(o)).getBytes(),T=(x=this.pixelBitlength/8)*this.width,w=new Uint8Array(T*this.height),g=o.length,b=0,k=0,h=0;k<g;){switch(o[k++]){case 0:for(u=A=0;A<T;u=A+=1)w[h++]=o[k++];break;case 1:for(u=P=0;P<T;u=P+=1)a=o[k++],d=u<x?0:w[h-x],w[h++]=(a+d)%256;break;case 2:for(u=I=0;I<T;u=I+=1)a=o[k++],f=(u-u%x)/x,S=b&&w[(b-1)*T+f*x+u%x],w[h++]=(S+a)%256;break;case 3:for(u=D=0;D<T;u=D+=1)a=o[k++],f=(u-u%x)/x,d=u<x?0:w[h-x],S=b&&w[(b-1)*T+f*x+u%x],w[h++]=(a+Math.floor((d+S)/2))%256;break;case 4:for(u=O=0;O<T;u=O+=1)a=o[k++],f=(u-u%x)/x,d=u<x?0:w[h-x],b===0?S=M=0:(S=w[(b-1)*T+f*x+u%x],M=f&&w[(b-1)*T+(f-1)*x+u%x]),m=d+S-M,C=Math.abs(m-d),y=Math.abs(m-S),v=Math.abs(m-M),p=C<=y&&C<=v?d:y<=v?S:M,w[h++]=(a+p)%256;break;default:throw new Error("Invalid filter algorithm: "+o[k-1])}b++}return w},l.prototype.decodePalette=function(){var o,a,h,f,u,d,g,m,C;for(h=this.palette,d=this.transparency.indexed||[],u=new Uint8Array((d.length||0)+h.length),f=0,o=0,a=g=0,m=h.length;g<m;a=g+=3)u[f++]=h[a],u[f++]=h[a+1],u[f++]=h[a+2],u[f++]=(C=d[o++])!=null?C:255;return u},l.prototype.copyToImageData=function(o,a){var h,f,u,d,g,m,C,p,y,v,x;if(f=this.colors,y=null,h=this.hasAlphaChannel,this.palette.length&&(y=(x=this._decodedPalette)!=null?x:this._decodedPalette=this.decodePalette(),f=4,h=!0),p=(u=o.data||o).length,g=y||a,d=m=0,f===1)for(;d<p;)C=y?4*a[d/4]:m,v=g[C++],u[d++]=v,u[d++]=v,u[d++]=v,u[d++]=h?g[C++]:this.transparency.grayscale&&this.transparency.grayscale===v?0:255,m=C;else for(;d<p;)C=y?4*a[d/4]:m,u[d++]=g[C++],u[d++]=g[C++],u[d++]=g[C++],u[d++]=h?g[C++]:this.transparency.rgb&&this.transparency.rgb[1]===g[C-3]&&this.transparency.rgb[3]===g[C-2]&&this.transparency.rgb[5]===g[C-1]?0:255,m=C},l.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o},n=e.document&&e.document.createElement("canvas"),c=n&&n.getContext("2d"),i=function(o){var a;return c.width=o.width,c.height=o.height,c.clearRect(0,0,o.width,o.height),c.putImageData(o,0,0),(a=new Image).src=n.toDataURL(),a},l.prototype.decodeFrames=function(o){var a,h,f,u,d,g,m,C;if(this.animation){for(C=[],h=d=0,g=(m=this.animation.frames).length;d<g;h=++d)a=m[h],f=o.createImageData(a.width,a.height),u=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(f,u),a.imageData=f,C.push(a.image=i(f));return C}},l.prototype.renderFrame=function(o,a){var h,f,u;return h=(f=this.animation.frames)[a],u=f[a-1],a===0&&o.clearRect(0,0,this.width,this.height),(u!=null?u.disposeOp:void 0)===r?o.clearRect(u.xOffset,u.yOffset,u.width,u.height):(u!=null?u.disposeOp:void 0)===s&&o.putImageData(u.imageData,u.xOffset,u.yOffset),h.blendOp===t&&o.clearRect(h.xOffset,h.yOffset,h.width,h.height),o.drawImage(h.image,h.xOffset,h.yOffset)},l.prototype.animate=function(o){var a,h,f,u,d,g,m=this;return h=0,g=this.animation,u=g.numFrames,f=g.frames,d=g.numPlays,(a=function(){var C,p;if(C=h++%u,p=f[C],m.renderFrame(o,C),u>1&&h/u<d)return m.animation._timeout=setTimeout(a,p.delay)})()},l.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},l.prototype.render=function(o){var a,h;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,a=o.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(h=a.createImageData(this.width,this.height),this.copyToImageData(h,this.decodePixels()),a.putImageData(h,0,0))},l}(self);const Er=new Set(["jpg","png","bmp","gif"]);function Rr(e,t){if(!Ge)throw new he("rasterCoded:decode","lerc decoder is not supported on big endian platform");const{width:r,height:s,pixelType:i}=t,n=Rt(i),c=n.pixelTypeCtor,l=t.noDataValue==null?n.noDataValue:t.noDataValue;let o,a,h=0,f=0;const u=e.byteLength-10;for(;f<u;){const d=ar(e,{inputOffset:f,encodedMaskData:o,returnMask:h===0,returnEncodedMask:h===0,returnFileInfo:!0,pixelType:c,noDataValue:l});if(r&&s&&(d.width!==r||d.height!==s))throw new he("rasterCoded:decode","lerc decoded result has width or height different from specified in options");if(f=d.fileInfo.eofOffset,h===0&&(o=d.encodedMaskData,a=new H({width:d.width,height:d.height,pixels:[],pixelType:i,mask:d.maskData,statistics:[]})),h++,a.addData({pixels:d.pixelData,statistics:{minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue}}),u-f>10){const g=String.fromCharCode.apply(null,new Uint8Array(e,f,10));f+=g.indexOf("CntZ")>-1?g.indexOf("CntZ"):0}}return a}function Or(e,t){if(!Ge)throw new he("rasterCoded:decode","lerc decoder is not supported on big endian platform");let r,s,i,n=0,c=t.offset||0,l=0;const o=t.eof||e.byteLength-10,a=[],{width:h,height:f}=t;let u=0;for(;c<o;){var d;if(s=St.decode(e,{inputOffset:c,maskData:r,returnFileInfo:!0}),h&&f&&(s.width!==h||s.height!==f))throw new he("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");if(c=s.fileInfo.eofOffset,r=s.maskData,n===0&&(l=s.fileInfo.numValidPixel,i=new H({width:s.width,height:s.height,pixels:[],pixelType:s.fileInfo.pixelType,mask:r,statistics:[]})),s.fileInfo.mask&&s.fileInfo.mask.numBytes>0&&u++,r&&a.push(r),s.dimCount>1&&((d=s.pixelData)==null?void 0:d.length)===s.width*s.height*s.dimCount){var g,m,C,p;s.pixelData=s.pixelData.slice(-s.width*s.height);const w=(g=s.dimStats)==null||(m=g.minValues)==null?void 0:m[s.dimCount-1],k=(C=s.dimStats)==null||(p=C.maxValues)==null?void 0:p[s.dimCount-1];w!=null&&k!=null&&(s.minValue=w,s.maxValue=k)}if(n++,i.addData({pixels:s.pixelData,statistics:{minValue:s.minValue,maxValue:s.maxValue}}),o-c>10){const w=String.fromCharCode.apply(null,new Uint8Array(e,c,10));c+=w.indexOf("Lerc")>-1?w.indexOf("Lerc"):0}}let y=0,v=0,x=0;if(u>1){for(x=i.width*i.height,r=new Uint8Array(x),r.set(a[0]),y=1;y<a.length;y++){const w=a[y];for(v=0;v<x;v++)r[v]=r[v]&w[v]}for(l=0,v=0;v<x;v++)l+=r[v];i.mask=r}return i.validPixelCount=l,i}function Br(e,t){const r=Dr(e,t.pyramidLevel||0),s=new H({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return s.updateStatistics(),s}function Gr(e,t){const r=Mr(e,t.customOptions),s=new H({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return s.updateStatistics(),s}function Ut(e,t){const r=t.pixelType||"u8",s=H.getPixelArrayConstructor(r),i=r==="u8"?e:new s(e.buffer),n=[],c=t.planes||1;if(c===1)n.push(i);else for(let o=0;o<c;o++){const a=(t.width||1)*(t.height||e.length),h=new s(a);for(let f=0;f<a;f++)h[f]=i[f*c+o];n.push(h)}const l=new H({width:t.width||1,height:t.height||e.length,pixels:n,pixelType:r,statistics:null});return l.updateStatistics(),l}function _r(e,t){return Ut(new xe(new Uint8Array(e)).getBytes(),t)}function Nr(e,t){return Ut(Ye(e,t.offset,t.eof,!t.isInputBigEndian),t)}function Vr(e,t,r){const{pixelTypeCtor:s}=Rt(t.pixelType),i=(0,Lr.decode)(e,{width:t.width,height:t.height,pixelType:s,format:r}),n=new H({width:t.width,height:t.height,pixels:i.pixels,pixelType:t.pixelType,mask:i.mask,statistics:null});return n.updateStatistics(),n}function Fr(e){const t=fr.decode(e),r=new H({width:t.width,height:t.height,pixels:t.pixels,pixelType:"U8",mask:t.mask,statistics:null});return r.updateStatistics(),r}function $r(e,t){const r=new Uint8Array(e),s=new Ur(r),{width:i,height:n}=t,c=i*n,l=s.decode();let o,a=0,h=0;const f=new Uint8Array(c);for(a=0;a<c;a++)f[a]=l[4*a+3];const u=new H({width:i,height:n,pixels:[],pixelType:"U8",mask:f,statistics:[]});for(a=0;a<3;a++){for(o=new Uint8Array(c),h=0;h<c;h++)o[h]=l[4*h+a];u.addData({pixels:o})}return u.updateStatistics(),u}async function jr(e,t,r,s){const i=new Ke,n=se({applyJpegMask:!1,format:t},r),c=await i.decode(e,n,s),l=new H(c);return l.updateStatistics(),l}function Et(e){if(e==null)throw new he("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let r="";return t[0]===255&&t[1]===216?r="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?r="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?r="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?r="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?r="tiff":t[0]===71&&t[1]===73&&t[2]===70?r="gif":t[0]===66&&t[1]===77?r="bmp":String.fromCharCode.apply(null,t).toLowerCase().indexOf("error")>-1&&(r="error"),r}function zr(e){let t=null;switch(e){case"lerc":t=Rr;break;case"lerc2":t=Or;break;case"jpg":t=Fr;break;case"png":t=$r;break;case"bsq":case"bip":t=(r,s)=>Vr(r,s,e);break;case"tiff":t=Br;break;case"deflate":t=_r;break;case"lzw":t=Nr;break;case"error":t=()=>{throw new he("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new he("rasterCodec:decode","unsupported raster format")}}return t}function Rt(e){let t=null,r=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,t=Uint8Array;break;case"u16":r=r||65535,t=Uint16Array;break;case"u32":r=r||2**32-1,t=Uint32Array;break;case"s8":r=r||-128,t=Int8Array;break;case"s16":r=r||-32768,t=Int16Array;break;case"s32":r=r||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:r}}function Wr(e,t=1){if(!e)return;const{pixels:r,width:s,height:i,mask:n}=e;if(!r||r.length===0)return;const c=r.length,l=s-1,o=i-1,a=[];let h,f,u,d,g,m,C;const p=H.getPixelArrayConstructor(e.pixelType);if(t===0){for(h=0;h<c;h++){for(g=r[h],m=new p(l*o),f=0;f<o;f++)for(d=f*s,u=0;u<l;u++)m[f*l+u]=g[d+u];a.push(m)}if(n)for(C=new Uint8Array(l*o),f=0;f<o;f++)for(d=f*s,u=0;u<l;u++)C[f*l+u]=n[d+u]}else{for(h=0;h<c;h++){for(g=r[h],m=new p(l*o),f=0;f<o;f++)for(d=f*s,u=0;u<l;u++)m[f*l+u]=(g[d+u]+g[d+u+1]+g[d+s+u]+g[d+s+u+1])/4;a.push(m)}if(n)for(C=new Uint8Array(l*o),f=0;f<o;f++)for(d=f*s,u=0;u<l;u++)C[f*l+u]=Math.min.apply(null,[n[d+u],n[d+u+1],n[d+s+u],n[d+s+u+1]])}e.width=l,e.height=o,e.mask=C,e.pixels=a}function Ao(e){let t=Et(e);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function Io(e,t={},r){if(e==null)throw new he("rasterCodec:decode","missing encodeddata parameter.");let s,i,n=t.format&&t.format.toLowerCase();if(!(n!=="bsq"&&n!=="bip"||t.width!=null&&t.height!=null))throw new he("rasterCodec:decode","requires width and height in options parameter.");return n==="tiff"&&t.customOptions?Gr(e,t):((!n||n!=="bsq"&&n!=="bip"&&n!=="deflate"&&n!=="lzw")&&(n=Et(e)),t.useCanvas&&Er.has(n)?i=await jr(e,n,t,r):(s=zr(n),t.isPoint&&((t=se({},t)).width++,t.height++),i=s(e,t),t.isPoint&&Wr(i)),i)}function Z(e){return ee(e)&&e.declaredClass==="esri.layers.support.PixelBlock"&&e.pixels&&e.pixels.length>0}function Ot(e,t){if(t==null||!t.length||!Z(e))return e;const r=e.pixels.length;return t&&t.some(s=>s>=r)||r===1&&t.length===1&&t[0]===0?e:r!==t.length||t.some((s,i)=>s!==i)?new H({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:t.map(s=>e.pixels[s]),statistics:e.statistics&&t.map(s=>e.statistics[s])}):e}function Le(e){if(!e)return;const t=e.colormap;if(!t||t.length===0)return;const r=t.sort((f,u)=>f[0]-u[0]);let s=0;r[0][0]<0&&(s=r[0][0]);const i=Math.max(256,r[r.length-1][0]-s+1),n=new Uint8Array(4*i),c=[];let l,o=0,a=0;const h=r[0].length===5;if(i>65536)return r.forEach(f=>{c[f[0]-s]=h?f.slice(1):f.slice(1).concat([255])}),{indexed2DColormap:c,offset:s,alphaSpecified:h};if(e.fillUnspecified)for(l=r[a],o=l[0]-s;o<i;o++)n[4*o]=l[1],n[4*o+1]=l[2],n[4*o+2]=l[3],n[4*o+3]=h?l[4]:255,o===l[0]-s&&(l=a===r.length-1?l:r[++a]);else for(o=0;o<r.length;o++)l=r[o],a=4*(l[0]-s),n[a]=l[1],n[a+1]=l[2],n[a+2]=l[3],n[a+3]=h?l[4]:255;return{indexedColormap:n,offset:s,alphaSpecified:h}}function rt(e,t){if(!Z(e)||!t&&(t.indexedColormap||t.indexed2DColormap))return e;const r=e.clone(),s=r.pixels;let i=r.mask;const n=r.width*r.height;if(s.length!==1)return e;const{indexedColormap:c,indexed2DColormap:l,offset:o,alphaSpecified:a}=t,h=c.length-1;let f=0;const u=s[0],d=new Uint8Array(u.length),g=new Uint8Array(u.length),m=new Uint8Array(u.length);let C,p=0;if(c)if(i)for(f=0;f<n;f++)i[f]&&(p=4*(u[f]-o),p<o||p>h?i[f]=0:(d[f]=c[p],g[f]=c[p+1],m[f]=c[p+2],i[f]=c[p+3]));else{for(i=new Uint8Array(n),f=0;f<n;f++)p=4*(u[f]-o),p<o||p>h?i[f]=0:(d[f]=c[p],g[f]=c[p+1],m[f]=c[p+2],i[f]=c[p+3]);r.mask=i}else if(i)for(f=0;f<n;f++)i[f]&&(C=l[u[f]],d[f]=C[0],g[f]=C[1],m[f]=C[2],i[f]=C[3]);else{for(i=new Uint8Array(n),f=0;f<n;f++)C=l[u[f]],d[f]=C[0],g[f]=C[1],m[f]=C[2],i[f]=C[3];r.mask=i}return r.pixels=[d,g,m],r.statistics=null,r.pixelType="u8",r.maskIsAlpha=a,r}function Kr(e){if(!Z(e))return null;e.statistics||e.updateStatistics();const{pixels:t,mask:r,pixelType:s,statistics:i}=e,n=e.width*e.height,c=t.length;let l,o,a,h,f;const u=[],d=[];let g,m,C,p,y,v,x,w,k,b;const T=256;for(h=0;h<c;h++){if(g=new Uint32Array(T),C=t[h],s==="u8")if(l=-.5,o=255.5,r)for(f=0;f<n;f++)r[f]&&g[C[f]]++;else for(f=0;f<n;f++)g[C[f]]++;else{if(l=i[h].minValue,o=i[h].maxValue,a=(o-l)/T,m=new Uint32Array(T+1),r)for(f=0;f<n;f++)r[f]&&m[Math.floor((C[f]-l)/a)]++;else for(f=0;f<n;f++)m[Math.floor((C[f]-l)/a)]++;for(f=0;f<255;f++)g[f]=m[f];g[255]=m[255]+m[256]}for(u.push({min:l,max:o,size:T,counts:g}),p=0,y=0,w=0,f=0;f<T;f++)p+=g[f],y+=f*g[f];for(k=y/p,f=0;f<T;f++)w+=g[f]*(f-k)**2;b=Math.sqrt(w/(p-1)),a=(o-l)/T,v=(k+.5)*a+l,x=b*a,d.push({min:l,max:o,avg:v,stddev:x})}return{statistics:d,histograms:u}}function Mo(e){const t=[];for(let r=0;r<e.length;r++){const{min:s,max:i,size:n,counts:c}=e[r];let l=0,o=0;for(let g=0;g<n;g++)l+=c[g],o+=g*c[g];const a=o/l;let h=0;for(let g=0;g<n;g++)h+=c[g]*(g-a)**2;const f=(i-s)/n,u=(a+.5)*f+s,d=Math.sqrt(h/(l-1))*f;t.push({min:s,max:i,avg:u,stddev:d})}return t}function Bt(e){const{minCutOff:t,maxCutOff:r,gamma:s,pixelType:i}=e,n=e.outMin||0,c=e.outMax||255;if(["u8","u16","s8","s16"].indexOf(i)===-1)return null;const l=t.length;let o,a,h=0;i==="s8"?h=-127:i==="s16"&&(h=-32767);let f=256;["u16","s16"].indexOf(i)>-1&&(f=65536);const u=[],d=[],g=c-n;for(o=0;o<l;o++)d[o]=r[o]-t[o],u[o]=g/(r[o]-t[o]);const m=s&&s.length>=l,C=[];if(m)for(o=0;o<l;o++)s[o]>1?s[o]>2?C[o]=6.5+(s[o]-2)**2.5:C[o]=6.5+100*(2-s[o])**4:C[o]=1;let p;const y=[];let v,x,w;if(m)for(o=0;o<l;o++){for(w=[],a=0;a<f;a++)v=a+h,p=(v-t[o])/d[o],x=1,s[o]>1&&(x-=(1/g)**(p*C[o])),v<r[o]&&v>t[o]?w[a]=Math.floor(x*g*p**(1/s[o]))+n:v>=r[o]?w[a]=c:w[a]=n;y[o]=w}else for(o=0;o<l;o++){for(w=[],a=0;a<f;a++)v=a+h,v<=t[o]?w[a]=n:v>=r[o]?w[a]=c:w[a]=Math.floor((v-t[o])/d[o]*g)+n;y[o]=w}if(e.contrastOffset!=null){const k=Yr(e.contrastOffset,e.brightnessOffset);for(o=0;o<l;o++)for(w=y[o],a=0;a<f;a++)w[a]=k[w[a]]}return{lut:y,offset:h}}function Yr(e,t){const r=Math.min(Math.max(e,-100),100),s=Math.min(Math.max(t,-100),100),i=255,n=128;let c,l;const o=new Uint8Array(256);for(c=0;c<256;c++)r>0&&r<100?l=(200*c-100*i+2*i*s)/(2*(100-r))+n:r<=0&&r>-100?l=(200*c-100*i+2*i*s)*(100+r)/2e4+n:r===100?(l=200*c-100*i+(i+1)*(100-r)+2*i*s,l=l>0?i:0):r===-100&&(l=n),o[c]=l>i?i:l<0?0:l;return o}function Gt(e,t=256){t=Math.min(t,256);const{size:r,counts:s}=e,i=new Uint8Array(r),n=s.reduce((h,f)=>h+f/t,0);let c=0,l=0,o=0,a=n;for(let h=0;h<r;h++)if(o+=s[h],!(h<r-1&&o+s[h+1]<a)){for(;c<t-1&&a<o;)c++,a+=n;for(let f=l;f<=h;f++)i[f]=c;l=h+1}for(let h=l;h<r;h++)i[h]=t-1;return i}function ot(e,t){if(!Z(e))return null;const r=e.clone(),{pixels:s,mask:i}=r,{minCutOff:n,maxCutOff:c,gamma:l}=t,o=t.outMin||0,a=t.outMax||255,h=r.width*r.height,f=s.length;let u,d,g,m,C;const p=a-o,y=[],v=[];for(u=0;u<f;u++)v[u]=c[u]-n[u],y[u]=p/(c[u]-n[u]);const x=l&&l.length>=f,w=[];if(x)for(u=0;u<f;u++)l[u]>1?l[u]>2?w[u]=6.5+(l[u]-2)**2.5:w[u]=6.5+100*(2-l[u])**4:w[u]=1;if(x)if(i!=null){for(d=0;d<h;d++)if(i[d])for(u=0;u<f;u++)g=s[u][d],C=(g-n[u])/v[u],m=1,l[u]>1&&(m-=(1/p)**(C*w[u])),g<c[u]&&g>n[u]?s[u][d]=Math.floor(m*p*C**(1/l[u]))+o:g>=c[u]?s[u][d]=a:s[u][d]=o}else for(d=0;d<h;d++)for(u=0;u<f;u++)g=s[u][d],C=(g-n[u])/v[u],m=1,l[u]>1&&(m-=(1/p)**(C*w[u])),g<c[u]&&g>n[u]?s[u][d]=Math.floor(m*p*C**(1/l[u]))+o:g>=c[u]?s[u][d]=a:s[u][d]=o;else if(i!=null){for(d=0;d<h;d++)if(i[d])for(u=0;u<f;u++)g=s[u][d],g<c[u]&&g>n[u]?s[u][d]=Math.floor((g-n[u])/v[u]*p)+o:g>=c[u]?s[u][d]=a:s[u][d]=o}else for(d=0;d<h;d++)for(u=0;u<f;u++)g=s[u][d],g<c[u]&&g>n[u]?s[u][d]=Math.floor((g-n[u])/v[u]*p)+o:g>=c[u]?s[u][d]=a:s[u][d]=o;return r.pixelType="u8",r.updateStatistics(),r}function _t(e,t){if(!Z(e))return null;const{pixels:r,mask:s}=e,i=e.width*e.height,n=r.length;let c=t.lut;const{offset:l}=t;let o,a;c&&c[0].length===1&&(c=r.map(()=>c));const h=[];let f,u,d;if(l)if(s==null)for(o=0;o<n;o++){for(f=r[o],u=c[o],d=new Uint8Array(i),a=0;a<i;a++)d[a]=u[f[a]-l];h.push(d)}else for(o=0;o<n;o++){for(f=r[o],u=c[o],d=new Uint8Array(i),a=0;a<i;a++)s[a]&&(d[a]=u[f[a]-l]);h.push(d)}else if(s==null)for(o=0;o<n;o++){for(f=r[o],u=c[o],d=new Uint8Array(i),a=0;a<i;a++)d[a]=u[f[a]];h.push(d)}else for(o=0;o<n;o++){for(f=r[o],u=c[o],d=new Uint8Array(i),a=0;a<i;a++)s[a]&&(d[a]=u[f[a]]);h.push(d)}const g=new H({width:e.width,height:e.height,pixels:h,mask:s,pixelType:"u8"});return g.updateStatistics(),g}function Hr(e,t){if(!Z(e))return null;const r=e.clone(),{pixels:s}=r,i=r.width*r.height,n=t.length,c=Math.floor(n/2),l=t[Math.floor(c)],o=s[0];let a,h,f,u,d,g,m=!1;const C=new Uint8Array(i),p=new Uint8Array(i),y=new Uint8Array(i);let v=r.mask;const x=t[0].mappedColor.length===4;for(v||(v=new Uint8Array(i),v.fill(x?255:1),r.mask=v),d=0;d<i;d++)if(v[d]){for(a=o[d],m=!1,g=c,h=l,f=0,u=n-1;u-f>1;){if(a===h.value){m=!0;break}a>h.value?f=g:u=g,g=Math.floor((f+u)/2),h=t[Math.floor(g)]}m||(a===t[f].value?(h=t[f],m=!0):a===t[u].value?(h=t[u],m=!0):a<t[f].value?(m=!1,h=null):a>t[f].value&&(a<t[u].value?(h=t[f],m=!0):u===n-1?(m=!1,h=null):(h=t[u],m=!0))),m?(C[d]=h.mappedColor[0],p[d]=h.mappedColor[1],y[d]=h.mappedColor[2],v[d]=h.mappedColor[3]):C[d]=p[d]=y[d]=v[d]=0}return r.pixels=[C,p,y],r.mask=v,r.pixelType="u8",r.maskIsAlpha=x,r}function Jr(e,t,r,s,i,n,c,l){return{xmin:i<=r*e?0:i<r*e+e?i-r*e:e,ymin:n<=s*t?0:n<s*t+t?n-s*t:t,xmax:i+c<=r*e?0:i+c<r*e+e?i+c-r*e:e,ymax:n+l<=s*t?0:n+l<s*t+t?n+l-s*t:t}}function Nt(e,t,r,s,i,n){const{width:c,height:l}=r.block,{x:o,y:a}=r.offset,{width:h,height:f}=r.mosaic,u=Jr(c,l,s,i,o,a,h,f);let d=0,g=0;if(n){const m=n.hasGCSSShiftTransform?360:n.halfWorldWidth,C=c*n.resolutionX,p=n.startX+s*C,y=p+C;p<m&&y>m?g=n.rightPadding:p>=m&&(d=n.leftMargin-n.rightPadding,g=0)}if(u.xmax-=g,typeof t!="number")for(let m=u.ymin;m<u.ymax;m++){const C=(i*l+m-a)*h+(s*c-o)+d,p=m*c;for(let y=u.xmin;y<u.xmax;y++)e[C+y]=t[p+y]}else for(let m=u.ymin;m<u.ymax;m++){const C=(i*l+m-a)*h+(s*c-o)+d;for(let p=u.xmin;p<u.xmax;p++)e[C+p]=t}}function Do(e,t,r={}){const{clipOffset:s,clipSize:i,alignmentInfo:n,blockWidths:c}=r;if(c)return qr(e,t,{blockWidths:c});const l=e.filter(b=>Z(b))[0];if(st(l))return null;const o=i?i.width:t.width,a=i?i.height:t.height,h=l.width,f=l.height,u=t.width/h,d=t.height/f,g={offset:s||{x:0,y:0},mosaic:i||t,block:{width:h,height:f}},m=l.pixelType,C=H.getPixelArrayConstructor(m),p=l.pixels.length,y=[];let v,x;for(let b=0;b<p;b++){x=new C(o*a);for(let T=0;T<d;T++)for(let S=0;S<u;S++){const M=e[T*u+S];Z(M)&&(v=M.pixels[b],Nt(x,v,g,S,T,n))}y.push(x)}let w;if(e.some(b=>st(b)||b.mask&&b.mask.length>0)){w=new Uint8Array(o*a);for(let b=0;b<d;b++)for(let T=0;T<u;T++){const S=e[b*u+T],M=ee(S)?S.mask:null;Nt(w,M||(S?1:0),g,T,b,n)}}const k=new H({width:o,height:a,pixels:y,pixelType:m,mask:w});return k.updateStatistics(),k}function qr(e,t,r){const s=e.find(d=>ee(d));if(!ee(s))return null;const i=e.some(d=>!ee(d)||!!d.mask),{width:n,height:c}=t,l=i?new Uint8Array(n*c):null,{blockWidths:o}=r,a=[],h=s.getPlaneCount(),f=H.getPixelArrayConstructor(s.pixelType);if(i)for(let d=0,g=0;d<e.length;g+=o[d],d++){const m=e[d];if(!Z(m))continue;const C=m.mask;for(let p=0;p<c;p++)for(let y=0;y<o[d];y++)l[p*n+y+g]=C==null?255:C[p*m.width+y]}for(let d=0;d<h;d++){const g=new f(n*c);for(let m=0,C=0;m<e.length;C+=o[m],m++){const p=e[m];if(!Z(p))continue;const y=p.pixels[d];if(y!=null)for(let v=0;v<c;v++)for(let x=0;x<o[m];x++)g[v*n+x+C]=y[v*p.width+x]}a.push(g)}const u=new H({width:n,height:c,mask:l,pixels:a,pixelType:s.pixelType});return u.updateStatistics(),u}function Po(e,t,r){if(!Z(e))return null;const{width:s,height:i}=e,n=t.x,c=t.y,l=r.width+n,o=r.height+c;if(n<0||c<0||l>s||o>i||n===0&&c===0&&l===s&&o===i)return e;e.mask||(e.mask=new Uint8Array(s*i));const a=e.mask;for(let h=0;h<i;h++){const f=h*s;for(let u=0;u<s;u++)a[f+u]=h<c||h>=o||u<n||u>=l?0:1}return e.updateStatistics(),e}function Xr(e){if(!Z(e))return null;const t=e.clone(),{width:r,height:s,pixels:i,mask:n}=e,c=i[0],l=t.pixels[0];for(let o=2;o<s-1;o++){const a=new Map;for(let f=o-2;f<o+2;f++)for(let u=0;u<4;u++){const d=f*r+u;Ue(a,c[d],n?n[d]:1)}l[o*r]=Vt(a),l[o*r+1]=l[o*r+2]=l[o*r];let h=3;for(;h<r-1;h++){let f=(o-2)*r+h+1;Ue(a,c[f],n?n[f]:1),f=(o-1)*r+h+1,Ue(a,c[f],n?n[f]:1),f=o*r+h+1,Ue(a,c[f],n?n[f]:1),f=(o+1)*r+h+1,Ue(a,c[f],n?n[f]:1),f=(o-2)*r+h-3,Fe(a,c[f],n?n[f]:1),f=(o-1)*r+h-3,Fe(a,c[f],n?n[f]:1),f=o*r+h-3,Fe(a,c[f],n?n[f]:1),f=(o+1)*r+h-3,Fe(a,c[f],n?n[f]:1),l[o*r+h]=Vt(a)}l[o*r+h+1]=l[o*r+h]}for(let o=0;o<r;o++)l[o]=l[r+o]=l[2*r+o],l[(s-1)*r+o]=l[(s-2)*r+o];return t.updateStatistics(),t}function Vt(e){if(e.size===0)return 0;let t=0,r=-1,s=0;const i=e.keys();let n=i.next();for(;!n.done;)s=e.get(n.value),s>t&&(r=n.value,t=s),n=i.next();return r}function Fe(e,t,r){if(r===0)return;const s=e.get(t);s===1?e.delete(t):e.set(t,s-1)}function Ue(e,t,r){r!==0&&e.set(t,e.has(t)?e.get(t)+1:1)}function Zr(e,t,r){let{x:s,y:i}=t;const{width:n,height:c}=r;if(s===0&&i===0&&c===e.height&&n===e.width)return e;const{width:l,height:o}=e,a=Math.max(0,i),h=Math.max(0,s),f=Math.min(s+n,l),u=Math.min(i+c,o);if(f<0||u<0||!Z(e))return null;s=Math.max(0,-s),i=Math.max(0,-i);const{pixels:d,mask:g}=e,m=n*c,C=d.length,p=[];for(let x=0;x<C;x++){const w=d[x],k=H.createEmptyBand(e.pixelType,m);for(let b=a;b<u;b++){const T=b*l;let S=(b+i-a)*n+s;for(let M=h;M<f;M++)k[S++]=w[T+M]}p.push(k)}const y=new Uint8Array(m);for(let x=a;x<u;x++){const w=x*l;let k=(x+i-a)*n+s;for(let b=h;b<f;b++)y[k++]=g?g[w+b]:1}const v=new H({width:r.width,height:r.height,pixelType:e.pixelType,pixels:p,mask:y});return v.updateStatistics(),v}function Qr(e,t=!0){if(!Z(e))return null;const{pixels:r,width:s,height:i,mask:n,pixelType:c}=e,l=[],o=Math.round(s/2),a=Math.round(i/2),h=i-1,f=s-1;for(let d=0;d<r.length;d++){const g=r[d],m=H.createEmptyBand(c,o*a);let C=0;for(let p=0;p<i;p+=2)for(let y=0;y<s;y+=2){const v=g[p*s+y];if(t){const x=y===f?v:g[p*s+y+1],w=p===h?v:g[p*s+y+s],k=y===f?w:p===h?x:g[p*s+y+s+1];m[C++]=(v+x+w+k)/4}else m[C++]=v}l.push(m)}let u=null;if(n){u=new Uint8Array(o*a);let d=0;for(let g=0;g<i;g+=2)for(let m=0;m<s;m+=2){const C=n[g*s+m];if(t){const p=m===f?C:n[g*s+m+1],y=g===h?C:n[g*s+m+s],v=m===f?y:g===h?p:n[g*s+m+s+1];u[d++]=C*p*y*v?1:0}else u[d++]=C}}return new H({width:o,height:a,pixelType:c,pixels:l,mask:u})}function Lo(e,t,r){if(!Z(e))return null;const{width:s,height:i}=t;let{width:n,height:c}=e;const l=new Map,o={x:0,y:0},a=r==null?1:1+r;let h=e;for(let f=0;f<a;f++){const u=Math.ceil(n/s),d=Math.ceil(c/i);for(let g=0;g<d;g++){o.y=g*i;for(let m=0;m<u;m++){o.x=m*s;const C=Zr(h,o,t);l.set(`${f}/${g}/${m}`,C)}}f<a-1&&(h=Qr(h)),n=Math.round(n/2),c=Math.round(c/2)}return l}function Uo(e,t,r,s,i="nearest"){if(!Z(e))return null;i==="majority"&&(e=Xr(e));const{pixels:n,mask:c,pixelType:l}=e,o=e.width,a=e.height,h=H.getPixelArrayConstructor(l),f=n.length,{width:u,height:d}=t,g=s.cols,m=s.rows,C=Math.ceil(u/g-.1/g),p=Math.ceil(d/m-.1/m);let y,v,x,w,k,b,T,S=!1;for(let R=0;R<r.length;R+=3)r[R]===-1&&r[R+1]===-1&&r[R+2]===-1&&(S=!0);const M=C*g,A=M*p*m,P=new Float32Array(A),I=new Float32Array(A);let D,O,L=0;const U=i==="majority"?0:.5;for(let R=0;R<p;R++)for(let N=0;N<C;N++){y=12*(R*C+N),v=r[y],x=r[y+1],w=r[y+2],k=r[y+3],b=r[y+4],T=r[y+5];for(let _=0;_<m;_++){L=(R*m+_)*M+N*g,O=(_+.5)/m;for(let F=0;F<_;F++)D=(F+.5)/g,P[L+F]=Math.round((v*D+x*O+w)*o-U),I[L+F]=Math.round((k*D+b*O+T)*a-U)}y+=6,v=r[y],x=r[y+1],w=r[y+2],k=r[y+3],b=r[y+4],T=r[y+5];for(let _=0;_<m;_++){L=(R*m+_)*M+N*g,O=(_+.5)/m;for(let F=_;F<g;F++)D=(F+.5)/g,P[L+F]=Math.round((v*D+x*O+w)*o-U),I[L+F]=Math.round((k*D+b*O+T)*a-U)}}const V=(R,N)=>{for(let _=0;_<d;_++){y=_*M;for(let F=0;F<u;F++)P[y]<0||I[y]<0?R[_*u+F]=0:R[_*u+F]=N[P[y]+I[y]*o],y++}},j=[];let E;for(let R=0;R<f;R++)E=new h(u*d),V(E,n[R]),j.push(E);const B=new H({width:u,height:d,pixelType:l,pixels:j});if(c)B.mask=new Uint8Array(u*d),V(B.mask,c);else if(S){B.mask=new Uint8Array(u*d);for(let R=0;R<u*d;R++)B.mask[R]=P[R]<0||I[R]<0?0:1}return B.updateStatistics(),B}const ke=new Map;ke.set("meter-per-second",1),ke.set("kilometer-per-hour",.277778),ke.set("knots",.514444),ke.set("feet-per-second",.3048),ke.set("mile-per-hour",.44704);const it=180/Math.PI,Eo=new rr({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function Ro(e,t){return ke.get(e)/ke.get(t)||1}function Ft(e){return(450-e)%360}function eo(e,t="geographic"){const[r,s]=e,i=Math.sqrt(r*r+s*s);let n=Math.atan2(s,r)*it;return n=(360+n)%360,t==="geographic"&&(n=Ft(n)),[i,n]}function to(e,t="geographic"){let r=e[1];t==="geographic"&&(r=Ft(r)),r%=360;const s=e[0];return[s*Math.cos(r/it),s*Math.sin(r/it)]}function Oo(e,t,r="geographic",s=1){if(!Z(e))return e;const{pixels:i,width:n,height:c}=e,l=n*c,o=i[0],a=i[1],h=H.createEmptyBand(e.pixelType,l),f=H.createEmptyBand(e.pixelType,l);let u=0;for(let g=0;g<c;g++)for(let m=0;m<n;m++)t==="vector-uv"?([h[u],f[u]]=eo([o[u],a[u]],r),h[u]*=s):([h[u],f[u]]=to([o[u],a[u]],r),h[u]*=s,f[u]*=s),u++;const d=new H({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[h,f]});return d.updateStatistics(),d}function Bo(e,t,r=1){if(r===1||!Z(e))return e;const s=e.clone(),{pixels:i,width:n,height:c}=s,l=i[0],o=i[1];let a=0;for(let h=0;h<c;h++)for(let f=0;f<n;f++)t==="vector-uv"?(l[a]*=r,o[a]*=r):l[a]*=r,a++;return s.updateStatistics(),s}let ie=class extends ze{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.blockBoundary=null}};$([W({type:Number,json:{write:!0}})],ie.prototype,"blockWidth",void 0),$([W({type:Number,json:{write:!0}})],ie.prototype,"blockHeight",void 0),$([W({type:String,json:{write:!0}})],ie.prototype,"compression",void 0),$([W({type:or,json:{write:!0}})],ie.prototype,"origin",void 0),$([W({type:Number,json:{write:!0}})],ie.prototype,"firstPyramidLevel",void 0),$([W({type:Number,json:{write:!0}})],ie.prototype,"maximumPyramidLevel",void 0),$([W({json:{write:!0}})],ie.prototype,"pyramidResolutions",void 0),$([W({type:Number,json:{write:!0}})],ie.prototype,"pyramidScalingFactor",void 0),$([W({type:Number,json:{write:!0}})],ie.prototype,"pyramidBlockWidth",void 0),$([W({type:Number,json:{write:!0}})],ie.prototype,"pyramidBlockHeight",void 0),$([W({type:Boolean,json:{write:!0}})],ie.prototype,"isVirtualTileInfo",void 0),$([W({json:{write:!0}})],ie.prototype,"tileInfo",void 0),$([W()],ie.prototype,"blockBoundary",void 0),ie=$([je("esri.layers.support.RasterStorageInfo")],ie);const ro=ie;let X=class extends ze{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get dataType(){var e,t,r;const s=(e=(t=this.keyProperties)==null||(r=t.DataType)==null?void 0:r.toLowerCase())!=null?e:"generic";return s==="stdtime"?"standard-time":s}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(!ee(this.transform)||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}};$([W({json:{write:!0}})],X.prototype,"attributeTable",void 0),$([W({json:{write:!0}})],X.prototype,"bandCount",void 0),$([W({json:{write:!0}})],X.prototype,"colormap",void 0),$([W({type:String,readOnly:!0})],X.prototype,"dataType",null),$([W({type:lt,json:{write:!0}})],X.prototype,"extent",void 0),$([W({type:lt,json:{write:!0}})],X.prototype,"nativeExtent",null),$([W({json:{write:!0}})],X.prototype,"nativePixelSize",null),$([W({json:{write:!0}})],X.prototype,"format",void 0),$([W({json:{write:!0}})],X.prototype,"height",void 0),$([W({json:{write:!0}})],X.prototype,"width",void 0),$([W({json:{write:!0}})],X.prototype,"histograms",void 0),$([W({json:{write:!0}})],X.prototype,"keyProperties",void 0),$([W({json:{write:!0}})],X.prototype,"multidimensionalInfo",void 0),$([W()],X.prototype,"noDataValue",void 0),$([W({json:{write:!0}})],X.prototype,"pixelSize",void 0),$([W({json:{write:!0}})],X.prototype,"pixelType",void 0),$([W()],X.prototype,"isPseudoSpatialReference",void 0),$([W({type:ir,json:{write:!0}})],X.prototype,"spatialReference",void 0),$([W({json:{write:!0}})],X.prototype,"statistics",void 0),$([W({type:ro,json:{write:!0}})],X.prototype,"storageInfo",void 0),$([W({json:{write:!0}})],X.prototype,"transform",void 0),X=$([je("esri.layers.support.RasterInfo")],X);const oo=X;function $t(e){let{altitude:t,azimuth:r}=e;const{hillshadeType:s,pixelSizePower:i,pixelSizeFactor:n,scalingType:c,isGCS:l,resolution:o}=e,a=s==="multi-directional"?2*e.zFactor:e.zFactor,{x:h,y:f}=o;let u=a/(8*h),d=a/(8*f);if(l&&a>.001&&(u/=111e3,d/=111e3),c==="adjusted")if(l){const P=111e3*h,I=111e3*f;u=(a+P**i*n)/(8*P),d=(a+I**i*n)/(8*I)}else u=(a+h**i*n)/(8*h),d=(a+f**i*n)/(8*f);let g=(90-t)*Math.PI/180,m=Math.cos(g),C=(360-r+90)*Math.PI/180,p=Math.sin(g)*Math.cos(C),y=Math.sin(g)*Math.sin(C);const v=[315,270,225,360,180,0],x=[60,60,60,60,60,90],w=new Float32Array([3,5,3,2,1,4]),k=w.reduce((P,I)=>P+I),b=w.map(P=>P/k),T=s==="multi-directional"?v.length:1,S=new Float32Array(6),M=new Float32Array(6),A=new Float32Array(6);if(s==="multi-directional")for(let P=0;P<T;P++)t=x[P],r=v[P],g=(90-t)*Math.PI/180,m=Math.cos(g),C=(360-r+90)*Math.PI/180,p=Math.sin(g)*Math.cos(C),y=Math.sin(g)*Math.sin(C),S[P]=m,M[P]=p,A[P]=y;else S.fill(m),M.fill(p),A.fill(y);return{resolution:o,factor:[u,d],sinZcosA:p,sinZsinA:y,cosZ:m,sinZcosAs:M,sinZsinAs:A,cosZs:S,weights:b,hillshadeType:["traditional","multi-directional"].indexOf(s)}}function io(e,t){if(!Z(e))return e;const{width:r,height:s,mask:i}=e,n=new Uint8Array(r*s);i&&n.set(i);const{factor:c,sinZcosA:l,sinZsinA:o,cosZ:a,sinZcosAs:h,sinZsinAs:f,cosZs:u,weights:d}=$t(t),[g,m]=c,{hillshadeType:C}=t,p=e.pixels[0],y=new Uint8Array(r*s);let v,x,w,k,b,T,S,M;const A=1;for(let P=A;P<s-A;P++){const I=P*r;for(let D=A;D<r-A;D++){if(i&&!i[I+D]){y[I+D]=0;continue}let O=8;if(i&&(O=i[I-r+D-1]+i[I-r+D]+i[I-r+D+1]+i[I+D-1]+i[I+D+1]+i[I+r+D-1]+i[I+r+D]+i[I+r+D+1],O<7)){y[I+D]=0,n[I+D]=0;continue}O===7?(v=i[I-r+D-1]?p[I-r+D-1]:p[I+D],x=i[I-r+D]?p[I-r+D]:p[I+D],w=i[I-r+D+1]?p[I-r+D+1]:p[I+D],k=i[I+D-1]?p[I+D-1]:p[I+D],b=i[I+D+1]?p[I+D+1]:p[I+D],T=i[I+r+D-1]?p[I+r+D-1]:p[I+D],S=i[I+r+D]?p[I+r+D]:p[I+D],M=i[I+r+D+1]?p[I+r+D+1]:p[I+D]):(v=p[I-r+D-1],x=p[I-r+D],w=p[I-r+D+1],k=p[I+D-1],b=p[I+D+1],T=p[I+r+D-1],S=p[I+r+D],M=p[I+r+D+1]);const L=(w+b+b+M-(v+k+k+T))*g,U=(T+S+S+M-(v+x+x+w))*m,V=Math.sqrt(1+L*L+U*U);let j=0;if(C==="traditional"){let E=255*(a+o*U-l*L)/V;E<0&&(E=0),j=E}else{const E=f.length;for(let B=0;B<E;B++){let R=255*(u[B]+f[B]*U-h[B]*L)/V;R<0&&(R=0),j+=R*d[B]}}y[I+D]=255&j}}for(let P=0;P<s;P++)y[P*r]=y[P*r+1],y[(P+1)*r-1]=y[(P+1)*r-2];for(let P=1;P<r-1;P++)y[P]=y[P+r],y[P+(s-1)*r]=y[P+(s-2)*r];return new H({width:r,height:s,pixels:[y],mask:i?n:null,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function no(e,t,r,s){if(!Z(e)||!Z(t))return;const{min:i,max:n}=s,c=e.pixels[0],{pixels:l,mask:o}=t,a=l[0],h=255.00001/(n-i),f=new Uint8ClampedArray(a.length),u=new Uint8ClampedArray(a.length),d=new Uint8ClampedArray(a.length),g=r.length-1;for(let m=0;m<a.length;m++){if(o&&o[m]===0)continue;const C=Math.floor((a[m]-i)*h),[p,y]=r[C<0?0:C>g?g:C],v=c[m],x=v*y,w=x*(1-Math.abs(p%2-1)),k=v-x;switch(Math.floor(p)){case 0:f[m]=x+k,u[m]=w+k,d[m]=k;break;case 1:f[m]=w+k,u[m]=x+k,d[m]=k;break;case 2:f[m]=k,u[m]=x+k,d[m]=w+k;break;case 3:f[m]=k,u[m]=w+k,d[m]=x+k;break;case 4:f[m]=w+k,u[m]=k,d[m]=x+k;break;case 5:case 6:f[m]=x+k,u[m]=k,d[m]=w+k}}e.pixels=[f,u,d],e.updateStatistics()}const ao=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}],so={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};function $e(e,t){if(!e||!t||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]>t[r]+2||e[r]<t[r]-2)return!1;return!0}function lo(e,t,r){const s=ht(e),i=ht(t),n={l:s.l*(1-r)+r*i.l,a:s.a*(1-r)+r*i.a,b:s.b*(1-r)+r*i.b};return sr(n)}function fo(e,t){if(!e)return;const r=t||ao;let s,i=null;return e.type==="algorithmic"?r.some(n=>{if($e(e.fromColor.toRgb(),n.fromColor)&&$e(e.toColor.toRgb(),n.toColor))return i=n.id,!0}):e.type==="multipart"&&r.some(n=>{if(e.colorRamps&&n.colorRamps&&e.colorRamps.length===n.colorRamps.length&&(s=e.colorRamps,!n.colorRamps.some((c,l)=>{if(!$e(s[l].fromColor.toRgb(),new ft(c.fromColor).toRgb())||!$e(s[l].toColor.toRgb(),new ft(c.toColor).toRgb()))return!0}))){if(i)return!0;i=n.id}}),i}function Go(e){const t=fo(e);return t?so[t]:null}function jt(e,t,r=!1){if(!e||!t||t<1)return;const s="toJSON"in e?e.toJSON():e,i=s.type==="multipart"?s.colorRamps.length:1,n=[],c=[];let l,o,a,h,f,u=0;if(t===1)return l=s.type==="multipart"?s.colorRamps[0].fromColor:s.fromColor,c.push([0].concat(l)),c;for(let d=0;d<i;d++)n[d]={start:null,end:null},n[d].start=u,n[d].end=u+1/i,u=n[d].end;for(let d=0;d<t;d++)h=d/(t-1),n.forEach((g,m)=>{if(h>=g.start&&(h<g.end||d===t-1&&m===i-1)){f=(h-g.start)/(g.end-g.start),s.type==="multipart"?(l=s.colorRamps[m].fromColor,o=s.colorRamps[m].toColor):(l=s.fromColor,o=s.toColor),d===0?c.push([d].concat(l.slice(0,3))):d===t-1?c.push([d].concat(o.slice(0,3))):(a=lo({r:l[0],g:l[1],b:l[2]},{r:o[0],g:o[1],b:o[2]},f),c.push([d,a.r,a.g,a.b]));const C=l[3]!=null?l[3]>1?l[3]/255:l[3]:1,p=o[3]!=null?o[3]>1?o[3]/255:o[3]:1;r&&c[d].push(Math.min(255,Math.round(255*(C*(1-f)+p*f))))}});return c}const zt=ut.getLogger("esri.renderers.support.RasterSymbolizer");function uo(e,t){const{attributeTable:r,bandCount:s}=e;return!(!ee(r)||s>1||t&&r.fields.find(i=>i.name.toLowerCase()===t.toLowerCase())==null)}function co(e){return e.dataType==="elevation"}function ho(e){const{bandCount:t,colormap:r}=e;return ee(r)&&r.length&&t===1}const Wt={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};let Te=class extends ze{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t={success:this._updateUVRenderer(e)};break;case"rasterColormap":t={success:this._updateColormapRenderer(e)};break;case"rasterStretch":t={success:this._updateStretchRenderer(e)};break;case"classBreaks":t={success:this._updateClassBreaksRenderer(e)};break;case"rasterShadedRelief":t={success:this._updateShadedReliefRenderer(e)};break;case"vectorField":t={success:this._updateVectorFieldRenderer()};break;case"animatedFlow":t=this._updateAnimatedFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!Kt(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=Ot(t,[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolize_colormap(t);break;case"classBreaks":r=this._symbolize_classBreaks(t);break;case"rasterStretch":r=this._symbolize_stretch(t,e.bandIds);break;case"rasterShadedRelief":{const{extent:s}=e,i=s.spatialReference.isGeographic,n={x:(s.xmax-s.xmin)/t.width,y:(s.ymax-s.ymin)/t.height};r=this._symbolize_shadedRelief(t,{isGCS:i,resolution:n});break}}return r}catch(r){return zt.error("symbolize",r.message),t}}simpleStretch(e,t){if(!Kt(e))return e;try{return e.pixels.length>3&&(e=Ot(e,[0,1,2])),ot(e,t)}catch(r){return zt.error("symbolize",r.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].indexOf(this.rendererJSON.type)>-1){var t;const{indexedColormap:l,offset:o}=((t=this.lookup)==null?void 0:t.colormapLut)||{};return{colormap:l,colormapOffset:o,type:"lut"}}const{pixelBlock:r,isGCS:s,resolution:i,bandIds:n}=e,{rendererJSON:c}=this;return c.type==="rasterStretch"?this.generateStretchWebGLParams(r,c,n):c.type==="rasterShadedRelief"?this.generateShadedReliefWebGLParams(c,s,i):c.type==="vectorField"?this._generateVectorFieldWebGLParams(c):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolize_colormap(e){return this._isLUTChanged()&&!this.bind().success?e:rt(e,this.lookup.colormapLut)}_symbolize_classBreaks(e){const t=this.rasterInfo.pixelType,r=["u8","u16","s8","s16"].indexOf(t)>-1;return this._isLUTChanged()&&!this.bind().success?e:r?rt(e,this.lookup.colormapLut):Hr(e,this.lookup.remapLut)}_symbolize_stretch(e,t){const{pixelType:r,bandCount:s}=this.rasterInfo,i=this.rendererJSON,n=["u8","u16","s8","s16"].indexOf(r)>-1;let c,l;const{dra:o}=i,a=i.useGamma?i.gamma:null;if(i.stretchType==="histogramEqualization"){const u=o?null:this.lookup.histogramLut,d=this.getStretchCutoff(i,e,t,!u),g=ot(e,me(se({},d),{gamma:a}));l=_t(g,{lut:o?d.histogramLut:u,offset:0})}else if(n){var h,f;if(o){const u=this.getStretchCutoff(i,e,t);c=Bt(me(se({pixelType:r},u),{gamma:a}))}else if(this._isLUTChanged()){if(!this.bind().success)return e;c=this.lookup?this.lookup.stretchLut:null}else c=this.lookup?this.lookup.stretchLut:null;if(!c)return e;s>1&&(t==null?void 0:t.length)===((h=Ae(e))==null?void 0:h.pixels.length)&&((f=c)==null?void 0:f.lut.length)===s&&(c={lut:t.map(u=>c.lut[u]),offset:c.offset}),l=_t(e,c)}else{const u=this.getStretchCutoff(i,e,t);l=ot(e,me(se({},u),{gamma:a}))}if(i.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;l=rt(l,this.lookup.colormapLut)}return l}_symbolize_shadedRelief(e,t){var r,s;const i=this.rendererJSON,n=se(se({},i),t),c=io(e,n);if(!i.colorRamp)return c;let l;if(this._isLUTChanged(!0)){if(!this.bind().success)return c;l=this.lookup?this.lookup.hsvMap:null}else l=this.lookup?this.lookup.hsvMap:null;if(!l)return c;const o=(r=(s=Ae(this.rasterInfo.statistics))==null?void 0:s[0])!=null?r:{min:0,max:8e3};return no(c,e,l,o),c}_updateVectorFieldRenderer(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")}_updateAnimatedFlowRenderer(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")?{success:!0}:{success:!1,error:`Unsupported data type "${t}"; AnimatedFlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){const{bandCount:t,attributeTable:r,pixelType:s}=this.rasterInfo,i=e.field1;if(!i)return!1;const n=e.defaultSymbol,c=t===1&&["u8","s8"].includes(s);if(!uo(this.rasterInfo,i)&&!c)return!1;const l=[];if(r){const a=r.fields.filter(h=>h.name.toLowerCase()==="value")[0];if(!a)return!1;r.features.forEach(h=>{var f;const u=e.uniqueValueInfos.filter(g=>String(g.value)===String(h.attributes[i]))[0],d=u==null||(f=u.symbol)==null?void 0:f.color;d?l.push([h.attributes[a.name]].concat(d)):n&&l.push([h.attributes[a.name]].concat(n.color))})}else{if(i.toLowerCase()!=="value")return!1;e.uniqueValueInfos.forEach(a=>{var h;const f=a==null||(h=a.symbol)==null?void 0:h.color;f?l.push([parseInt(""+a.value,10)].concat(f)):n&&l.push([parseInt(""+a.value,10)].concat(n.color))})}if(l.length===0)return!1;const o=Le({colormap:l});return this.lookup={rendererJSON:e,colormapLut:o},this.canRenderInWebGL=!0,!0}_updateColormapRenderer(e){if(!ho(this.rasterInfo))return!1;const t=e.colormapInfos.map(s=>[s.value].concat(s.color)).sort((s,i)=>s[0]-i[0]);if(!t||t.length===0)return!1;const r=Le({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,!0}_updateShadedReliefRenderer(e){if(!co(this.rasterInfo))return!1;if(e.colorRamp){const t=jt(e.colorRamp,256,!0),r=Le({colormap:t}),s=[],i=r.indexedColormap;for(let n=0;n<i.length;n+=4){const c=lr({r:i[n],g:i[n+1],b:i[n+2]});s.push([c.h/60,c.s/100,255*c.v/100])}this.lookup={rendererJSON:e,colormapLut:r,hsvMap:s}}else this.lookup=null;return this.canRenderInWebGL=!0,!0}_updateClassBreaksRenderer(e){const t=this.rasterInfo.pixelType,r=["u8","u16","s8","s16"].indexOf(t)>-1,s=e.classBreakInfos;if(s==null||!s.length)return!1;const i=s.sort((h,f)=>h.classMaxValue-f.classMaxValue),n=i[i.length-1];let c=e.minValue;if(!r){const h=[];for(let f=0;f<i.length;f++){var l;h.push({value:(l=i[f].classMinValue)!=null?l:c,mappedColor:i[f].symbol.color}),c=i[f].classMaxValue}return h.push({value:n.classMaxValue,mappedColor:n.symbol.color}),this.lookup={rendererJSON:e,remapLut:h},this.canRenderInWebGL=!1,!0}const o=[];c=Math.floor(e.minValue);for(let h=0;h<i.length;h++){const f=i[h];for(let u=c;u<f.classMaxValue;u++)o.push([u].concat(f.symbol.color));c=Math.ceil(f.classMaxValue)}n.classMaxValue===c&&o.push([n.classMaxValue].concat(n.symbol.color));const a=Le({colormap:o,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:a},this.canRenderInWebGL=!0,!0}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return ee(e)&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){var t;let{stretchType:r,dra:s}=e;if(!(r==="none"||(t=e.statistics)!=null&&t.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||s))return!1;const i=Ae(e.histograms||this.rasterInfo.histograms);!this._isHistogramRequired(e.stretchType)||i!=null&&i.length||s||(r="minMax");const{gamma:n,useGamma:c,colorRamp:l}=e,o=this.rasterInfo.pixelType,a=!s&&["u8","u16","s8","s16"].indexOf(o)>-1;if(r==="histogramEqualization"){const h=i.map(f=>Gt(f));this.lookup={rendererJSON:e,histogramLut:h}}else if(a){const h=this.getStretchCutoff(e),f=Bt(me(se({pixelType:o},h),{gamma:c?n:null}));this.lookup={rendererJSON:e,stretchLut:f}}if(l){const h=jt(l,256,!0);this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=Le({colormap:h}),this.lookup.rendererJSON=e}return this.canRenderInWebGL=!0,!0}getStretchCutoff(e,t=null,r,s){var i,n,c;let l,o,a=e.stretchType;var h;if(e.dra)if(a==="minMax"&&ee(t)&&t.statistics)l=t.statistics.map(A=>[A.minValue,A.maxValue,0,0]);else{const A=Kr(t);l=ee(A)?A.statistics:null,o=ee(A)?A.histograms:null}else l=((h=e.statistics)==null?void 0:h.length)>0?e.statistics:Ae(this.rasterInfo.statistics),o=e.histograms||Ae(this.rasterInfo.histograms);!this._isHistogramRequired(a)||(i=o)!=null&&i.length||(a="minMax");const f=((n=l)==null?void 0:n.length)||((c=o)==null?void 0:c.length)||this.rasterInfo.bandCount,u=[],d=[];let g,m,C,p,y,v,x,w,k,b,T,S;switch(l&&!Array.isArray(l[0])&&(l=l.map(A=>[A.min,A.max,A.avg,A.stddev])),a){case"none":{const A=Wt[this.rasterInfo.pixelType]||Wt.f32;for(w=0;w<f;w++)u[w]=A[0],d[w]=A[1]}break;case"minMax":for(w=0;w<f;w++)u[w]=l[w][0],d[w]=l[w][1];break;case"standardDeviation":for(w=0;w<f;w++)u[w]=l[w][2]-e.numberOfStandardDeviations*l[w][3],d[w]=l[w][2]+e.numberOfStandardDeviations*l[w][3],u[w]<l[w][0]&&(u[w]=l[w][0]),d[w]>l[w][1]&&(d[w]=l[w][1]);break;case"histogramEqualization":for(w=0;w<f;w++)u[w]=o[w].min,d[w]=o[w].max;break;case"percentClip":for(w=0;w<o.length;w++){for(g=o[w],y=new Uint32Array(g.size),p=g.counts,C=0,m=(g.max-g.min)/g.size,x=g.min===-.5&&m===1?.5:0,k=0;k<g.size;k++)C+=p[k],y[k]=C;for(v=(e.minPercent||0)*C/100,k=0;k<g.size;k++)if(y[k]>v){u[w]=g.min+m*(k+x);break}for(v=(1-(e.maxPercent||0)/100)*C,k=g.size-2;k>=0;k--)if(y[k]<v){d[w]=g.min+m*(k+2-x);break}}break;default:for(w=0;w<f;w++)u[w]=l[w][0],d[w]=l[w][1]}a==="histogramEqualization"?(T=o[0].size||256,b=0,s&&(S=o.map(A=>Gt(A)))):(T=e.max||255,b=e.min||0);const M={minCutOff:u,maxCutOff:d,outMax:T,outMin:b,histogramLut:S};return this.getSelectedBandCutoffs(M,r)}getSelectedBandCutoffs(e,t){if(t==null||t.length===0)return e;const r=Math.max.apply(null,t),{minCutOff:s,maxCutOff:i,outMin:n,outMax:c,histogramLut:l}=e;return s.length===t.length||s.length<=r?e:{minCutOff:t.map(o=>s[o]),maxCutOff:t.map(o=>i[o]),histogramLut:l?t.map(o=>l[o]):null,outMin:n,outMax:c}}generateStretchWebGLParams(e,t,r){let s=null,i=null;const n=this.lookup&&this.lookup.colormapLut;t.colorRamp&&n&&(s=n.indexedColormap,i=n.offset),t.stretchType==="histogramEqualization"&&(t=me(se({},t),{stretchType:"minMax"}));const{gamma:c}=t,l=!!(t.useGamma&&c&&c.some(y=>y!==1)),{minCutOff:o,maxCutOff:a,outMin:h,outMax:f}=this.getStretchCutoff(t,e,r);let u=0;ee(e)&&(u=e.getPlaneCount(),u===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const d=Math.min(3,(r==null?void 0:r.length)||u||this.rasterInfo.bandCount),g=new Float32Array(d),m=s||l?1:255;let C;for(C=0;C<d;C++)g[C]=(f-h)/(a[C]-o[C])/m;const p=new Float32Array(d);if(l)for(C=0;C<d;C++)c[C]>1?c[C]>2?p[C]=6.5+(c[C]-2)**2.5:p[C]=6.5+100*(2-c[C])**4:p[C]=1;return{bandCount:d,outMin:h/m,outMax:f/m,minCutOff:o,maxCutOff:a,factor:g,useGamma:l,gamma:l?c:[1,1,1],gammaCorrection:l?p:[1,1,1],colormap:s,colormapOffset:i,stretchType:t.stretchType,type:"stretch"}}generateShadedReliefWebGLParams(e,t,r){var s,i,n;let c=null,l=null;const o=this.lookup&&this.lookup.colormapLut;e.colorRamp&&o&&(c=o.indexedColormap,l=o.offset);const a=me(se({},e),{isGCS:t,resolution:r}),h=$t(a),f=(s=Ae(this.rasterInfo.statistics))==null?void 0:s[0];return me(se({},h),{minValue:(i=f==null?void 0:f.min)!=null?i:0,maxValue:(n=f==null?void 0:f.max)!=null?n:8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:c,colormapOffset:l})}_generateVectorFieldWebGLParams(e){var t,r,s,i,n,c;const{style:l,inputUnit:o,outputUnit:a,visualVariables:h,symbolTileSize:f,flowRepresentation:u}=e;let d;const g=(t=h==null?void 0:h.find(w=>w.type==="sizeInfo"))!=null?t:{type:"sizeInfo",field:"Magnitude",maxDataValue:(r=this.rasterInfo.statistics)==null?void 0:r[0].max,maxSize:.8*f,minDataValue:(s=this.rasterInfo.statistics)==null?void 0:s[0].min,minSize:.2*f},m=g?g.minDataValue:(i=this.rasterInfo.statistics)==null?void 0:i[0].min,C=g?g.maxDataValue:(n=this.rasterInfo.statistics)==null?void 0:n[0].max,p=ee(g.maxSize)&&ee(g.minSize)?[g.minSize/f,g.maxSize/f]:[.2,.8];if(l==="wind_speed"||l==="simple_scalar"){const w=(p[0]+p[1])/2;p[0]=p[1]=w}const y=ee(m)&&ee(C)?[m,C]:null;if(l==="classified_arrow")if(ee(m)&&ee(C)&&ee(g)){d=[];const w=(g.maxDataValue-g.minDataValue)/5;for(let k=0;k<6;k++)d.push(g.minDataValue+w*k)}else d=[0,1e-6,3.5,7,10.5,14];const v=u==="flow_to"==(l==="ocean_current_kn"||l==="ocean_current_m")?0:Math.PI,x=h==null?void 0:h.find(w=>w.type==="rotationInfo");return{breakValues:d,dataRange:y,inputUnit:o,outputUnit:a,symbolTileSize:f,symbolPercentRange:p,style:l||"single_arrow",rotation:v,rotationType:((c=this.rasterInfo.storageInfo)==null?void 0:c.tileInfo)&&this.rasterInfo.dataType==="vector-uv"?"geographic":(x==null?void 0:x.rotationType)||e.rotationType,type:"vectorField"}}};function Kt(e){return Z(e)&&e.validPixelCount!==0}$([W({json:{write:!0}})],Te.prototype,"rendererJSON",void 0),$([W({type:oo,json:{write:!0}})],Te.prototype,"rasterInfo",void 0),$([W({json:{write:!0}})],Te.prototype,"lookup",void 0),$([W()],Te.prototype,"canRenderInWebGL",void 0),Te=$([je("esri.renderers.support.RasterSymbolizer")],Te);const _o=Te,po=ut.getLogger("esri.views.2d.engine.flow.dataUtils"),Yt=8;async function No(e,t,r){const s=performance.now(),i=mo(e,t),n=performance.now(),c=yo(e,i,t.width,t.height),l=performance.now(),o=Co(c,!0),a=performance.now(),h=vo(o),f=performance.now();if(e.profile){const u={"_createFlowFieldFromData()":Math.round(n-s),"_getStreamlines()":Math.round(l-n),"createAnimatedLinesData()":Math.round(a-l),"createLinesMesh()":Math.round(f-a),"Total elapsed time":Math.round(f-s)};po.info("createStreamlinesMesh profile",u)}return await Promise.resolve(),nr(r),h}function mo(e,t){const r=wo(t.data,t.width,t.height,e.smoothing);return e.interpolate?(s,i)=>{const n=Math.floor(s),c=Math.floor(i);if(n<0||n>=t.width)return[0,0];if(c<0||c>=t.height)return[0,0];const l=s-n,o=i-c,a=n,h=c,f=n<t.width-1?n+1:n,u=c<t.height-1?c+1:c,d=r[2*(h*t.width+a)],g=r[2*(h*t.width+f)],m=r[2*(u*t.width+a)],C=r[2*(u*t.width+f)],p=r[2*(h*t.width+a)+1],y=r[2*(h*t.width+f)+1];return[(d*(1-o)+m*o)*(1-l)+(g*(1-o)+C*o)*l,(p*(1-o)+r[2*(u*t.width+a)+1]*o)*(1-l)+(y*(1-o)+r[2*(u*t.width+f)+1]*o)*l]}:(s,i)=>{const n=Math.round(s),c=Math.round(i);return n<0||n>=t.width||c<0||c>=t.height?[0,0]:[r[2*(c*t.width+n)+0],r[2*(c*t.width+n)+1]]}}function go(e,t,r,s,i,n,c,l,o){const a=[];let h,f,u=r,d=s,g=0;a.push({x:u,y:d,t:g});for(let m=0;m<e.verticesPerLine;m++){let[C,p]=t(u,d);C*=e.velocityScale,p*=e.velocityScale;const y=Math.sqrt(C*C+p*p);if(y<e.minSpeedThreshold)return a;const v=C/y,x=p/y;if(u+=v*e.segmentLength,d+=x*e.segmentLength,g+=e.segmentLength/y,Math.acos(v*h+x*f)>e.maxTurnAngle)return a;if(e.mergeLines){const w=Math.round(u*o),k=Math.round(d*o);if(w<0||w>c-1||k<0||k>l-1)return a;const b=n[k*c+w];if(b!==-1&&b!==i)return a;n[k*c+w]=i}a.push({x:u,y:d,t:g}),h=v,f=x}return a}function yo(e,t,r,s){const i=[],n=new ct,c=1/Math.max(e.lineCollisionWidth,1),l=Math.round(r*c),o=Math.round(s*c),a=new Int32Array(l*o);for(let f=0;f<a.length;f++)a[f]=-1;const h=[];for(let f=0;f<s;f+=e.lineSpacing)for(let u=0;u<r;u+=e.lineSpacing)h.push({x:u,y:f,sort:n.getFloat()});h.sort((f,u)=>f.sort-u.sort);for(const{x:f,y:u}of h)if(n.getFloat()<e.density){const d=go(e,t,f,u,i.length,a,l,o,c);if(d.length<2)continue;i.push(d)}return i}function wo(e,t,r,s){if(s===0)return e;const i=Math.round(3*s),n=new Array(2*i+1);let c=0;for(let a=-i;a<=i;a++){const h=Math.exp(-a*a/(s*s));n[a+i]=h,c+=h}for(let a=-i;a<=i;a++)n[a+i]/=c;const l=new Float32Array(e.length);for(let a=0;a<r;a++)for(let h=0;h<t;h++){let f=0,u=0;for(let d=-i;d<=i;d++){if(h+d<0||h+d>=t)continue;const g=n[d+i];f+=g*e[2*(a*t+(h+d))+0],u+=g*e[2*(a*t+(h+d))+1]}l[2*(a*t+h)+0]=f,l[2*(a*t+h)+1]=u}const o=new Float32Array(e.length);for(let a=0;a<t;a++)for(let h=0;h<r;h++){let f=0,u=0;for(let d=-i;d<=i;d++){if(h+d<0||h+d>=r)continue;const g=n[d+i];f+=g*l[2*((h+d)*t+a)+0],u+=g*l[2*((h+d)*t+a)+1]}o[2*(h*t+a)+0]=f,o[2*(h*t+a)+1]=u}return o}function Co(e,t){const r=new ct,s=e.reduce((o,a)=>o+a.length,0),i=new Float32Array(3*s),n=new Array(e.length);let c=0,l=0;for(const o of e){const a=c;for(const h of o)i[3*c+0]=h.x,i[3*c+1]=h.y,i[3*c+2]=h.t,c++;n[l++]={startVertex:a,numberOfVertices:o.length,totalTime:o[o.length-1].t,timeSeed:t?r.getFloat():0}}return{lineVertices:i,lineDescriptors:n}}function vo(e,t=10){const{lineVertices:r,lineDescriptors:s}=e;let i=0,n=0;for(const u of s)i+=2*u.numberOfVertices,n+=6*(u.numberOfVertices-1);const c=new Float32Array(i*Yt),l=new Uint32Array(n);let o=0,a=0;function h(){l[a++]=o-2,l[a++]=o,l[a++]=o-1,l[a++]=o,l[a++]=o+1,l[a++]=o-1}function f(u,d,g,m,C,p,y){const v=o*Yt;let x=0;c[v+x++]=u,c[v+x++]=d,c[v+x++]=1,c[v+x++]=g,c[v+x++]=p,c[v+x++]=y,c[v+x++]=m,c[v+x++]=C,o++,c[v+x++]=u,c[v+x++]=d,c[v+x++]=-1,c[v+x++]=g,c[v+x++]=p,c[v+x++]=y,c[v+x++]=-m,c[v+x++]=-C,o++}for(const u of s){const{totalTime:d,timeSeed:g}=u;let m=null,C=null,p=null,y=null,v=null;for(let x=0;x<u.numberOfVertices;x++){const w=r[3*(u.startVertex+x)+0],k=r[3*(u.startVertex+x)+1],b=r[3*(u.startVertex+x)+2];let T=null,S=null,M=null,A=null;if(x>0){T=w-m,S=k-C;const P=Math.sqrt(T*T+S*S);if(T/=P,S/=P,x>1){let I=T+y,D=S+v;const O=Math.sqrt(I*I+D*D);I/=O,D/=O;const L=Math.min(1/(I*T+D*S),t);I*=L,D*=L,M=-D,A=I}else M=-S,A=T;M!==null&&A!==null&&(f(m,C,p,M,A,d,g),h())}m=w,C=k,p=b,y=T,v=S}f(m,C,p,-v,y,d,g)}return{vertexData:c,indexData:l}}export{Uo as B,Ar as C,kr as D,Po as M,_o as N,Ao as O,Io as P,jt as a,eo as b,No as c,ao as d,ro as e,Oo as f,Mo as g,Ro as h,Eo as i,Ge as j,Qe as k,oo as l,Me as m,Go as n,Ir as o,Bo as p,et as q,ur as r,Kr as s,Lo as v,Do as y};
