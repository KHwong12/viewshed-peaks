import{bh as u,bi as w,o as c,r as o,x as y,bj as m,t as V,bk as p,e as n,d as r,i as f}from"./index.89a7b683.js";const d="analysis-view-handles";let a=class extends u(w){constructor(s){super(s),this.type="analysis-3d",this.allAnalysisViews=new c,this._creatingViewCount=0,this._analysisViewCreationTasks=new Map,this._analysisModules={"area-measurement":{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}initialize(){for(const s of this.layer.analyses)this._createAnalysisView(s);this.handles.add([this.layer.analyses.on("after-add",s=>{this._createAnalysisView(s.item)}),this.layer.analyses.on("after-remove",s=>{const e=this.allAnalysisViews.removeAt(this.allAnalysisViews.findIndex(t=>t.analysis===s.item));o(e)&&e.destroy();const i=this._analysisViewCreationTasks.get(s.item);o(i)&&(i.abort(),this._analysisViewCreationTasks.delete(s.item))})],d)}destroy(){this.handles.remove(d),this.allAnalysisViews.drain(s=>s.destroy()),this._analysisViewCreationTasks.clear(),this._creatingViewCount=0}whenAnalysisView(s){const e=this._analysisViewCreationTasks.get(s);if(o(e))return e.promise;const i=new y("layerview:no-analysisview-for-analysis","The analysis has not been added to the AnalysisLayer of this layer view",{analysis:s});return Promise.reject(i)}isUpdating(){return this._creatingViewCount!==0||this.allAnalysisViews.some(s=>s.updating)}_createAnalysisView(s){this._analysisViewCreationTasks.set(s,m(e=>this._createAnalysisViewPromise(s,e)))}async _createAnalysisViewPromise(s,e){this._creatingViewCount+=1;const i=s.type,t=this._analysisModules[i];if(V(t.module)){const h=await this._loadAnalysisModule(i);t.module=h}const l=new t.module.default({analysis:s,view:this.view,parent:this});if(await l.when(),this._creatingViewCount-=1,p(e))throw l.destroy(),new y("layerview:no-analysisview-for-analysis","The analysis has not been added to the AnalysisLayer of this layer view",{analysis:s});return this.allAnalysisViews.add(l),l}_loadAnalysisModule(s){switch(s){case"area-measurement":return import("./AreaMeasurementView3D.bc7d40fc.js").then(function(e){return e.A});case"direct-line-measurement":return import("./DirectLineMeasurementView3D.4c5a8462.js").then(function(e){return e.D});case"line-of-sight":return import("./LineOfSightView3D.4bb1840a.js");case"slice":return import("./SliceView3D.80f400c2.js").then(function(e){return e.S});default:return null}}};n([r()],a.prototype,"type",void 0),n([r()],a.prototype,"layer",void 0),n([r()],a.prototype,"allAnalysisViews",void 0),n([r()],a.prototype,"_creatingViewCount",void 0),a=n([f("esri.views.3d.layers.AnalysisLayerView3D")],a);const A=a;export{A as default};
