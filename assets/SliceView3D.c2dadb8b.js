var xe=Object.defineProperty;var N=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var R=(e,i,t)=>i in e?xe(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,j=(e,i)=>{for(var t in i||(i={}))ze.call(i,t)&&R(e,t,i[t]);if(N)for(var t of N(i))je.call(i,t)&&R(e,t,i[t]);return e};import{j5 as De,iR as A,gf as Te,d as G,c1 as c,b$ as B,c0 as We,c2 as Le,c6 as Fe,c3 as Me,c4 as Oe,j6 as Ue,r,c8 as u,c9 as I,ca as H,cb as q,cc as K,ce as J,cf as ke,cg as Q,j7 as Ne,ch as Re,ci as X,iK as Ae,cj as Ge,ck as Be,cm as Ie,cn as He,co as Y,j8 as qe,d2 as Ke,hn as D,aq as Je,bO as Z,iy as w,ho as Qe,ae as Xe,cd as Ye,h_ as Ze,bH as ei,bJ as ii,bL as ti,bM as ai,h$ as si,a_ as ee,h4 as ie,ec as te,A as d,bE as ri,t as o,hc as ae,w as $,dY as ni,dX as li,iP as oi,j9 as se,ja as re,ag as ne,E as h,jb as le,d_ as C,jc as oe,iI as de,jd as ce,je as T,ak as di,hz as ci,jf as hi,jg as W,jh as ui,hy as he,aT as ue,ji as pi,fW as gi,z as P,u as pe,M as ge,jj as vi,i2 as f,aP as L,i3 as ve,K as S,aQ as yi,jk as mi,jl as ye,dH as wi,i1 as fi}from"./vendor.d423bc92.js";import{c as bi,m as _i,p as $i}from"./LineVisualElement.cd39013a.js";import{U as Vi}from"./BuildingComponentSublayer.d118f7ca.js";import"./ImageMaterialTechnique.9a60abee.js";import{g as V}from"./persistable.cd5a03c6.js";function Ci(e,i,t){t.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${i.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}De();A();Te();new G({x:0,y:0,z:0,spatialReference:null});function Pi(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(c`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function Si(e,i,t){e.setUniform1f("perScreenPixelRatio",t.camera.perScreenPixelRatio),e.setUniform1f("screenSize",i.screenSize)}function Ei(e){const i=new B;return i.include(We,{linearDepth:!1}),i.include(Pi,{}),i.include(Le,e),i.fragment.include(Fe),i.vertex.uniforms.add("proj","mat4").add("view","mat4"),i.fragment.uniforms.add("color","vec4"),i.attributes.add("position","vec3"),i.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&i.varyings.add("depth","float"),e.screenSizeEnabled&&i.attributes.add("offset","vec3"),e.shadingEnabled&&(i.vertex.uniforms.add("viewNormal","mat4"),i.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),i.attributes.add("normal","vec3"),i.varyings.add("vViewNormal","vec3")),i.vertex.code.add(c`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&i.vertex.code.add(c`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),i.vertex.code.add(c`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(i.fragment.include(Me),i.include(Oe,e)),i.fragment.code.add(c`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?i.fragment.code.add(c`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):i.fragment.code.add(c`vec4 finalColor = color;`),i.fragment.code.add(c`
      if (finalColor.a < ${c.float(Ue)}) {
        discard;
      }
      ${e.output===7?c`gl_FragColor = vec4(finalColor.a);`:""}

      ${e.output===0?c`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),i}const xi=Object.freeze({__proto__:null,build:Ei});class F extends q{initializeProgram(i){const t=F.shader.get(),a=this.configuration,s=t.build({output:a.output,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:a.screenSizeEnabled,shadingEnabled:a.shadingEnabled,OITEnabled:a.transparencyPassType===0,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new K(i.rctx,s,zi)}bindPass(i,t){const{screenSizeEnabled:a,shadingEnabled:s}=this.configuration,{color:n,shadingTint:l,shadingDirection:_}=i;J(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",n),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),ke(this.program,t)),s&&(this.program.setUniform4fv("shadedColor",this.blendColor(ji,l,n)),this.program.setUniform3fv("shadingDirection",_),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),a&&Si(this.program,i,t)}bindDraw(i){Q(this.program,i),Ne(this.program,i.origin,i.camera.viewInverseTransposeMatrix),Re(this.program,this.configuration,i),this.program.rebindTextures()}blendColor(i,t,a){const s=1-t[3],n=t[3]+a[3]*s;return n===0?(i[3]=n,i):(i[0]=(t[0]*t[3]+a[0]*a[3]*s)/n,i[1]=(t[1]*t[3]+a[1]*a[3]*s)/n,i[2]=(t[2]*t[3]+a[2]*a[3]*s)/n,i[3]=a[3],i)}setPipelineState(i){const t=this.configuration,a=i===3,s=i===2;return X({blending:t.output!==0&&t.output!==7||!t.transparent?null:a?Ae:Ge(i),culling:Be(t.cullFace),depthTest:{func:s?513:t.shadingEnabled?515:513},depthWrite:a?t.writeDepth&&Ie:He(i),colorWrite:Y,polygonOffset:a||s?null:qe})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}F.shader=new I(xi,()=>import("./ShadedColorMaterial.glsl.feeac76e.js"));class p extends H{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}r([u({count:8})],p.prototype,"output",void 0),r([u({count:3})],p.prototype,"cullFace",void 0),r([u()],p.prototype,"slicePlaneEnabled",void 0),r([u()],p.prototype,"transparent",void 0),r([u()],p.prototype,"writeDepth",void 0),r([u()],p.prototype,"screenSizeEnabled",void 0),r([u()],p.prototype,"shadingEnabled",void 0),r([u({count:4})],p.prototype,"transparencyPassType",void 0),r([u()],p.prototype,"multipassTerrainEnabled",void 0),r([u()],p.prototype,"cullAboveGround",void 0);const zi=new Map([["position",0],["normal",1],["offset",2]]),ji=Ke();j({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:D(Je(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},Z);function Di(e,i,t,a){const s=D(w.get(),e),n=D(w.get(),i),l=Qe(w.get(),s,n);return a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=0,a[4]=n[0],a[5]=n[1],a[6]=n[2],a[7]=0,a[8]=l[0],a[9]=l[1],a[10]=l[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}Xe("mac");const Ti=.7,me=[1,.5,0],Wi=2,we=1,fe=[...me,Ti],be=[0,0,0,.04],_e=[...me,.5];function Li(){const e=new B;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(c`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(c`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const Fi=Object.freeze({__proto__:null,build:Li});class E extends q{initializeProgram(i){const t=E.shader.get().build();return new K(i.rctx,t,Ye)}bindPass(i,t){J(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",i.backgroundColor),this.program.setUniform4fv("gridColor",i.gridColor),this.program.setUniform1f("gridWidth",i.gridWidth)}bindDraw(i){Q(this.program,i),this.program.rebindTextures()}initializePipeline(){return X({blending:Ze(1,1,771,771),depthTest:{func:513},colorWrite:Y})}}E.shader=new I(Fi,()=>import("./SlicePlaneMaterial.glsl.96f315d0.js"));class Mi extends ei{constructor(i){super(i,Ui),this._config=new H}intersect(i,t,a,s,n,l,_){return ii(i,t,s,n,l,void 0,_)}createBufferWriter(){return new ti(ai)}requiresSlot(i){return i===7}createGLMaterial(i){return i.output===0?new Oi(i):null}getTechniqueConfig(){return this._config}}class Oi extends si{constructor(i){super(i),this.ensureTechnique(E,null)}updateParameters(){return ee(this.technique)}beginSlot(){return ee(this.technique)}bind(i,t){t.bindPass(this._material.parameters,i)}}const Ui=j({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},Z);class ki extends bi{constructor(i){super(i),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=ie(1,0,0,1),this._backgroundColor=ie(1,0,0,1),this.applyProps(i)}get renderOccluded(){return this._renderOccluded}set renderOccluded(i){i!==this._renderOccluded&&(this._renderOccluded=i,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(i){this._gridWidth!==i&&(this._gridWidth=i,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(i){te(this._gridColor,i),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(i){te(this._backgroundColor,i),this._updateMaterial()}createExternalResources(){this._material=new Mi(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(i){d(this._material)&&i(this._material)}createGeometries(i){if(d(this._material)){const t=ri.createSquareGeometry();i.addGeometry(t,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){d(this._material)&&this._material.setParameters(this.materialParameters)}}var M;let v=M=class extends ni{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new M({position:li(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&oi(this.position,e.position)&&this.width===e.width&&this.height===e.height}};r([o({readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),r([o({type:G}),V()],v.prototype,"position",void 0),r([o({type:Number,nonNullable:!0,range:{min:0,max:360}}),V(),ae(e=>se.normalize(re(e),0,!0))],v.prototype,"heading",void 0),r([o({type:Number,nonNullable:!0,range:{min:0,max:360}}),V(),ae(e=>se.normalize(re(e),0,!0))],v.prototype,"tilt",void 0),r([o({type:Number,nonNullable:!0}),V()],v.prototype,"width",void 0),r([o({type:Number,nonNullable:!0}),V()],v.prototype,"height",void 0),v=M=r([$("esri.widgets.Slice.SlicePlane")],v);const $e=v,Ni=ne.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ri(e,i,t){const a=i.worldUpAtPosition(e.origin,w.get()),s=e.basis1,n=Ve(e,a),l=Math.round(n/x)*x;return W(e,l-n,s,t)}function Ai(e,i){return Di(e.basis1,e.basis2,e.origin,i)}function Gi(e){return new _i({view:e,attached:!0,color:fe,width:we,writeDepthEnabled:!1,renderOccluded:4,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function Bi(e){return new ki({view:e,attached:!0,backgroundColor:[...be],gridColor:_e,gridWidth:4,renderOccluded:4})}function Ii(e,i,t,a=new $e){if(h(e))return null;const{renderCoordsHelper:s}=i,n=s.fromRenderCoords(e.origin,i.spatialReference);if(h(n))return null;const l=le(n,t);if(h(l))return null;a.position=l;const _=s.worldUpAtPosition(e.origin,w.get()),Pe=s.worldBasisAtPosition(e.origin,1,w.get()),Se=2*C(e.basis1),Ee=2*C(e.basis2),k=oe.renderUnitScaleFactor(i.spatialReference,t);return a.width=Se*k,a.height=Ee*k,a.tilt=de(Ve(e,_)),a.heading=de(Hi(e,_,Pe)),a}function Ve(e,i){return ce(i,e.basis2,e.basis1)+x}function Hi(e,i,t){return ce(e.basis1,t,i)-x}function qi(e,i,t,a,s,n,l=T()){return n.toRenderCoords(e,l.origin)?(n.worldBasisAtPosition(l.origin,0,l.basis1),n.worldBasisAtPosition(l.origin,1,l.basis2),hi(l.basis2,l.basis1,l.origin,l.plane),W(l,-he(i),ui(l),l),W(l,he(t),l.basis1,l),ue(l.basis1,l.basis1,a/2),ue(l.basis2,l.basis2,s/2),pi(l),l):(Ni.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Ki(e,i){if(h(e)||h(e.position))return null;const t=le(e.position,i);if(h(t))return null;const a=oe.renderUnitScaleFactor(e.position.spatialReference,i),s=e.width*a,n=e.height*a;return{position:t,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:n}}function Ji(e,i,t,a=T()){if(h(e))return null;let s=e.position;!e.position.hasZ&&d(i.elevationProvider)&&(s=e.position.clone(),s.z=di(ci(i.elevationProvider,e.position),0));const n=qi(s,e.heading,e.tilt,e.renderWidth,e.renderHeight,i.renderCoordsHelper,a);return!t.tiltEnabled&&d(n)&&Ri(n,i.renderCoordsHelper,n),n}function Qi(e){switch(e.type){case"analysis":case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return gi(e.type),!1}}A();const x=Math.PI/2;function Xi(e){const i=e.type==="building-scene-3d"?e:null;return d(i)}const O=ne.getLogger("esri.views.3d.analysis.Slice.SliceController");let y=class extends P{constructor(e){super(e),this._handles=new pe,this._internalChange=!1,this._currentSlicePlane=null,this.state="pending"}get ready(){return this.state==="ready"}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const i=e.item;i!=null&&(i instanceof ge||i instanceof Vi)?i instanceof ge&&Qi(i)?(O.error("excludedLayers",`Layer '${i.title}, id:${i.id}' of type '${i.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(i)&&e.preventDefault():(O.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),this._handles.add(vi(()=>this.view.ready&&d(this.view.renderCoordsHelper),()=>this._initialize(),{sync:!0,initial:!0,once:!0}))}_initialize(){this.state!=="destroyed"&&this.state!=="ready"&&(Zi(this.view,this),this._handles.add([f(()=>this.analysisView.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),f(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),f(()=>[this.analysisView.active,this.analysisView.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),f(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([f(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}destroy(){this.state!=="destroyed"&&this.state!=="pending"&&(this.analysisView.active=!1,et(this.view,this),this._handles.destroy(),this.view.slicePlane=null,this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await L(this,"ready"),this}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(Xi).flatMap(({sublayerViews:i})=>i.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,i=this._currentSlicePlane;if(h(i)&&h(e)||d(i)&&d(e)&&e.equals(i))return;let t=null,a=null;if(d(e)&&d(e.position)){const s=e.position.spatialReference,n=Ki(e,this.view.spatialReference);h(n)&&Ci(this.analysis,s,O),t=Ji(n,this.view,{tiltEnabled:this.analysis.tiltEnabled},T()),d(t)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisView.analysisViewData.plane=t,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisView.analysisViewData.plane,i=Ii(e,this.view,this.view.spatialReference,new $e);let t=null;d(i)&&(t={heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}),this._currentSlicePlane=t,this._internalChange=!0,this.analysis.shape=i,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(U)return;const e=Ce(this.view);if(this.analysisView.active)d(e.activeController)&&e.activeController!==this?(U=!0,e.activeController.analysisView.active=!1,U=!1):d(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(d(e.activeController)&&e.activeController!==this)return;d(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){this.state==="ready"&&Yi(this.view)}_updateLayerViews(){const e=d(this.analysisView.analysisViewData.plane)&&this.analysisView.visible&&this.analysisView.active,i=[],t=a=>{"layers"in a?a.layers.forEach(t):i.push(a)};this.analysis.excludedLayers.forEach(t),this.view.allLayerViews.forEach(a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&i.indexOf(a.layer)<0),"sublayerViews"in a&&a.sublayerViews.forEach(s=>{s.slicePlaneEnabled=e&&i.indexOf(s.sublayer)<0}))}),this.view.basemapTerrain!=null&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};r([o({readOnly:!0})],y.prototype,"state",void 0),r([o()],y.prototype,"view",void 0),r([o()],y.prototype,"analysis",void 0),r([o()],y.prototype,"analysisView",void 0),r([o()],y.prototype,"ready",null),r([o()],y.prototype,"_allLayerAndSubLayerViews",null),y=r([$("esri.views.3d.analysis.Slice.SliceController")],y);const b=new Map;let U=!1;function Yi(e){const i=Ce(e).activeController;d(i)&&d(i.analysisView.analysisViewData.plane)&&i.analysisView.visible?e.slicePlane=i.analysisView.analysisViewData.plane:e.slicePlane=null}function Zi(e,i){b.has(e)||b.set(e,{all:[],activeController:null}),b.get(e).all.push(i)}function Ce(e){return b.get(e)}function et(e,i){if(!b.has(e))throw new Error("view expected in global slice register");const t=b.get(e),a=t.all.lastIndexOf(i);if(a===-1)throw new Error("controller expected in global slice register");t.all.splice(a,1),t.all.length===0&&b.delete(e)}let z=class extends P{constructor(){super(...arguments),this.plane=null}};r([o()],z.prototype,"plane",void 0),z=r([$("esri.views.3d.analysis.Slice.SliceViewData")],z);let g=class extends P{constructor(e){super(e),this._handles=new pe,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.editable=!0}get ready(){return this.state==="ready"}initialize(){this._initialize()}async _initialize(){if(this.state==="destroyed"||this.state==="ready")return;await L(this.view,"ready",!0);const e=this.analysisView.analysisViewData;if(h(e))throw new Error("expected internal object to be valid");this._gridVisualElement=Bi(this.view),this._outlineVisualElement=Gi(this.view),this._handles.add([f(()=>({visible:d(e.plane)&&this.analysisView.visible,active:this.analysisView.active,editable:this.editable,showGrid:this.showGrid}),i=>this._updateMaterials(i),ve),f(()=>e.plane,i=>this._updatePlane(i),ve)],"internal"),this._set("state","ready")}destroy(){this.state!=="destroyed"&&this.state!=="pending"&&(this._handles.destroy(),this._gridVisualElement=S(this._gridVisualElement),this._outlineVisualElement=S(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await L(this,"ready"),this}_updatePlane(e){if(h(e))return;const i=yi(w.get(),C(e.basis1),C(e.basis2),1),t=mi(ye.get(),i),a=Ai(e,ye.get()),s=wi(t,a,t);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:i,editable:t,showGrid:a}){this._outlineVisualElement.color=fe,this._outlineVisualElement.width=t?we:Wi,this._outlineVisualElement.stipplePattern=i?null:fi(5);const s=a?_e:[0,0,0,0];this._gridVisualElement.backgroundColor=be,this._gridVisualElement.gridColor=s,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};r([o({readOnly:!0})],g.prototype,"state",void 0),r([o()],g.prototype,"view",void 0),r([o()],g.prototype,"analysis",void 0),r([o()],g.prototype,"analysisView",void 0),r([o()],g.prototype,"ready",null),r([o()],g.prototype,"showGrid",void 0),r([o()],g.prototype,"editable",void 0),g=r([$("esri.views.3d.analysis.Slice.SliceVisualization")],g);let m=class extends $i(P){constructor(e){super(e),this.type="slice-view",this.analysisVisualization=null,this.analysisController=null,this.analysisViewData=new z,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisVisualization=new g({view:this.view,analysis:this.analysis,analysisView:this}),this.analysisController=new y({view:this.view,analysis:this.analysis,analysisView:this})}destroy(){this.analysisVisualization=S(this.analysisVisualization),this.analysisController=S(this.analysisController)}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController}}};r([o()],m.prototype,"type",void 0),r([o()],m.prototype,"analysis",void 0),r([o()],m.prototype,"analysisViewData",void 0),r([o()],m.prototype,"active",void 0),r([o({aliasOf:"analysisVisualization.showGrid"})],m.prototype,"showGrid",void 0),r([o({aliasOf:"analysisVisualization.editable"})],m.prototype,"editable",void 0),m=r([$("esri.views.3d.analysis.Slice.SliceView3D")],m);const it=m;var ot=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:it});export{ot as S,Li as r,Ei as t};
