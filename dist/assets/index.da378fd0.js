import{B as I,j as N,b as T,y as _,G as A,L as M,l as S,a as P,S as R,m as O,c as D,d as C,h as H,g as j,e as z,x as F,f as K,i as B,k as G,s as $,n as V,o as q,p as J}from"./vendor.d423bc92.js";const W=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=a(e);fetch(e.href,t)}};W();const y={VICTORIA_HARBOUR:{position:{x:114.2,y:22.223,z:5e3,spatialReference:4326},heading:345,tilt:60},VICTORIA_PEAK:{position:{x:114.138,y:22.26,z:1500,spatialReference:4326},heading:20,tilt:70},KOWLOON_PEAKS:{position:{x:114.253,y:22.356,z:3e3,spatialReference:4326},heading:260,tilt:60},TAI_MO_SHAN:{position:{x:114.09,y:22.44,z:3e3,spatialReference:4326},heading:140,tilt:75},SHARP_PEAK:{position:{x:114.429,y:22.44,z:3e3,spatialReference:4326},heading:250,tilt:60}};function U(o,n){const a=document.getElementById(n);console.log(a),a.addEventListener("click",function(){const s=y[n];o.goTo(s,{duration:2e3})})}const Y=new I({title:"{STN_NAME}",content:[{type:"fields",fieldInfos:[{fieldName:"STN_NAME",label:"STN_NAME"},{fieldName:"HKPD_m",label:"HKPD_m"},{fieldName:"Northing_m",label:"Northing_m"},{fieldName:"Easting_m",label:"Easting_m"}]}]}),Z=new N({labelPlacement:"above-center",labelExpressionInfo:{expression:"$feature.STN_NAME + TextFormatting.NewLine + $feature.HKPD_m + 'm'"},symbol:new T({symbolLayers:new _({material:{color:[86,72,31]},halo:{color:[244,239,227,.6],size:"3px"},font:{weight:"bold"},size:10}),verticalOffset:{screenLength:50,maxWorldLength:500,minWorldLength:20},callout:{type:"line",size:"2px",color:[86,72,31]}})}),X=new A({url:"https://services5.arcgis.com/xH8UmTNerx1qYfXM/arcgis/rest/services/trigo_peaks/FeatureServer",outFields:["*"],popupTemplate:Y,labelingInfo:Z}),Q=new M({symbolLayers:new S({width:150,height:150,depth:150,resource:{primitive:"sphere"},material:{color:[255,0,0,.9]}}),verticalOffset:{screenLength:40,minWorldLength:150},callout:new P({size:1.5,color:[150,150,150,.8],border:{color:[50,50,50,.8]}})}),ee=new R({color:[255,255,251,.6],outline:new O({color:[255,255,255],width:.5})}),te="https://foa-arcgis.ad.arch.hku.hk/server/rest/services/CommonFunction/ViewshedHKDTM/GPServer/viewshed_50m",u=new D({url:te});function ne(o,n,a,s){s.removeAll();const e=new C({longitude:o.mapPoint.longitude,latitude:o.mapPoint.latitude}),t=new H({geometry:e,symbol:Q});s.add(t);const i=[];i.push(t);const h=new j;h.features=i;const L=new z({distance:a,units:"kilometers"}),x={Input_Point:h,Outer_radius:L};u.submitJob(x).then(E=>{document.getElementById("loading").style.display="block";const m=E.jobId;console.log(m);const k={interval:1500,statusCallback:l=>{console.log("Job Status: ",l.jobStatus)}};u.waitForJobCompletion(m,k).then(()=>{console.log("Job Completed. Fetching results..."),u.getResultData(m,"Output_Viewshed_Polygon").then(l=>{oe(n,s,l)})}).catch(l=>{alert("ERROR: Could not complete viewshed! Please try again later."),console.error(l)}).finally(()=>{document.getElementById("loading").style.display="none"})})}function oe(o,n,a){const s=a.value.features;console.log(s);const e=s.map(function(t){return t.symbol=ee,t});n.addMany(e),o.goTo({target:e,heading:0,tilt:0}).catch(function(t){t.name!=="AbortError"&&console.error(t)})}const se="https://data.weather.gov.hk/weatherAPI/opendata/opendata.php?dataType=LTMV&lang=en&rformat=json";function ae(o){fetch(o).then(n=>n.json()).then(n=>{console.log(n);const a=document.createElement("table");a.className="table";let s=a.insertRow(-1);for(let e=1;e<n.fields.length;e++){const t=document.createElement("th");t.innerHTML=n.fields[e],s.appendChild(t)}for(let e=0;e<n.data.length;e++){s=a.insertRow(-1);for(let t=1;t<n.fields.length;t++){const i=s.insertCell(-1);i.innerHTML=n.data[e][t]}}console.log(a),document.getElementById("visibilityDiv").appendChild(a)}).catch(n=>console.error(n))}function b(o,n){o.classList.contains("open")?n.classList.replace("bx-menu","bx-menu-alt-right"):n.classList.replace("bx-menu-alt-right","bx-menu")}const ie=new F({urlTemplate:"https://mapapi.geodata.gov.hk/gs/api/v1.0.0/xyz/imagery/wgs84/{z}/{x}/{y}.png",copyright:"Lands Department"}),le=new K({baseLayers:[ie],title:"LandsD Imagery Map",id:"lands-imagery"}),c=new B({basemap:le}),re=new G({url:"https://tiles.arcgis.com/tiles/6j1KwZfY2fZrfNMR/arcgis/rest/services/HK_DTM/ImageServer"});c.ground.layers.add(re);const r=new $({container:"viewDiv",map:c,camera:{position:{x:114.2,y:22.223,z:5e3},tilt:60,heading:345},constraints:{altitude:{max:8e4}}}),p=new V;c.add(p);c.add(X);const w=document.getElementById("queryDiv");w.style.display="block";const ce=new q({expandIconClass:"esri-icon-search",view:r,expanded:!0,content:w,mode:"floating",expandTooltip:"Expand the settings panel",collapseTooltip:"Hide the settings panel"});r.ui.add(ce,"bottom-left");const v=new J({container:"bufferNum",min:1,max:20,steps:.1,visibleElements:{labels:!0},precision:4,labelFormatFunction:function(o,n){return o.toString()+"km"},values:[5]});let f=0;f=v.values[0];v.on(["thumb-change","thumb-drag"],de);function de(o){f=o.value}document.getElementById("clearGeometry").addEventListener("click",me);function me(){p.removeAll()}r.on("click",o=>{ne(o,r,f,p)});Object.keys(y).forEach(function(o){U(r,o)});function ue(o){o.innerHTML=document.lastModified}const pe=document.getElementById("lastModified");ue(pe);ae(se);const d=document.querySelector(".sidebar"),g=document.querySelector("#collapse-button");d.classList.toggle("open");b(d,g);g.addEventListener("click",()=>{d.classList.toggle("open"),b(d,g)});
